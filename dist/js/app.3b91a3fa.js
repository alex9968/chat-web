(function(e){function t(t){for(var n,i,a=t[0],c=t[1],u=t[2],p=0,m=[];p<a.length;p++)i=a[p],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&m.push(s[i][0]),s[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);l&&l(t);while(m.length)m.shift()();return o.push.apply(o,u||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],n=!0,a=1;a<r.length;a++){var c=r[a];0!==s[c]&&(n=!1)}n&&(o.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},s={app:0},o=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var l=c;o.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"014d":function(e,t,r){"use strict";var n=r("a433"),s=r.n(n);s.a},"034f":function(e,t,r){"use strict";var n=r("64a9"),s=r.n(n);s.a},"03de":function(e,t,r){},"05ca":function(e,t,r){"use strict";var n=r("e26e"),s=r.n(n);s.a},"0650":function(e,t,r){"use strict";var n=r("5aaf"),s=r.n(n);s.a},"0716":function(e,t,r){"use strict";var n=r("4eff"),s=r.n(n);s.a},"0a44":function(e,t,r){"use strict";var n=r("6829"),s=r.n(n);s.a},"0c24":function(e,t,r){},"0dbf":function(e,t,r){"use strict";var n=r("2bee"),s=r.n(n);s.a},"0f85":function(e,t,r){},"12d4":function(e,t,r){},1531:function(e,t,r){},"1b21":function(e,t,r){},"1b64":function(e,t,r){},"1e3a":function(e,t,r){},"2bee":function(e,t,r){},"2c8c":function(e,t,r){},"30c9":function(e,t,r){"use strict";var n=r("1531"),s=r.n(n);s.a},"30ed":function(e,t,r){"use strict";var n=r("2c8c"),s=r.n(n);s.a},"34a8":function(e,t,r){},"3a1d":function(e,t,r){},"3a8d":function(e,t,r){"use strict";var n=r("1b64"),s=r.n(n);s.a},"3eb1":function(e,t,r){},4011:function(e,t,r){"use strict";var n=r("7a62"),s=r.n(n);s.a},"424b":function(e,t,r){"use strict";var n=r("03de"),s=r.n(n);s.a},"47b1":function(e,t,r){"use strict";var n=r("9908"),s=r.n(n);s.a},4988:function(e,t,r){},"4af9":function(e,t,r){"use strict";var n=r("eaaf"),s=r.n(n);s.a},"4d06":function(e,t,r){"use strict";var n=r("0c24"),s=r.n(n);s.a},"4eff":function(e,t,r){},"53b9":function(e,t,r){},5406:function(e,t,r){},5447:function(e,t,r){"use strict";var n=r("3eb1"),s=r.n(n);s.a},"56d7":function(e,t,r){"use strict";r.r(t);r("eca7"),r("450d");var n=r("3787"),s=r.n(n),o=(r("bd49"),r("18ff")),i=r.n(o),a=(r("960d"),r("defb")),c=r.n(a),u=(r("6611"),r("e772")),l=r.n(u),p=(r("1f1a"),r("4e4b")),m=r.n(p),f=(r("cb70"),r("b370")),d=r.n(f),h=(r("a7cc"),r("df33")),g=r.n(h),v=(r("075a"),r("72aa")),b=r.n(v),O=(r("b0ee"),r("d180")),y=r.n(O),_=(r("a335"),r("c0bb")),C=r.n(_),I=(r("b5d8"),r("f494")),P=r.n(I),w=(r("826b"),r("c263")),M=r.n(w),E=(r("e612"),r("dd87")),j=r.n(E),T=(r("be4f"),r("896a")),D=r.n(T),S=(r("acb6"),r("c673")),k=r.n(S),x=(r("920a"),r("4f0c")),L=r.n(x),R=(r("10cb"),r("f3ad")),A=r.n(R),N=(r("f4f9"),r("c2cc")),G=r.n(N),U=(r("7a0f"),r("0f6c")),$=r.n(U),F=(r("1951"),r("eedf")),B=r.n(F),Y=(r("0fb7"),r("f529")),V=r.n(Y),q=(r("cadf"),r("551c"),r("f751"),r("097d"),r("2b0e")),H=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"avatar",class:"circle"===e.shape?"shape-circle":""},[r("img",{attrs:{src:e.avatarSrc}})])},K=[],z=r("f6e3"),W=r.n(z),J={props:{src:String,type:{type:String,default:"C2C"},shape:{type:String,default:"circle"}},computed:{avatarSrc:function(){var e=this.src;return/^(https:|http:|\/\/)/.test(e)?e:this.defaultSrc},defaultSrc:function(){switch(this.type){case"C2C":return"https://imgcache.qq.com/open/qcloud/video/act/webim-avatar/avatar-2.png";case"GROUP":return"https://imgcache.qq.com/open/qcloud/video/act/webim-avatar/avatar-3.png";case this.TIM.TYPES.CONV_SYSTEM:return W.a;default:return"https://imgcache.qq.com/open/qcloud/video/act/webim-avatar/avatar-1.png"}}}},Q=J,Z=(r("691c"),r("2877")),X=Object(Z["a"])(Q,H,K,!1,null,"bd1b31fe",null),ee=X.exports,te=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("router-view")],1)},re=[],ne={name:"app",components:{}},se=ne,oe=(r("034f"),Object(Z["a"])(se,te,re,!1,null,null,null)),ie=oe.exports,ae=r("2f62"),ce=(r("8e6e"),r("456d"),r("20d6"),r("75fc")),ue=(r("55dd"),r("bd86")),le=(r("ac6a"),r("8615"),r("a481"),r("e23e")),pe=r.n(le),me=r("3438"),fe=r.n(me);function de(e){var t=1400284328,r=604800,n="0f6624e1d7436f1d55904d226d841a253d8b708e6c5799cbaad66e46f55ee708",s=new window.LibGenerateTestUserSig(t,n,r),o=s.genTestUserSig(e);return{SDKAppID:t,userSig:o}}window.genTestUserSig=de;var he=pe.a.create({SDKAppID:window.genTestUserSig("").SDKAppID});window.setLogLevel=he.setLogLevel,he.setLogLevel(4),he.registerPlugin({"cos-js-sdk":fe.a});var ge=he,ve=(r("96cf"),r("3b8d")),be=(r("28a5"),r("768b")),Oe=(r("ffc1"),r("7618")),ye=r("d225"),_e=r("b0b4"),Ce=r("bc3a"),Ie=r.n(Ce);function Pe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function we(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Pe(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Me=function(){function e(t){Object(ye["a"])(this,e),this.initConfig=t.initConfig||{},this.beforeRequset=t.beforeRequset||function(){},this.reqIntercept=t.reqIntercept||function(e){return e},this.resIntercept=t.resIntercept||function(){}}return Object(_e["a"])(e,[{key:"setInterceptors",value:function(e,t){var r=this;this.beforeRequset&&this.beforeRequset(t),e.interceptors.request.use((function(e){return r.reqIntercept(e)}),(function(e){return Promise.reject(e)})),e.interceptors.response.use((function(e){switch(r.resIntercept(e),e.status){case 200:return e.data;case 301:return;default:return Promise.reject("error")}}),(function(e){if(e.response){switch(e.response.status){case 400:V.a.warning("400,请求格式错误!");break;case 401:V.a.warning("401,未授权!");break;case 403:V.a.warning("403,禁止访问!");break;case 404:V.a.warning("404,资源不存在");break;case 500:V.a.warning("500,服务端错误");break;default:V.a.warning("请求错误");break}return Promise.reject(e.response)}return e.request?(4===e.request.readyState&&0===e.request.status&&console.error("请求超时!"),console.log("err.request: ",e),Promise.reject(e.request)):(console.log("err: ",e),Promise.reject(e))}))}},{key:"request",value:function(e,t){var r=Ie.a.create(),n=we(we({url:e},t),this.initConfig);return this.setInterceptors(r,e),r(n)}},{key:"get",value:function(e,t,r){var n=we({method:"GET"},r),s=e;return"object"===Object(Oe["a"])(t)&&(s=this.buildUrl(e,t)),this.request(s,n)}},{key:"post",value:function(e,t,r){var n=we(we({method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8"}},r),{},{data:{}});t&&(n.data=new URLSearchParams);for(var s=0,o=Object.entries(t);s<o.length;s++){var i=Object(be["a"])(o[s],2),a=i[0],c=i[1];n.data.append(a,c)}return this.request(e,n)}},{key:"delete",value:function(e,t){var r={method:"DELETE"},n=t?this.buildUrl(e,t):e;return this.request(n,r)}},{key:"put",value:function(e,t){var r={method:"PUT",data:{}},n=e.replace(/\${[^\+]+}/,t.uid);return console.log("data",t),t&&(r.data=JSON.stringify(t.data)),this.request(n,r)}},{key:"postForm",value:function(e,t,r){var n={method:"POST",body:{}};return t&&(n.body=r?this.buildFormData(t):new FormData(t)),this.request(e,n)}},{key:"head",value:function(e){var t={method:"Head"};return this.request(e,t)}},{key:"buildUrl",value:function(e,t){var r=[];if("object"===Object(Oe["a"])(t)){for(var n in t)"id"==n?e=e+"/"+encodeURIComponent(t[n]):r.push(n+"="+encodeURIComponent(t[n]));return e+"?"+r.join("&")}return e.split(":")[0]+t}},{key:"buildFormData",value:function(e){if(e){var t=new FormData;for(var r in e)r&&t.append(r,e[r]);return t}}}]),e}(),Ee=Me,je={login:{method:"post",url:"/api/v1/users/login"},logout:{method:"post",url:"/api/v1/users/logout"},register:{method:"post",url:"/api/v1/users/register"},checkAuth:{method:"post",url:"/api/v1/users/checkAuth"},userProfile:{method:"get",url:"/api/v1/users/detail"},getChatList:{method:"get",url:"/api/v1/chats"},sendMessage:{method:"post",url:"/api/v1/messages"},getFriendList:{method:"get",url:"/api/v1/friends"},getGroupList:{method:"get",url:"/api/v1/groups"},getMessageList:{method:"get",url:"/api/v1/messages"},addConversation:{method:"post",url:"/api/v1/chats"},updateUserInfo:{method:"put",url:"/api/admin/user/${uid}/update"},handleFriendRelation:{method:"post",url:"/api/v1/friends/handle"}};r("386d");function Te(e){var t=e>0;t?document.title.search(/\((.*?)\)/)>=0?document.title=document.title.replace(/\((.*?)\)/,"(".concat(e>99?"99+":e,")")):document.title="(".concat(e,")").concat(document.title):document.title=document.title.replace(/\((.*?)\)/,"")}var De=function(){return"http://39.105.116.143:8000"},Se=new Ee({initConfig:{baseURL:De(),credentials:"same-origin",headers:{Accept:"*/*",Authorization:"bearer"+localStorage.getItem("token")}},beforeRequset:function(e){"/login"===e&&console.log("to login page")},reqIntercept:function(e,t){return"/login"===t&&console.log("to login page"),e},resIntercept:function(e,t){switch(e.status){case 200:return e;case 302:break;case 401:break;default:0,Promise.resolve(e)}return Promise.resolve(e)}}),ke=function(e){var t={};return Object.keys(e).forEach((function(r){var n=e[r];t[r]=function(){var e=Object(ve["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Se[n.method](n.url,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})),t},xe=ke(je),Le={CONVERSATION_LIST:"conversation-list",GROUP_LIST:"group-list",FRIEND_LIST:"friend-list",BLACK_LIST:"black-list"},Re={OP_MSG:3,OP_ROOM_COUNT:4,OP_ROOM_INFO:5,OP_NEW_CHAT:6,COP_AUTH:10,COP_NEW_CHAT:11},Ae={TYPES:{WS_REQ_LOGIN:1,WS_REQ_LOGOUT:2,WS_REQ_MSG:3,MSG_TEXT:"TIMTextElem",MSG_IMAGE:"TIMImageElem",MSG_SOUND:"TIMSoundElem",MSG_AUDIO:"TIMSoundElem",MSG_FILE:"TIMFileElem",MSG_FACE:"TIMFaceElem",MSG_VIDEO:"TIMVideoFileElem",MSG_GEO:"TIMLocationElem",MSG_GRP_TIP:"TIMGroupTipElem",MSG_GRP_SYS_NOTICE:"TIMGroupSystemNoticeElem",MSG_CUSTOM:"TIMCustomElem",MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",CONV_C2C:"C2C",CONV_GROUP:"GROUP",CONV_SYSTEM:"@TIM#SYSTEM",GRP_PRIVATE:"Private",GRP_WORK:"Private",GRP_PUBLIC:"Public",GRP_CHATROOM:"ChatRoom",GRP_MEETING:"ChatRoom",GRP_AVCHATROOM:"AVChatRoom",GRP_MBR_ROLE_OWNER:"Owner",GRP_MBR_ROLE_ADMIN:"Admin",GRP_MBR_ROLE_MEMBER:"Member",GRP_TIP_MBR_JOIN:1,GRP_TIP_MBR_QUIT:2,GRP_TIP_MBR_KICKED_OUT:3,GRP_TIP_MBR_SET_ADMIN:4,GRP_TIP_MBR_CANCELED_ADMIN:5,GRP_TIP_GRP_PROFILE_UPDATED:6,GRP_TIP_MBR_PROFILE_UPDATED:7,MSG_REMIND_ACPT_AND_NOTE:"AcceptAndNotify",MSG_REMIND_ACPT_NOT_NOTE:"AcceptNotNotify",MSG_REMIND_DISCARD:"Discard",GENDER_UNKNOWN:"Gender_Type_Unknown",GENDER_FEMALE:"Gender_Type_Female",GENDER_MALE:"Gender_Type_Male",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",ALLOW_TYPE_ALLOW_ANY:"AllowType_Type_AllowAny",ALLOW_TYPE_NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_TYPE_DENY_ANY:"AllowType_Type_DenyAny",FORBID_TYPE_NONE:"AdminForbid_Type_None",FORBID_TYPE_SEND_OUT:"AdminForbid_Type_SendOut",JOIN_OPTIONS_FREE_ACCESS:"FreeAccess",JOIN_OPTIONS_NEED_PERMISSION:"NeedPermission",JOIN_OPTIONS_DISABLE_APPLY:"DisableApply",JOIN_STATUS_SUCCESS:"JoinedSuccess",JOIN_STATUS_ALREADY_IN_GROUP:"AlreadyInGroup",JOIN_STATUS_WAIT_APPROVAL:"WaitAdminApproval",GRP_PROFILE_OWNER_ID:"ownerID",GRP_PROFILE_CREATE_TIME:"createTime",GRP_PROFILE_LAST_INFO_TIME:"lastInfoTime",GRP_PROFILE_MEMBER_NUM:"memberNum",GRP_PROFILE_MAX_MEMBER_NUM:"maxMemberNum",GRP_PROFILE_JOIN_OPTION:"joinOption",GRP_PROFILE_INTRODUCTION:"introduction",GRP_PROFILE_NOTIFICATION:"notification",GRP_PROFILE_MUTE_ALL_MBRS:"muteAllMembers",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected"},EVENT:{SDK_READY:"sdkStateReady",SDK_NOT_READY:"sdkStateNotReady",SDK_DESTROY:"sdkDestroy",MESSAGE_RECEIVED:"onMessageReceived",MESSAGE_REVOKED:"onMessageRevoked",MESSAGE_READ_BY_PEER:"onMessageReadByPeer",CONVERSATION_LIST_UPDATED:"onConversationListUpdated",GROUP_LIST_UPDATED:"onGroupListUpdated",GROUP_SYSTEM_NOTICE_RECEIVED:"receiveGroupSystemNotice",PROFILE_UPDATED:"onProfileUpdated",BLACKLIST_UPDATED:"blacklistUpdated",KICKED_OUT:"kickedOut",ERROR:"error",NET_STATE_CHANGE:"netStateChange",SDK_RELOAD:"sdkReload"}},Ne=function(e){var t=[];return e.forEach((function(e){var r={};e.Type===Ae.TYPES.MSG_TEXT&&(r["text"]=e.Content);var n=localStorage.getItem("userID")===e.UserID+"";t.push({avatar:"",clientSequence:49812,conversationID:e.ChatID,conversationSubType:void 0,conversationType:e.ChatSort,flow:n?"out":"in",from:e.UserId,isPlaceMessage:2,isResend:!1,isRevoked:!1,isSystemMessage:!1,nick:"",payload:r,sequence:e.uuid,time:e.CreatedAt,type:e.Type,userInfo:e.UserInfo})})),t},Ge=function(e){var t={};return e.forEach((function(e){var r=localStorage.getItem("userID")===e.UserID+"",n="".concat(e.Sort).concat(e.ID);t[n]={conversationID:n,lastMessage:e.LastMessage,sort:e.Sort,id:e.ID,type:e.Sort,unreadCount:1,userInfo:e.userInfo,userProfile:{},groupProfile:{},time:e.CreatedAt},"C2C"===e.Sort&&r?t[n]["userProfile"]={userID:e.TargetProfile.ID,nick:e.TargetProfile.Name,avatar:e.TargetProfile.Avatar,gender:e.TargetProfile.Gender,age:e.TargetProfile.Age||"未知",home:e.TargetProfile.Profile.Home||"未知"}:t[n]["userProfile"]={userID:e.UserProfile.ID,nick:e.UserProfile.Name,avatar:e.UserProfile.Avatar,gender:e.UserProfile.Gender,age:e.UserProfile.Age||"未知",home:e.UserProfile.Profile.Home||"未知"},"GROUP"===e.Sort&&e.GroupProfile&&(t[n]["groupProfile"]={groupID:e.GroupProfile.ID,nick:e.GroupProfile.Name,avatar:e.GroupProfile.Avatar,intro:e.GroupProfile.Intro,userID:e.GroupProfile.UserID,members:[]})})),t},Ue=function(e){var t=/(\d+)$/g,r=t.exec(e);return r[0]},$e={getMessageList:function(e,t){if(e.state.isCompleted)e.commit("showMessage",{message:"已经没有更多的历史消息了哦",type:"info"});else{var r=e.state.currentMessageList;xe.getMessageList({chatID:Ue(t),pageNum:1,pageSize:20}).then((function(t){e.state.currentMessageList=[].concat(Object(ce["a"])(Ne(t.data.list)),Object(ce["a"])(r))}))}},getMoreHistoryMessageList:function(e,t){},getHistoryMessageList:function(e,t){xe.getMessageList({chatID:2,pageNum:1,pageSize:10}).then((function(r){var n=Ne(r.data.messages,t),s=e.state.currentMessageList;e.state.currentMessageList=[].concat(Object(ce["a"])(n),Object(ce["a"])(s)).sort((function(e,t){return e.time-t.time}))}))},checkoutConversation:function(e,t){e.commit("updateCurrentConversation",e.state.conversationObject[t]),e.dispatch("getMessageList",t)},group2Conversation:function(e,t){e.dispatch("checkoutConversation","C2C2")},friend2Conversation:function(e,t){e.dispatch("checkoutConversation","C2C2")}};function Fe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Be(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ye={state:{currentConversation:{},moreMessagePage:2,currentMessageList:[],nextReqMessageID:"",isCompleted:!1,conversationObject:{},totalConvasation:0,conversationPageNum:1,conversationPageSize:100,forkList:[]},getters:{toAccount:function(e){if(!e.currentConversation||!e.currentConversation.conversationID)return"";switch(e.currentConversation.type){case"C2C":return e.currentConversation.conversationID.replace("C2C","");case"GROUP":return e.currentConversation.conversationID.replace("GROUP","");default:return e.currentConversation.conversationID}},currentConversationType:function(e){return e.currentConversation&&e.currentConversation.type?e.currentConversation.type:""},totalUnreadCount:function(e){var t=Object.values(e.conversationObject),r={count:0,people:0};return r.count=t.reduce((function(t,n){return nt.getters.hidden||e.currentConversation.conversationID!==n.conversationID?(0!==n.unreadCount&&r.people++,t+n.unreadCount):t}),0),Te(r),r},imgUrlList:function(e){return e.currentMessageList.filter((function(e){return e.type===pe.a.TYPES.MSG_IMAGE&&!e.isRevoked})).map((function(e){return e.payload.imageInfoArray[0].url||e.payload.imageInfoArray[0].URL}))},conversationIdList:function(e){return e.map((function(e){return e.conversationID}))}},mutations:{updateCurrentConversation:function(e,t){e.currentConversation=Be(Be({},t),{},{unreadCount:0}),e.conversationObject[t.conversationID]=Be(Be({},t),{},{unreadCount:0}),e.currentMessageList=[],e.nextReqMessageID="",e.isCompleted=!1},resetCurrentConversationUnread:function(e){e.currentConversation.unreadCount=0},setTotalConvasation:function(e,t){},initConversationList:function(e,t){var r=Ge(t);window.initConversationObject=r,e.conversationObject=r,console.log("on",Object.values(r)[0]),e.currentConversation=Object.values(r)[0],e.currentMessageList=[]},updateConversationList:function(e,t){var r={};t.forEach((function(e){r[e.conversationID]=e})),console.log("新的会话列表",r),window.conversationObject=r,e.conversationObject=Object.assign(e.conversationObject,r)},resetCurrentConversation:function(e){e.currentConversation={}},sendMessage:function(e,t){console.log("commit sendMessage")},pushCurrentMessageList:function(e,t){var r=t.msg,n=t.store,s=r.sort+r.room,o=e.conversationObject[s];switch(r.op){case Re.OP_MSG:if(!o)return;var i=Ne([r.data])[0];console.log("pushCurrentMessageList",i),s===e.currentConversation.conversationID?e.currentMessageList=[].concat(Object(ce["a"])(e.currentMessageList),[i]):o&&(o.lastMessage=r,o.unreadCount++);break;case Re.OP_ROOM_INFO:if(!o)return;console.log("OP_ROOM_INFO",r,o),"GROUP"===r.sort&&(o.groupProfile=Be(Be({},o.groupProfile),{},{members:r.data.UserList,memberNum:r.data.OnlineCount+"/"+r.data.UserList.length}));break;case Re.OP_NEW_CHAT:console.log("OP_NEW_CHAT",r,Re.OP_NEW_CHAT);var a=Object.values(Ge([r.data]))[0];e.conversationObject[a.ID]=a,V.a.success("添加好友成功!"),n.commit("setActiveTab",Le.CONVERSATION_LIST),n.dispatch("friend2Conversation",a.ID),n.dispatch("getFriendList");break;default:console.log("ws消息格式无法识别!")}},removeMessage:function(e,t){var r=e.currentMessageList.findIndex((function(e){var t=e.ID;return t===V.a.ID}));r>=0&&e.currentMessageList.splice(r,1)},reset:function(e){Object.assign(e,{currentConversation:{},currentMessageList:[],nextReqMessageID:"",isCompleted:!1,conversationList:[]})},sendContactStar:function(e,t){t.conversationID,t.UID;var r=t.isFork;console.log("forkConversation3",r)}},actions:$e},Ve=Ye,qe=(r("6762"),r("2fdb"),{state:{groupList:[],currentGroup:{},currentMemberList:[],createGroupModelVisible:!1},getters:{hasGroupList:function(e){return e.groupList.length>0}},mutations:{updateGroupList:function(e,t){e.groupList=t},updateCreateGroupModelVisible:function(e,t){e.createGroupModelVisible=t},updateCurrentMemberList:function(e,t){e.currentMemberList=[].concat(Object(ce["a"])(e.currentMemberList),Object(ce["a"])(t))},deleteGroupMemeber:function(e,t){e.currentMemberList=e.currentMemberList.filter((function(e){return e.userID!==t}))},deleteGroupMemberList:function(e,t){e.currentMemberList=e.currentMemberList.filter((function(e){return!t.includes(e.userID)}))},resetCurrentMemberList:function(e){e.currentMemberList=[]},reset:function(e){Object.assign(e,{groupList:[],currentMemberList:[],createGroupModelVisible:!1})},setCurrentGroup:function(e,t){e.groupList.forEach((function(r){r.ID===t&&(e.currentGroup=r)}))}},actions:{updateGroupList:function(e,t){e.commit("updateGroupList",t)},getGroupMemberList:function(e,t){return xe.getUserGroupMemberList({groupID:t,offset:e.state.currentMemberList.length,count:30}).then((function(t){return e.commit("updateCurrentMemberList",t.data.memberList),t}))},getGroupList:function(e){xe.getGroupList({id:localStorage.getItem("userID")}).then((function(t){var r=t.data;e.dispatch("updateGroupList",r),e.commit("setCurrentGroup",r[0].ID)})).catch((function(t){e.commit("showMessage",{type:"error",message:t.message})}))}}}),He=qe,Ke={state:{profile:{},isLogin:!1,isWsReady:!1,userID:0,name:"",age:null,avatar:""},mutations:{setUserInfo:function(e,t){e.profile=t.Profile,e.userID=t.ID,e.name=t.Name,e.age=t.Age,e.avatar=t.Avatar},toggleIsLogin:function(e,t){e.isLogin="undefined"===typeof t?!e.isLogin:t},toggleIsWsReady:function(e,t){e.isWsReady=t},reset:function(e){Object.assign(e,{profile:{},isLogin:!1,isWsReady:!1,userID:null,name:"",avatar:""})}},actions:{logout:function(e){localStorage.clear(),e.commit("toggleIsLogin",!1),e.commit("reset")}}},ze=Ke,We={state:{currentUserProfile:{},isLogin:!1},mutations:{toggleIsSDKReady:function(e,t){}},actions:{initWebSocket:function(e){localStorage.clear()}}},Je=We,Qe={state:{videoRoom:0,isBusy:!1},mutations:{GENERATE_VIDEO_ROOM:function(e,t){e.videoRoom=t||Math.ceil(Math.random()*(Math.pow(2,32)-1))},UPDATE_ISBUSY:function(e,t){e.isBusy=t}}},Ze=Qe,Xe={state:{friendList:[],relationList:[],createGroupModelVisible:!1,currentFriend:{},currentRelation:{},currentFriendRelated:!1},mutations:{updateFriendData:function(e,t){e.friendList=t.friends,e.relationList=t.relations},reset:function(e){Object.assign(e,{friendList:[],createGroupModelVisible:!1})},setCurrentFriend:function(e,t){e.currentFriendRelated=!0,e.currentRelation={},e.friendList.forEach((function(r){r.ID===t&&(e.currentFriend=r)}))},setCurrentRelation:function(e,t){var r=t.UserId,n=t.Is2Me;e.currentFriendRelated=!1,e.relationList.forEach((function(t){n||t.RelatedId!==r||(e.currentFriend=t.RelatedProfile,e.currentRelation=t),n&&t.UserId===r&&(e.currentFriend=t.UserProfile,e.currentRelation=t)}))}},actions:{getFriendList:function(e){var t=this;xe.getFriendList({id:localStorage.getItem("userID")}).then((function(t){var r=t.data;e.commit("updateFriendData",r),r.friends.length&&e.commit("setCurrentFriend",r.friends[0].ID)})).catch((function(t){e.commit("showMessage",{type:"error",message:t.message})})).catch((function(e){t.$store.commit("showMessage",{type:"error",message:e.message})}))},checkoutFriend:function(e,t){e.commit("updateCurrentConversation",e.state.conversationObject[t])},handleFriendRelation:function(e,t){var r=t.ws,n=t.handleSig,s=t.relationID,o=localStorage.getItem("token"),i={cop:Re.COP_NEW_CHAT,authToken:o,data:JSON.stringify({handleSig:n,userID:parseInt(localStorage.getItem("userID")),relationID:s})};r.send(JSON.stringify(i))}}},et=Xe,tt={state:{blacklist:[]},mutations:{updateBlacklist:function(e,t){e.blacklist=t},removeFromBlacklist:function(e,t){e.blacklist=e.blacklist.filter((function(e){return e.userID!==t}))},reset:function(e){Object.assign(e,{blacklist:[]})}},actions:{getBlacklist:function(e){ge.getBlacklist().then((function(t){var r=t.data;r.length>0&&ge.getUserProfile({userIDList:r}).then((function(t){var r=t.data;e.commit("updateBlacklist",r)}))}))}}},rt=tt;q["default"].use(ae["a"]);var nt=new ae["a"].Store({state:{activeTab:"conversation-list",current:Date.now(),intervalID:0,message:void 0,unreadCount:10,unreadNumber:20},getters:{hidden:function(e){e.current;return"function"!==typeof document.hasFocus?document.hidden:!document.hasFocus()}},mutations:{setActiveTab:function(e,t){e.activeTab=t},startComputeCurrent:function(e){e.intervalID=setInterval((function(){e.current=Date.now()}),500)},updateUnreadTotal:function(e,t){e.unreadCount=t.unreadCount,e.unreadNumber=t.unreadNumber},stopComputeCurrent:function(e){clearInterval(e.intervalID),e.intervalID=0},showMessage:function(e,t){e.message&&e.message.close(),e.message=V()({message:t.message,type:t.type||"success",duration:t.duration||2e3,offset:40})}},actions:{},modules:{conversation:Ve,group:He,friend:et,blacklist:rt,user:ze,message:Je,video:Ze}}),st=r("8c4f"),ot=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container"},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.showLoading,expression:"showLoading"}],staticClass:"loading",attrs:{"element-loading-text":"正在拼命初始化...","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[r("div",{staticClass:"chat-header"},[r("header-bar")],1),r("div",{staticClass:"chat-wrapper"},[r("el-row",[r("el-col",{attrs:{xs:10,sm:10,md:10,lg:8,xl:7}},[r("side-bar")],1),r("el-col",{directives:[{name:"show",rawName:"v-show",value:e.showConversationList,expression:"showConversationList"}],attrs:{xs:14,sm:14,md:14,lg:16,xl:17}},[r("current-conversation")],1),r("el-col",{directives:[{name:"show",rawName:"v-show",value:e.showGroupList,expression:"showGroupList"}],attrs:{xs:14,sm:14,md:14,lg:16,xl:17}},[r("current-group")],1),r("el-col",{directives:[{name:"show",rawName:"v-show",value:e.showFriendList,expression:"showFriendList"}],attrs:{xs:14,sm:14,md:14,lg:16,xl:17}},[r("current-friend")],1)],1)],1),r("image-previewer")],1),r("div",{staticClass:"bg"})])},it=[],at=(r("46a1"),r("e5f2")),ct=r.n(at),ut=(r("4917"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"current-conversation-wrapper"},[e.showCurrentConversation?r("div",{staticClass:"current-conversation",on:{scroll:e.onScroll}},[r("div",{staticClass:"header"},[r("div",{staticClass:"name"},[e._v(e._s(e.name))])]),r("div",{staticClass:"content"},[r("div",{staticClass:"content-left"},[r("div",{ref:"message-list",staticClass:"message-list",on:{scroll:this.onScroll}},[e.isCompleted?r("div",{staticClass:"no-more"},[e._v("没有更多了")]):r("div",{staticClass:"more"},[r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.$store.dispatch("getMoreHistoryMessageList",e.currentConversation.conversationID)}}},[e._v("查看更多")])],1),e._l(e.currentMessageList,(function(e){return r("message-item",{key:e.ID,attrs:{message:e}})}))],2),r("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowScrollButtomTips,expression:"isShowScrollButtomTips"}],staticClass:"newMessageTips",on:{click:e.scrollMessageListToButtom}},[e._v("\n          回到最新位置\n        ")])]),r("div",{staticClass:"content-right"},[r("conversation-profile")],1)]),e.showMessageSendBox?r("div",{staticClass:"footer"},[r("message-send-box")],1):e._e()]):e._e()])}),lt=[],pt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{style:e.focus?{backgroundColor:"white"}:{},attrs:{id:"message-send-box-wrapper"},on:{drop:e.dropHandler}},[r("div",{staticClass:"send-header-bar"},[r("el-popover",{attrs:{placement:"top",width:"400",trigger:"click"}},[r("div",{staticClass:"emojis"},e._l(e.emojiName,(function(t){return r("div",{key:t,staticClass:"emoji",on:{click:function(r){return e.chooseEmoji(t)}}},[r("img",{staticStyle:{width:"30px",height:"30px"},attrs:{src:e.emojiUrl+e.emojiMap[t]}})])})),0),r("i",{staticClass:"iconfont icon-smile",attrs:{slot:"reference",title:"发表情"},slot:"reference"})]),r("i",{staticClass:"iconfont icon-tupian",attrs:{title:"发图片"},on:{click:e.handleSendImageClick}})],1),r("el-popover",{staticStyle:{"max-height":"500px","overflow-y":"scroll"},attrs:{trigger:"manual",placement:"top"},model:{value:e.showAtGroupMember,callback:function(t){e.showAtGroupMember=t},expression:"showAtGroupMember"}},e._l(e.memberList,(function(t){return r("el-radio-group",{key:t.userID,staticStyle:{display:"flex","flex-decoration":"column"},on:{change:e.handleSelectAtUser},model:{value:e.atUserID,callback:function(t){e.atUserID=t},expression:"atUserID"}},[r("el-radio",{attrs:{label:t.userID}},[e._v(e._s(t.nameCard||t.nick||t.userID))])],1)})),1),r("div",{staticClass:"bottom"},[r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.messageContent,expression:"messageContent"}],ref:"text-input",staticClass:"text-input",attrs:{rows:"4",resize:"false"},domProps:{value:e.messageContent},on:{focus:function(t){e.focus=!0},blur:function(t){e.focus=!1},keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:(t.preventDefault(),e.handleEnter(t))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"])?null:(t.stopPropagation(),e.handleUp(t))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"])?null:(t.stopPropagation(),e.handleDown(t))}],keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?(t.preventDefault(),t.shiftKey||t.altKey||t.metaKey?null:e.handleLine(t)):null},input:function(t){t.target.composing||(e.messageContent=t.target.value)}}}),r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"按Enter发送消息，Ctrl+Enter换行",placement:"left-start"}},[r("div",{staticClass:"btn-send",on:{click:e.sendTextMessage}},[r("div",{staticClass:"tim-icon-send"})])])],1),r("input",{ref:"imagePicker",staticStyle:{display:"none"},attrs:{type:"file",id:"imagePicker",accept:".jpg, .jpeg, .png, .gif"},on:{change:e.sendImage}})],1)},mt=[],ft=(r("0c67"),r("299c")),dt=r.n(ft),ht=(r("fe07"),r("6ac5")),gt=r.n(ht),vt=(r("06f1"),r("6ac9")),bt=r.n(vt),Ot="https://imgcache.qq.com/open/qcloud/tim/assets/emoji/",yt={"[NO]":"emoji_0@2x.png","[OK]":"emoji_1@2x.png","[下雨]":"emoji_2@2x.png","[么么哒]":"emoji_3@2x.png","[乒乓]":"emoji_4@2x.png","[便便]":"emoji_5@2x.png","[信封]":"emoji_6@2x.png","[偷笑]":"emoji_7@2x.png","[傲慢]":"emoji_8@2x.png","[再见]":"emoji_9@2x.png","[冷汗]":"emoji_10@2x.png","[凋谢]":"emoji_11@2x.png","[刀]":"emoji_12@2x.png","[删除]":"emoji_13@2x.png","[勾引]":"emoji_14@2x.png","[发呆]":"emoji_15@2x.png","[发抖]":"emoji_16@2x.png","[可怜]":"emoji_17@2x.png","[可爱]":"emoji_18@2x.png","[右哼哼]":"emoji_19@2x.png","[右太极]":"emoji_20@2x.png","[右车头]":"emoji_21@2x.png","[吐]":"emoji_22@2x.png","[吓]":"emoji_23@2x.png","[咒骂]":"emoji_24@2x.png","[咖啡]":"emoji_25@2x.png","[啤酒]":"emoji_26@2x.png","[嘘]":"emoji_27@2x.png","[回头]":"emoji_28@2x.png","[困]":"emoji_29@2x.png","[坏笑]":"emoji_30@2x.png","[多云]":"emoji_31@2x.png","[大兵]":"emoji_32@2x.png","[大哭]":"emoji_33@2x.png","[太阳]":"emoji_34@2x.png","[奋斗]":"emoji_35@2x.png","[奶瓶]":"emoji_36@2x.png","[委屈]":"emoji_37@2x.png","[害羞]":"emoji_38@2x.png","[尴尬]":"emoji_39@2x.png","[左哼哼]":"emoji_40@2x.png","[左太极]":"emoji_41@2x.png","[左车头]":"emoji_42@2x.png","[差劲]":"emoji_43@2x.png","[弱]":"emoji_44@2x.png","[强]":"emoji_45@2x.png","[彩带]":"emoji_46@2x.png","[彩球]":"emoji_47@2x.png","[得意]":"emoji_48@2x.png","[微笑]":"emoji_49@2x.png","[心碎了]":"emoji_50@2x.png","[快哭了]":"emoji_51@2x.png","[怄火]":"emoji_52@2x.png","[怒]":"emoji_53@2x.png","[惊恐]":"emoji_54@2x.png","[惊讶]":"emoji_55@2x.png","[憨笑]":"emoji_56@2x.png","[手枪]":"emoji_57@2x.png","[打哈欠]":"emoji_58@2x.png","[抓狂]":"emoji_59@2x.png","[折磨]":"emoji_60@2x.png","[抠鼻]":"emoji_61@2x.png","[抱抱]":"emoji_62@2x.png","[抱拳]":"emoji_63@2x.png","[拳头]":"emoji_64@2x.png","[挥手]":"emoji_65@2x.png","[握手]":"emoji_66@2x.png","[撇嘴]":"emoji_67@2x.png","[擦汗]":"emoji_68@2x.png","[敲打]":"emoji_69@2x.png","[晕]":"emoji_70@2x.png","[月亮]":"emoji_71@2x.png","[棒棒糖]":"emoji_72@2x.png","[汽车]":"emoji_73@2x.png","[沙发]":"emoji_74@2x.png","[流汗]":"emoji_75@2x.png","[流泪]":"emoji_76@2x.png","[激动]":"emoji_77@2x.png","[灯泡]":"emoji_78@2x.png","[炸弹]":"emoji_79@2x.png","[熊猫]":"emoji_80@2x.png","[爆筋]":"emoji_81@2x.png","[爱你]":"emoji_82@2x.png","[爱心]":"emoji_83@2x.png","[爱情]":"emoji_84@2x.png","[猪头]":"emoji_85@2x.png","[猫咪]":"emoji_86@2x.png","[献吻]":"emoji_87@2x.png","[玫瑰]":"emoji_88@2x.png","[瓢虫]":"emoji_89@2x.png","[疑问]":"emoji_90@2x.png","[白眼]":"emoji_91@2x.png","[皮球]":"emoji_92@2x.png","[睡觉]":"emoji_93@2x.png","[磕头]":"emoji_94@2x.png","[示爱]":"emoji_95@2x.png","[礼品袋]":"emoji_96@2x.png","[礼物]":"emoji_97@2x.png","[篮球]":"emoji_98@2x.png","[米饭]":"emoji_99@2x.png","[糗大了]":"emoji_100@2x.png","[红双喜]":"emoji_101@2x.png","[红灯笼]":"emoji_102@2x.png","[纸巾]":"emoji_103@2x.png","[胜利]":"emoji_104@2x.png","[色]":"emoji_105@2x.png","[药]":"emoji_106@2x.png","[菜刀]":"emoji_107@2x.png","[蛋糕]":"emoji_108@2x.png","[蜡烛]":"emoji_109@2x.png","[街舞]":"emoji_110@2x.png","[衰]":"emoji_111@2x.png","[西瓜]":"emoji_112@2x.png","[调皮]":"emoji_113@2x.png","[象棋]":"emoji_114@2x.png","[跳绳]":"emoji_115@2x.png","[跳跳]":"emoji_116@2x.png","[车厢]":"emoji_117@2x.png","[转圈]":"emoji_118@2x.png","[鄙视]":"emoji_119@2x.png","[酷]":"emoji_120@2x.png","[钞票]":"emoji_121@2x.png","[钻戒]":"emoji_122@2x.png","[闪电]":"emoji_123@2x.png","[闭嘴]":"emoji_124@2x.png","[闹钟]":"emoji_125@2x.png","[阴险]":"emoji_126@2x.png","[难过]":"emoji_127@2x.png","[雨伞]":"emoji_128@2x.png","[青蛙]":"emoji_129@2x.png","[面条]":"emoji_130@2x.png","[鞭炮]":"emoji_131@2x.png","[风车]":"emoji_132@2x.png","[飞吻]":"emoji_133@2x.png","[飞机]":"emoji_134@2x.png","[饥饿]":"emoji_135@2x.png","[香蕉]":"emoji_136@2x.png","[骷髅]":"emoji_137@2x.png","[麦克风]":"emoji_138@2x.png","[麻将]":"emoji_139@2x.png","[鼓掌]":"emoji_140@2x.png","[龇牙]":"emoji_141@2x.png"},_t=["[龇牙]","[调皮]","[流汗]","[偷笑]","[再见]","[敲打]","[擦汗]","[猪头]","[玫瑰]","[流泪]","[大哭]","[嘘]","[酷]","[抓狂]","[委屈]","[便便]","[炸弹]","[菜刀]","[可爱]","[色]","[害羞]","[得意]","[吐]","[微笑]","[怒]","[尴尬]","[惊恐]","[冷汗]","[爱心]","[示爱]","[白眼]","[傲慢]","[难过]","[惊讶]","[疑问]","[困]","[么么哒]","[憨笑]","[爱情]","[衰]","[撇嘴]","[阴险]","[奋斗]","[发呆]","[右哼哼]","[抱抱]","[坏笑]","[飞吻]","[鄙视]","[晕]","[大兵]","[可怜]","[强]","[弱]","[握手]","[胜利]","[抱拳]","[凋谢]","[米饭]","[蛋糕]","[西瓜]","[啤酒]","[瓢虫]","[勾引]","[OK]","[爱你]","[咖啡]","[月亮]","[刀]","[发抖]","[差劲]","[拳头]","[心碎了]","[太阳]","[礼物]","[皮球]","[骷髅]","[挥手]","[闪电]","[饥饿]","[咒骂]","[折磨]","[抠鼻]","[鼓掌]","[糗大了]","[左哼哼]","[打哈欠]","[快哭了]","[吓]","[篮球]","[乒乓]","[NO]","[跳跳]","[怄火]","[转圈]","[磕头]","[回头]","[跳绳]","[激动]","[街舞]","[献吻]","[左太极]","[右太极]","[闭嘴]","[猫咪]","[红双喜]","[鞭炮]","[红灯笼]","[麻将]","[麦克风]","[礼品袋]","[信封]","[象棋]","[彩带]","[蜡烛]","[爆筋]","[棒棒糖]","[奶瓶]","[面条]","[香蕉]","[飞机]","[左车头]","[车厢]","[右车头]","[多云]","[下雨]","[钞票]","[熊猫]","[灯泡]","[风车]","[闹钟]","[雨伞]","[彩球]","[钻戒]","[沙发]","[纸巾]","[手枪]","[青蛙]"];function Ct(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function It(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ct(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ct(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Pt={name:"message-send-box",props:["scrollMessageListToButtom"],components:{ElPopover:bt.a,ElRadioGroup:gt.a,ElRadio:P.a,ElTooltip:dt.a},data:function(){return{colors:["#99A9BF","#F7BA2A","#FF9900"],messageContent:"",isSendCustomMessage:!1,sendCustomDialogVisible:!1,surveyDialogVisible:!1,form:{data:"",description:"",extension:""},rate:5,suggestion:"",file:"",emojiMap:yt,emojiName:_t,emojiUrl:Ot,showAtGroupMember:!1,atUserID:"",focus:!1}},computed:It(It({},Object(ae["b"])(["toAccount","currentConversationType"])),Object(ae["c"])({memberList:function(e){return e.group.currentMemberList},userID:function(e){return e.user.userID},currentConversation:function(e){return e.conversation.currentConversation}})),mounted:function(){this.$refs["text-input"].addEventListener("paste",this.handlePaste),this.$bus.$on("reEditMessage",this.reEditMessage)},beforeDestroy:function(){this.$refs["text-input"].removeEventListener("paste",this.handlePaste)},methods:{reEditMessage:function(e){this.messageContent=e},handleSelectAtUser:function(){this.messageContent+=this.atUserID+" ",this.showAtGroupMember=!1},handleUp:function(){var e=this,t=this.memberList.findIndex((function(t){return t.userID===e.atUserID}));t-1<0||(this.atUserID=this.memberList[t-1].userID)},handleDown:function(){var e=this,t=this.memberList.findIndex((function(t){return t.userID===e.atUserID}));t+1>=this.memberList.length||(this.atUserID=this.memberList[t+1].userID)},handleEnter:function(){this.showAtGroupMember?this.handleSelectAtUser():this.sendTextMessage()},handleLine:function(){this.messageContent+="\n"},handlePaste:function(e){var t,r=this,n=e.clipboardData;if(n&&n.files&&n.files.length>0&&(t=n.files[0]),"undefined"!==typeof t){var s=this.tim.createImageMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{file:t},onProgress:function(e){r.$set(s,"progress",e)}});this.$store.commit("sendMessage",s);var o=this.tim.sendMessage(s);o.catch((function(e){r.$store.commit("showMessage",{type:"error",message:e.message})}))}},dropHandler:function(e){var t=this;e.preventDefault();var r=e.dataTransfer.files[0],n={};n="video/mp4"===r.type?this.tim.createVideoMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{file:r},onProgress:function(e){t.$set(n,"progress",e)}}):this.tim.createFileMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{file:r},onProgress:function(e){t.$set(n,"progress",e)}}),this.$store.commit("pushCurrentMessageList",n),this.tim.sendMessage(n).then((function(){t.$refs.videoPicker.value=null})).catch((function(e){t.$store.commit("showMessage",{message:e.message,type:"error"})}))},sendTextMessage:function(){if(""===this.messageContent||0===this.messageContent.trim().length)return this.messageContent="",void this.$store.commit("showMessage",{message:"不能发送空消息哦！",type:"info"});var e=parseInt(localStorage.getItem("userID"));console.log("232",this.currentConversation);var t={chatID:this.currentConversation.id,userID:e,content:this.messageContent,type:Ae.TYPES.MSG_TEXT};this.API.sendMessage(t).then((function(e){200==e.code&&console.log("send msg ok200")})),this.$store.commit("sendMessage",""),this.$bus.$emit("scroll-bottom"),this.messageContent=""},chooseEmoji:function(e){this.messageContent+=e},handleSendImageClick:function(){this.$refs.imagePicker.click()},sendImage:function(){var e=this,t=this.tim.createImageMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{file:document.getElementById("imagePicker")},onProgress:function(r){e.$set(t,"progress",r)}});this.$store.commit("pushCurrentMessageList",t),this.tim.sendMessage(t).then((function(){e.$refs.imagePicker.value=null})).catch((function(t){e.$store.commit("showMessage",{message:t.message,type:"error"})}))}}},wt=Pt,Mt=(r("05ca"),Object(Z["a"])(wt,pt,mt,!1,null,"3ccadf29",null)),Et=Mt.exports,jt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"message-wrapper",class:e.messagePosition},[e.currentConversationType===e.TIM.TYPES.CONV_C2C?r("div",{staticClass:"c2c-layout",class:e.messagePosition},[e.showAvatar?r("div",{staticClass:"col-1"},[r("avatar",{attrs:{src:e.avatar}})],1):e._e(),r("div",{staticClass:"col-2"},[r("div",{staticClass:"content-wrapper"},[e.isMine?r("message-status-icon",{attrs:{message:e.message}}):e._e(),e.message.type===e.TIM.TYPES.MSG_TEXT?r("text-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_IMAGE?r("image-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_FILE?r("file-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_SOUND?r("sound-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_GRP_TIP?r("group-tip-element",{attrs:{payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_GRP_SYS_NOTICE?r("group-system-notice-element",{attrs:{payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_CUSTOM?r("custom-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_FACE?r("face-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_VIDEO?r("video-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_GEO?r("geo-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):r("span",[e._v("暂未支持的消息类型："+e._s(e.message.type))])],1),e.showMessageHeader?r("message-footer",{attrs:{message:e.message}}):e._e()],1),r("div",{staticClass:"col-3"})]):e._e(),e.currentConversationType===e.TIM.TYPES.CONV_GROUP?r("div",{staticClass:"group-layout",class:e.messagePosition},[e.showAvatar?r("div",{staticClass:"col-1"},[r("avatar",{staticClass:"group-member-avatar",attrs:{src:e.avatar},nativeOn:{click:function(t){return e.showGroupMemberProfile(t)}}})],1):e._e(),r("div",{staticClass:"col-2"},[e.showMessageHeader?r("message-header",{attrs:{message:e.message}}):e._e(),r("div",{staticClass:"content-wrapper"},[e.isMine?r("message-status-icon",{attrs:{message:e.message}}):e._e(),e.message.type===e.TIM.TYPES.MSG_TEXT?r("text-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_IMAGE?r("image-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_FILE?r("file-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_SOUND?r("sound-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_GRP_TIP?r("group-tip-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_CUSTOM?r("custom-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_FACE?r("face-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_VIDEO?r("video-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_GEO?r("geo-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):r("span",[e._v("暂未支持的消息类型："+e._s(e.message.type))])],1)],1),r("div",{staticClass:"col-3"})]):e._e(),e.currentConversationType===e.TIM.TYPES.CONV_SYSTEM?r("div",{staticClass:"system-layout"},[r("div",{staticClass:"col-1"},[r("avatar",{attrs:{src:e.avatar,type:e.currentConversationType}})],1),r("div",{staticClass:"col-2"},[r("message-header",{attrs:{message:e.message}}),r("group-system-notice-element",{attrs:{payload:e.message.payload,message:e.message}})],1)]):e._e()])},Tt=[],Dt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{class:e.messageIconClass,staticStyle:{width:"16px",height:"16px"},on:{click:e.handleIconClick}},[e._v(e._s("message-send-fail"===e.messageIconClass?"!":""))])},St=[],kt={name:"MessageStatusIcon",props:{message:{type:Object,required:!0}},computed:{messageIconClass:function(){switch(this.message.status){case"unSend":return"el-icon-loading";case"fail":return"message-send-fail";default:return""}}},methods:{handleIconClick:function(){var e=this;"message-send-fail"===this.messageIconClass&&this.tim.resendMessage(this.message).catch((function(t){e.$store.commit("showMessage",{message:t.message,type:"error"})}))}}},xt=kt,Lt=(r("a86b"),Object(Z["a"])(xt,Dt,St,!1,null,"97210bde",null)),Rt=Lt.exports,At=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"base",class:[e.isMine?"right":"left"]},[r("div",{staticClass:"name text-ellipsis"},[e._v(e._s(e.from))]),r("div",{staticClass:"date"},[e._v(e._s(e.date))])])},Nt=[],Gt=r("5a0c"),Ut=r.n(Gt);function $t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ft(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$t(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Bt={name:"MessageHeader",props:{message:{type:Object,required:!0}},computed:Ft(Ft({},Object(ae["c"])({currentConversation:function(e){return e.conversation.currentConversation},currentUserProfile:function(e){return e.user.currentUserProfile},currentMemberList:function(e){return e.group.currentMemberList}})),{},{date:function(){return Ut()(this.message.time).format("YYYY-MM-DD HH:mm:ss")},from:function(){return this.currentConversation.type===this.TIM.TYPES.CONV_SYSTEM?"群系统通知":this.message.userInfo.Name},isMine:function(){return"out"===this.message.flow}})},Yt=Bt,Vt=(r("5e1b"),Object(Z["a"])(Yt,At,Nt,!1,null,"28bddacf",null)),qt=Vt.exports,Ht=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"base",class:[e.isMine?"right":"left"]},[r("div",{staticClass:"date"},[e._v(e._s(e.date))])])},Kt=[];function zt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",r=e.getFullYear(),n=e.getMonth()+1,s=e.getDate();return"".concat(r).concat(t).concat(Qt(n)).concat(t).concat(Qt(s))}function Wt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.getHours(),n=e.getMinutes(),s=e.getSeconds();return t?"".concat(Qt(r),":").concat(Qt(n),":").concat(Qt(s)):"".concat(r,":").concat(Qt(n))}function Jt(e){return"".concat(zt(e)," ").concat(Wt(e))}function Qt(e){return e<10?"0".concat(e):e}function Zt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Xt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Zt(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var er={name:"MessageFooter",props:{message:{type:Object,required:!0}},computed:Xt(Xt({},Object(ae["c"])({currentConversation:function(e){return e.conversation.currentConversation},currentUserProfile:function(e){return e.user.currentUserProfile},currentMemberList:function(e){return e.group.currentMemberList}})),{},{date:function(){return Ut()(this.message.createdAt).format("YYYY-MM-DD HH:mm:ss")},from:function(){var e=this.currentConversation.type===this.TIM.TYPES.CONV_C2C;return this.isMine?this.currentUserProfile.nick||this.currentUserProfile.userID:e?this.currentConversation.userProfile.nick||this.currentConversation.userProfile.userID:this.message.nick||this.message.from},isMine:function(){return"out"===this.message.flow}})},tr=er,rr=(r("597a"),Object(Z["a"])(tr,Ht,Kt,!1,null,"cd918394",null)),nr=rr.exports,sr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[r("div",{staticClass:"file-element-wrapper",attrs:{title:"单击下载"},on:{click:e.downloadFile}},[r("div",{staticClass:"header"},[r("i",{staticClass:"el-icon-document file-icon"}),r("div",{staticClass:"file-element"},[r("span",{staticClass:"file-name"},[e._v(e._s(e.fileName))]),r("span",{staticClass:"file-size"},[e._v(e._s(e.size))])])]),e.showProgressBar?r("el-progress",{attrs:{percentage:e.percentage,color:function(e){return 100===e?"#67c23a":"#409eff"}}}):e._e()],1)])},or=[],ir=(r("6b30"),r("c284")),ar=r.n(ir),cr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"chat-bubble",on:{mousedown:function(e){e.stopPropagation()},contextmenu:function(e){e.preventDefault()}}},[e.message.isRevoked?e._e():r("el-dropdown",{ref:"dropdown",attrs:{trigger:""},on:{command:e.handleCommand}},[r("div",{staticStyle:{display:"flex"}},[e.isMine?r("div",{staticClass:"message-status"},[r("span",[e._v(e._s(e.messageReadByPeer))])]):e._e(),r("div",{staticClass:"message-content",class:e.bubbleStyle},[e._t("default")],2)]),r("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e.isMine?r("el-dropdown-item",{attrs:{command:"revoke"}},[e._v("撤回")]):e._e()],1)],1),e.message.isRevoked?r("div",{staticClass:"group-tip-element-wrapper"},[e._v("\n    "+e._s(e.text)+"\n    "),r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isEdit,expression:"isEdit"}],staticClass:"edit-button",attrs:{type:"text",size:"mini"},on:{click:e.reEdit}},[e._v(" 重新编辑")])],1):e._e()],1)},ur=[],lr={name:"MessageBubble",data:function(){return{isTimeout:!1}},props:{isMine:{type:Boolean},isNew:{type:Boolean},message:{type:Object,required:!0}},created:function(){this.isTimeoutHandler()},mounted:function(){this.$refs.dropdown&&this.$refs.dropdown.$el&&this.$refs.dropdown.$el.addEventListener("mousedown",this.handleDropDownMousedown)},beforeDestroy:function(){this.$refs.dropdown&&this.$refs.dropdown.$el&&this.$refs.dropdown.$el.removeEventListener("mousedown",this.handleDropDownMousedown)},computed:{bubbleStyle:function(){var e="";return this.isMine?e+="message-send":e+="message-received",this.isNew&&(e+="new"),e},text:function(){return this.message.conversationType!==this.TIM.TYPES.CONV_C2C||this.isMine?this.message.conversationType!==this.TIM.TYPES.CONV_GROUP||this.isMine?"你撤回了一条消息":"".concat(this.message.from,"撤回了一条消息"):"对方撤回了一条消息"},messageReadByPeer:function(){return""},isEdit:function(){return!!this.isMine&&(this.message.type===this.TIM.TYPES.MSG_TEXT&&!this.isTimeout)}},methods:{handleDropDownMousedown:function(e){this.isMine&&!this.isTimeout&&2===e.buttons&&(this.$refs.dropdown.visible?this.$refs.dropdown.hide():this.$refs.dropdown.show())},handleCommand:function(e){var t=this;switch(e){case"revoke":this.tim.revokeMessage(this.message).then((function(){t.isTimeoutHandler()})).catch((function(e){t.$store.commit("showMessage",{message:e,type:"warning"})}));break;case"delete":break;default:break}},isTimeoutHandler:function(){var e=new Date;parseInt(e.getTime()/1e3)-this.message.time>120?this.isTimeout=!0:setTimeout(this.isTimeoutHandler,1e3)},reEdit:function(){this.$bus.$emit("reEditMessage",this.message.payload.text)}}},pr=lr,mr=(r("d6a4"),Object(Z["a"])(pr,cr,ur,!1,null,"79e622aa",null)),fr=mr.exports,dr={name:"FileElement",props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},components:{MessageBubble:fr,ElProgress:ar.a},computed:{fileName:function(){return this.payload.fileName},fileUrl:function(){return this.payload.fileUrl},size:function(){var e=this.payload.fileSize;return e>1024?e/1024>1024?"".concat(this.toFixed(e/1024/1024)," Mb"):"".concat(this.toFixed(e/1024)," Kb"):"".concat(this.toFixed(e),"B")},showProgressBar:function(){return"unSend"===this.$parent.message.status},percentage:function(){return Math.floor(100*(this.$parent.message.progress||0))}},methods:{toFixed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return e.toFixed(t)},downloadFile:function(){var e=this;if(window.fetch)fetch(this.fileUrl).then((function(e){return e.blob()})).then((function(t){var r=document.createElement("a"),n=window.URL.createObjectURL(t);r.href=n,r.download=e.fileName,r.click()}));else{var t=document.createElement("a");t.href=this.fileUrl,t.target="_blank",t.download=this.filename,t.click()}}}},hr=dr,gr=(r("4d06"),Object(Z["a"])(hr,sr,or,!1,null,"96091f5a",null)),vr=gr.exports,br=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[r("div",{staticClass:"face-element-wrapper"},[r("img",{attrs:{src:e.url}})])])},Or=[],yr={name:"FaceElement",props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},components:{MessageBubble:fr},computed:{url:function(){var e="";return e=this.payload.data.indexOf("@2x")>0?this.payload.data:this.payload.data+"@2x","https://imgcache.qq.com/open/qcloud/tim/assets/face-elem/".concat(e,".png")}}},_r=yr,Cr=(r("ce0c"),Object(Z["a"])(_r,br,Or,!1,null,"0ef044da",null)),Ir=Cr.exports,Pr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[r("img",{staticClass:"image-element",attrs:{src:e.imageUrl},on:{load:e.onImageLoaded,click:e.handlePreview}}),e.showProgressBar?r("el-progress",{attrs:{percentage:e.percentage,color:function(e){return 100===e?"#67c23a":"#409eff"}}}):e._e()],1)},wr=[];function Mr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Er(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Mr(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var jr={name:"ImageElemnt",props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},components:{MessageBubble:fr,ElProgress:ar.a},computed:Er(Er({},Object(ae["b"])(["imgUrlList"])),{},{imageUrl:function(){var e=this.payload.imageInfoArray[0].url||this.payload.imageInfoArray[0].URL;return"string"!==typeof e?"":"//"===e.slice(0,2)?"https:".concat(e):e},showProgressBar:function(){return"unSend"===this.$parent.message.status},percentage:function(){return Math.floor(100*(this.$parent.message.progress||0))}}),methods:{onImageLoaded:function(e){console.log("onImageLoaded",e),this.$bus.$emit("image-loaded",e)},handlePreview:function(){this.$bus.$emit("image-preview",{url:this.payload.imageInfoArray[0].url||this.payload.imageInfoArray[0].URL,urlList:this.imgUrlList})}}},Tr=jr,Dr=(r("ce90"),Object(Z["a"])(Tr,Pr,wr,!1,null,"393220d3",null)),Sr=Dr.exports,kr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[e._l(e.contentList,(function(t,n){return["text"===t.name?r("span",{key:n},[e._v(e._s(t.text))]):"img"===t.name?r("img",{key:n,attrs:{src:t.src,width:"20px",height:"20px"}}):e._e()]}))],2)},xr=[];function Lr(e){var t=[],r=e.text,n=-1,s=-1;while(""!==r)switch(n=r.indexOf("["),s=r.indexOf("]"),n){case 0:if(-1===s)t.push({name:"text",text:r}),r="";else{var o=r.slice(0,s+1);yt[o]?(t.push({name:"img",src:Ot+yt[o]}),r=r.substring(s+1)):(t.push({name:"text",text:"["}),r=r.slice(1))}break;case-1:t.push({name:"text",text:r}),r="";break;default:t.push({name:"text",text:r.slice(0,n)}),r=r.substring(n);break}return t}var Rr={name:"TextElement",components:{MessageBubble:fr},props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},computed:{contentList:function(){return Lr(this.payload)}}},Ar=Rr,Nr=(r("e6da"),Object(Z["a"])(Ar,kr,xr,!1,null,"748a76fd",null)),Gr=Nr.exports,Ur=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[r("div",{staticClass:"sound-element-wrapper",attrs:{title:"单击播放"},on:{click:e.play}},[r("i",{staticClass:"iconfont icon-voice"}),e._v("\n    "+e._s(e.second+'"')+"\n  ")])])},$r=[],Fr={name:"SoundElement",props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},components:{MessageBubble:fr},data:function(){return{amr:null}},computed:{url:function(){return this.payload.url},size:function(){return this.payload.size},second:function(){return this.payload.second}},methods:{play:function(){var e=document.createElement("audio");e.addEventListener("error",this.tryPlayAMR),e.src=this.url;var t=e.play();t&&t.catch((function(){}))},tryPlayAMR:function(){try{var e=/MSIE|Trident|Edge/.test(window.navigator.userAgent);if(e)return void this.$store.commit("showMessage",{message:"您的浏览器不支持该格式的语音消息播放，请尝试更换浏览器，建议使用：谷歌浏览器",type:"warning"});if(!window.BenzAMRRecorder){var t=document.createElement("script");t.addEventListener("load",this.playAMR),t.src="./BenzAMRRecorder.js";var r=document.getElementsByTagName("script")[0];return void r.parentNode.insertBefore(t,r)}this.playAMR()}catch(n){this.$store.commit("showMessage",{message:"您的浏览器不支持该格式的语音消息播放，请尝试更换浏览器，建议使用：谷歌浏览器",type:"warning"})}},playAMR:function(){var e=this;!this.amr&&window.BenzAMRRecorder&&(this.amr=new window.BenzAMRRecorder),this.amr.isInit()?this.amr.play():this.amr.initWithUrl(this.url).then((function(){e.amr.play()}))}}},Br=Fr,Yr=(r("777c"),Object(Z["a"])(Br,Ur,$r,!1,null,"7ab0530b",null)),Vr=Yr.exports,qr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[r("video",{staticClass:"video",attrs:{src:e.payload.videoUrl,controls:""},on:{error:e.videoError}}),e.showProgressBar?r("el-progress",{attrs:{percentage:e.percentage,color:function(e){return 100===e?"#67c23a":"#409eff"}}}):e._e()],1)},Hr=[],Kr={name:"VideoElement",components:{MessageBubble:fr,ElProgress:ar.a},props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},computed:{showProgressBar:function(){return"unSend"===this.message.status},percentage:function(){return Math.floor(100*(this.$parent.message.progress||0))}},methods:{videoError:function(e){this.$store.commit("showMessage",{type:"error",message:"视频出错，错误原因："+e.target.error.message})}}},zr=Kr,Wr=(r("e3ec"),Object(Z["a"])(zr,qr,Hr,!1,null,"6237ab78",null)),Jr=Wr.exports,Qr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"group-tip-element-wrapper"},[e._v(e._s(e.text))])},Zr=[];r("ac4d"),r("8a81"),r("5df3"),r("1c4c"),r("7f7f"),r("6b54");function Xr(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=en(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,s=function(){};return{s:s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){a=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw o}}}}function en(e,t){if(e){if("string"===typeof e)return tn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?tn(e,t):void 0}}function tn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var rn={name:"GroupTipElement",props:{payload:{type:Object,required:!0},message:{type:Object,required:!1}},computed:{text:function(){return this.getGroupTipContent(this.message)}},methods:{getGroupTipContent:function(e){var t=e.nick||e.payload.userIDList.join(",");switch(e.payload.operationType){case this.TIM.TYPES.GRP_TIP_MBR_JOIN:return"群成员：".concat(t," 加入群组");case this.TIM.TYPES.GRP_TIP_MBR_QUIT:return"群成员：".concat(t," 退出群组");case this.TIM.TYPES.GRP_TIP_MBR_KICKED_OUT:return"群成员：".concat(t," 被").concat(e.payload.operatorID,"踢出群组");case this.TIM.TYPES.GRP_TIP_MBR_SET_ADMIN:return"群成员：".concat(t," 成为管理员");case this.TIM.TYPES.GRP_TIP_MBR_CANCELED_ADMIN:return"群成员：".concat(t," 被撤销管理员");case this.TIM.TYPES.GRP_TIP_GRP_PROFILE_UPDATED:return"群资料修改";case this.TIM.TYPES.GRP_TIP_MBR_PROFILE_UPDATED:var r,n=Xr(e.payload.memberList);try{for(n.s();!(r=n.n()).done;){var s=r.value;return s.muteTime>0?"群成员：".concat(s.userID,"被禁言").concat(s.muteTime,"秒"):"群成员：".concat(s.userID,"被取消禁言")}}catch(o){n.e(o)}finally{n.f()}break;default:return"[群提示消息]"}}}},nn=rn,sn=(r("9668"),Object(Z["a"])(nn,Qr,Zr,!1,null,"746f4cdc",null)),on=sn.exports,an=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("message-bubble",{attrs:{isMine:!1,message:e.message}},[r("div",{staticClass:"group-system-element-wrapper"},[e._v("\n    "+e._s(e.text)+"\n    "),e.isJoinGroupRequest?r("el-button",{attrs:{type:"text"},on:{click:function(t){e.showDialog=!0}}},[e._v("处理")]):e._e(),r("el-dialog",{attrs:{title:"处理加群申请",visible:e.showDialog,width:"30%"},on:{"update:visible":function(t){e.showDialog=t}}},[r("el-form",{ref:"form",attrs:{"label-width":"100px"},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}},[r("el-form-item",{attrs:{label:"处理结果："}},[r("el-radio-group",{model:{value:e.form.handleAction,callback:function(t){e.$set(e.form,"handleAction",t)},expression:"form.handleAction"}},[r("el-radio",{attrs:{label:"Agree"}},[e._v("同意")]),r("el-radio",{attrs:{label:"Reject"}},[e._v("拒绝")])],1)],1),r("el-form-item",{attrs:{label:"附言："}},[r("el-input",{attrs:{type:"textarea",resize:"none",rows:3,placeholder:"请输入附言"},model:{value:e.form.handleMessage,callback:function(t){e.$set(e.form,"handleMessage",t)},expression:"form.handleMessage"}})],1)],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.showDialog=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.handleGroupApplication}},[e._v("确 定")])],1)],1)],1)])},cn=[],un=(r("425f"),r("4105")),ln=r.n(un);function pn(e){var t=e.payload.groupProfile.name||e.payload.groupProfile.groupID;switch(e.payload.operationType){case 1:return"".concat(e.payload.operatorID," 申请加入群组：").concat(t);case 2:return"成功加入群组：".concat(t);case 3:return"申请加入群组：".concat(t,"被拒绝");case 4:return"你被管理员".concat(e.payload.operatorID,"踢出群组：").concat(t);case 5:return"群：".concat(t," 已被").concat(e.payload.operatorID,"解散");case 6:return"".concat(e.payload.operatorID,"创建群：").concat(t);case 7:return"".concat(e.payload.operatorID,"邀请你加群：").concat(t);case 8:return"你退出群组：".concat(t);case 9:return"你被".concat(e.payload.operatorID,"设置为群：").concat(t,"的管理员");case 10:return"你被".concat(e.payload.operatorID,"撤销群：").concat(t,"的管理员身份");case 255:return"自定义群系统通知: "+e.payload.userDefinedField}}var mn={name:"GroupSystemNoticeElement",props:{payload:{type:Object,required:!0},message:{type:Object,required:!1}},components:{ElDialog:g.a,ElForm:ln.a,ElFormItem:s.a,ElRadioGroup:gt.a,ElRadio:P.a,MessageBubble:fr},data:function(){return{showDialog:!1,form:{handleAction:"Agree",handleMessage:""}}},computed:{text:function(){return pn(this.message)},title:function(){return this.message.type===this.TIM.TYPES.MSG_GRP_SYS_NOTICE?"群系统通知":"系统通知"},isJoinGroupRequest:function(){return 1===this.payload.operationType}},methods:{handleGroupApplication:function(){var e=this;this.tim.handleGroupApplication({handleAction:this.form.handleAction,handleMessage:this.form.handleMessage,message:this.message}).then((function(){e.showDialog=!1,e.$store.commit("removeMessage",e.message)})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message}),e.showDialog=!1}))}}},fn=mn,dn=(r("4011"),Object(Z["a"])(fn,an,cn,!1,null,"8a49ee1a",null)),hn=dn.exports,gn=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[r("div",{staticClass:"custom-element-wrapper"},["survey"===this.payload.data?r("div",{staticClass:"survey"},[r("div",{staticClass:"title"},[e._v("对IM DEMO的评分和建议")]),r("el-rate",{attrs:{disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value}"},model:{value:e.rate,callback:function(t){e.rate=t},expression:"rate"}}),r("div",{staticClass:"suggestion"},[e._v(e._s(this.payload.extension))])],1):r("span",{staticClass:"text",attrs:{title:"您可以自行解析自定义消息"}},[e._v(e._s(e.text))])])])},vn=[],bn=(r("78a7"),r("33ca")),On=r.n(bn),yn={VIDEO_CALL_ACTION_ERROR:-2,VIDEO_CALL_ACTION_UNKNOWN:-1,VIDEO_CALL_ACTION_DIALING:0,VIDEO_CALL_ACTION_SPONSOR_CANCEL:1,VIDEO_CALL_ACTION_REJECT:2,VIDEO_CALL_ACTION_SPONSOR_TIMEOUT:3,VIDEO_CALL_ACTION_ACCEPTED:4,VIDEO_CALL_ACTION_HANGUP:5,VIDEO_CALL_ACTION_LINE_BUSY:6};function _n(e){return e<10?"0".concat(e):e}function Cn(e){if(e<60)return"00:00:".concat(_n(e));if(e<3600){var t=parseInt(e/60),r=e-60*t;return"00:".concat(_n(t),":").concat(_n(r))}var n=parseInt(e/3600),s=e-3600*n,o=parseInt(s/60),i=s-60*o;return"".concat(_n(n),":").concat(_n(o),":").concat(_n(i))}var In={name:"CustomElement",props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},components:{MessageBubble:fr,ElRate:On.a},computed:{text:function(){return this.translateCustomMessage(this.payload)},rate:function(){return parseInt(this.payload.description)}},methods:{translateCustomMessage:function(e){var t={};try{t=JSON.parse(e.data)}catch(r){t={}}if("group_create"===e.data)return"".concat(e.extension);switch(t.action){case yn.VIDEO_CALL_ACTION_DIALING:return"[请求通话]";case yn.VIDEO_CALL_ACTION_SPONSOR_CANCEL:return"[取消通话]";case yn.VIDEO_CALL_ACTION_REJECT:return"[拒绝通话]";case yn.VIDEO_CALL_ACTION_SPONSOR_TIMEOUT:return"[无应答]";case yn.VIDEO_CALL_ACTION_ACCEPTED:return"[开始通话]";case yn.VIDEO_CALL_ACTION_HANGUP:return"[结束通话，通话时长：".concat(Cn(t.duration),"]");case yn.VIDEO_CALL_ACTION_LINE_BUSY:return"[正在通话中]";case yn.VIDEO_CALL_ACTION_ERROR:return"[设备异常]";default:return"[自定义消息]"}}}},Pn=In,wn=(r("014d"),Object(Z["a"])(Pn,gn,vn,!1,null,"5b9b8f35",null)),Mn=wn.exports,En=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[r("a",{staticClass:"geo-element",attrs:{href:e.href,target:"_blank",title:"点击查看详情"}},[r("span",{staticClass:"el-icon-location-outline"},[e._v(e._s(e.payload.description))]),r("img",{attrs:{src:e.url}})])])},jn=[],Tn={name:"GeoElement",components:{MessageBubble:fr},props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},data:function(){return{url:""}},computed:{lon:function(){return this.payload.longitude.toFixed(6)},lat:function(){return this.payload.latitude.toFixed(6)},href:function(){return"https://map.qq.com/?type=marker&isopeninfowin=1&markertype=1&pointx=".concat(this.lon,"&pointy=").concat(this.lat,"&name=").concat(this.payload.description)}},mounted:function(){this.url="https://apis.map.qq.com/ws/staticmap/v2/?center=".concat(this.lat,",").concat(this.lon,"&zoom=10&size=300*150&maptype=roadmap&markers=size:large|color:0xFFCCFF|label:k|").concat(this.lat,",").concat(this.lon,"&key=UBNBZ-PTP3P-TE7DB-LHRTI-Y4YLE-VWBBD")}},Dn=Tn,Sn=(r("daca"),Object(Z["a"])(Dn,En,jn,!1,null,"58085edc",null)),kn=Sn.exports;function xn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ln(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?xn(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Rn={name:"MessageItem",props:{message:{type:Object,required:!0}},components:{MessageHeader:qt,MessageFooter:nr,MessageStatusIcon:Rt,FileElement:vr,FaceElement:Ir,ImageElement:Sr,TextElement:Gr,SoundElement:Vr,GroupTipElement:on,GroupSystemNoticeElement:hn,CustomElement:Mn,VideoElement:Jr,GeoElement:kn},data:function(){return{renderDom:[]}},computed:Ln(Ln({},Object(ae["c"])({currentConversation:function(e){return e.conversation.currentConversation},currentUserProfile:function(e){return e.user}})),{},{showAvatar:function(){return"C2C"===this.currentConversation.type&&!this.message.isRevoked||"GROUP"===this.currentConversation.type&&!this.message.isRevoked&&this.message.type!==this.TIM.TYPES.MSG_GRP_TIP},avatar:function(){return"C2C"===this.currentConversation.type?this.isMine?this.currentUserProfile.avatar:this.currentConversation.userProfile.avatar:"GROUP"===this.currentConversation.type?this.isMine?this.currentUserProfile.avatar:this.message.userInfo.Avatar:""},currentConversationType:function(){return this.currentConversation.type},isMine:function(){return"out"===this.message.flow},messagePosition:function(){return["TIMGroupTipElem","TIMGroupSystemNoticeElem"].includes(this.message.type)||this.message.isRevoked?"position-center":(console.log("this.isMine",this.isMine),this.isMine?"position-right":"position-left")},showMessageHeader:function(){return!["TIMGroupTipElem","TIMGroupSystemNoticeElem"].includes(this.message.type)&&!this.message.isRevoked}}),methods:{showGroupMemberProfile:function(e){var t=this;this.tim.getGroupMemberProfile({groupID:this.message.to,userIDList:[this.message.from]}).then((function(r){var n=r.data.memberList;n[0]&&t.$bus.$emit("showMemberProfile",{event:e,member:n[0]})}))}}},An=Rn,Nn=(r("6160"),Object(Z["a"])(An,jt,Tt,!1,null,"2833c309",null)),Gn=Nn.exports,Un=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"conversation-item-container",class:{choose:e.conversation.conversationID===e.currentConversation.conversationID},on:{click:e.selectConversation}},[r("div",{staticClass:"warp"},[r("avatar",{attrs:{src:e.avatar,type:e.conversation.type}}),r("div",{staticClass:"content"},[r("div",{staticClass:"row-1"},[r("div",{staticClass:"name"},[r("div",{staticClass:"text-ellipsis"},[e.conversation.type===e.TIM.TYPES.CONV_C2C?r("span",{attrs:{title:e.conversation.userProfile.nick||e.conversation.userProfile.userID}},[e._v(e._s(e.conversation.userProfile.nick||e.conversation.userProfile.userID)+"\n            ")]):e._e(),e.conversation.type===e.TIM.TYPES.CONV_GROUP?r("span",{attrs:{title:e.conversation.groupProfile.nick||e.conversation.groupProfile.userID}},[e._v(e._s(e.conversation.groupProfile.nick||e.conversation.groupProfile.userID)+"\n            ")]):e._e()])]),r("div",{staticClass:"unread-count"},[e.showUnreadCount?r("span",{staticClass:"badge"},[e._v("\n            "+e._s(e.conversation.unreadCount>99?"99+":e.conversation.unreadCount)+"\n          ")]):e._e()])]),r("div",{staticClass:"row-2"},[r("div",{staticClass:"summary"},[e.conversation.lastMessage.ChatID?r("div",{staticClass:"text-ellipsis"},[r("span",{staticClass:"text",attrs:{title:e.conversation.lastMessage.messageForShow}},[e._v("\n              "+e._s(e.messageForShow)+"\n            ")])]):e._e()]),r("div",{staticClass:"date"},[e._v("\n          "+e._s(e.date)+"\n        ")])])])],1)])},$n=[];function Fn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Bn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Fn(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Yn={name:"conversation-item",props:["conversation"],data:function(){return{popoverVisible:!1,hasMessageAtMe:!1}},computed:Bn(Bn({showUnreadCount:function(){return(this.$store.getters.hidden||this.currentConversation.conversationID!==this.conversation.conversationID)&&this.conversation.unreadCount>0},date:function(){return Ut()(this.conversation.lastMessage.CreatedAt).format("MM-DD HH:mm")},avatar:function(){return this.conversation.type===TIM.TYPES.CONV_C2C&&this.conversation.userProfile?this.conversation.userProfile.avatar:this.conversation.type===TIM.TYPES.CONV_GROUP&&this.conversation.groupProfile?this.conversation.groupProfile.avatar:""},conversationName:function(){return this.conversation.type===TIM.TYPES.CONV_C2C&&this.conversation.userProfile?this.conversation.userProfile.nick:this.conversation.type===TIM.TYPES.CONV_GROUP&&this.conversation.groupProfile?this.conversation.groupProfile.nick:""},messageForShow:function(){return this.conversation.lastMessage.Content}},Object(ae["c"])({currentConversation:function(e){return e.conversation.currentConversation},currentUserProfile:function(e){return e.user.currentUserProfile}})),Object(ae["b"])(["toAccount"])),mounted:function(){var e=this;this.$bus.$on("new-messsage-at-me",(function(t){t.data.conversationID===e.conversation.conversationID&&e.conversation.conversationID!==e.currentConversation.conversationID&&(e.hasMessageAtMe=!0)}))},methods:{forkConversation:function(e){e.stopPropagation(),console.log("forkConversation"),this.$store.dispatch("forkConversation",{conversationID:this.conversation.conversationID,isFork:this.conversation.isFork})},selectConversation:function(){this.conversation.conversationID!==this.currentConversation.conversationID&&this.$store.dispatch("checkoutConversation",this.conversation.conversationID)},deleteConversation:function(e){var t=this;e.stopPropagation(),this.tim.deleteConversation(this.conversation.conversationID).then((function(){t.$store.commit("showMessage",{message:"会话【".concat(t.conversationName,"】删除成功!"),type:"success"}),t.popoverVisible=!1,t.$store.commit("resetCurrentConversation")})).catch((function(e){t.$store.commit("showMessage",{message:"会话【".concat(t.conversationName,"】删除失败!, error=").concat(e.message),type:"error"}),t.popoverVisible=!1}))},showContextMenu:function(){this.popoverVisible=!0}},watch:{}},Vn=Yn,qn=(r("e225"),Object(Z["a"])(Vn,Un,$n,!1,null,"712035f8",null)),Hn=qn.exports,Kn=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"conversation-profile-wrapper"},[e.currentConversation.type===e.TIM.TYPES.CONV_C2C?r("user-profile",{attrs:{userProfile:e.currentConversation.userProfile}}):e.currentConversation.type===e.TIM.TYPES.CONV_GROUP?r("group-profile",{attrs:{groupProfile:e.currentConversation.groupProfile}}):e._e()],1)},zn=[],Wn=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"group-profile"},[r("div",{staticClass:"item"},[r("span",{attrs:{title:e.groupProfile.nick}},[e._v("\n      群名"),r("i",{staticClass:"el-icon-s-flag"}),e._v("："+e._s(e.groupProfile.nick)+"\n    ")])]),r("div",{staticClass:"item"},[e._v("\n    成员"),r("i",{staticClass:"el-icon-user-solid"}),e._v("："+e._s(e.groupProfile.memberNum)+"\n  ")]),r("div",{staticClass:"item"},[e._v("\n    简介"),r("i",{staticClass:"el-icon-chat-dot-square"}),e._v("："+e._s(e.groupProfile.intro)+"\n  ")]),r("group-member-list",{attrs:{groupProfile:e.groupProfile}}),e._e()],1)},Jn=[],Qn=(r("e960"),r("b35b")),Zn=r.n(Qn),Xn=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"group-member-list-wrapper"},[r("div",{staticClass:"header"},[r("popover",{model:{value:e.addGroupMemberVisible,callback:function(t){e.addGroupMemberVisible=t},expression:"addGroupMemberVisible"}},[r("add-group-member"),r("div",{staticClass:"btn-add-member",attrs:{slot:"reference",title:"添加群成员"},slot:"reference"},[r("span",{staticClass:"tim-icon-friend-add"})])],1)],1),r("div",{staticClass:"scroll-content"},[r("div",{staticClass:"group-member-list"},e._l(e.members,(function(t){return r("div",{key:t.UserID},[r("popover",{key:t.UserID,attrs:{placement:"right"}},[r("group-member-info",{attrs:{member:t}}),r("div",{staticClass:"group-member",attrs:{slot:"reference"},on:{click:function(r){e.currentMemberID=t.UserID}},slot:"reference"},[r("avatar",{class:{filter:!t.IsOnline},attrs:{title:e.getGroupMemberAvatarText(t.role),src:t.Avatar}}),r("div",{staticClass:"member-name text-ellipsis"},[t.nameCard?r("span",{attrs:{title:t.nameCard}},[e._v(e._s(t.nameCard))]):t.Name?r("span",{attrs:{title:t.Name}},[e._v(e._s(t.Name))]):r("span",{attrs:{title:t.userID}},[e._v(e._s(t.UserID))])]),t.IsMaster?r("i",{staticClass:"el-icon-user-solid",staticStyle:{color:"gold"}}):r("i",{staticClass:"el-icon-user-solid"})],1)],1)],1)})),0)]),r("div",{staticClass:"more"},[e.showLoadMore?r("el-button",{attrs:{type:"text"},on:{click:e.loadMore}},[e._v("查看更多")]):e._e()],1)])},es=[],ts=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-input",{attrs:{placeholder:"输入userID后 按回车键"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addGroupMember(t)}},model:{value:e.userID,callback:function(t){e.userID=t},expression:"userID"}})],1)},rs=[];function ns(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ss(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ns(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ns(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var os={components:{ElInput:A.a},data:function(){return{userID:""}},computed:ss({},Object(ae["c"])({currentConversation:function(e){return e.conversation.currentConversation}})),methods:{addGroupMember:function(){var e=this,t=this.currentConversation.conversationID.replace("GROUP","");this.tim.addGroupMember({groupID:t,userIDList:[this.userID]}).then((function(r){var n=r.data,s=n.successUserIDList,o=n.failureUserIDList,i=n.existedUserIDList;s.length>0&&(e.$store.commit("showMessage",{message:"群成员：".concat(s.join(","),"，加群成功"),type:"success"}),e.tim.getGroupMemberProfile({groupID:t,userIDList:s}).then((function(t){var r=t.data.memberList;e.$store.commit("updateCurrentMemberList",r)}))),o.length>0&&e.$store.commit("showMessage",{message:"群成员：".concat(o.join(","),"，添加失败！"),type:"error"}),i.length>0&&e.$store.commit("showMessage",{message:"群成员：".concat(i.join(","),"，已在群中")})})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))}}},is=os,as=Object(Z["a"])(is,ts,rs,!1,null,"5d05f520",null),cs=as.exports,us=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",[r("span",{staticClass:"label"},[e._v("userID:")]),e._v("\n    "+e._s(e.member.userID)+"\n    "),e.showCancelBan?r("el-button",{attrs:{type:"text"},on:{click:e.cancelMute}},[e._v("取消禁言")]):e._e(),r("el-popover",{directives:[{name:"show",rawName:"v-show",value:e.showBan,expression:"showBan"}],attrs:{title:"禁言"},model:{value:e.popoverVisible,callback:function(t){e.popoverVisible=t},expression:"popoverVisible"}},[r("el-input",{attrs:{placeholder:"请输入禁言时间"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.setGroupMemberMuteTime(t)}},model:{value:e.muteTime,callback:function(t){e.muteTime=t},expression:"muteTime"}}),r("el-button",{staticStyle:{color:"red"},attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("禁言")])],1)],1),r("div",[r("span",{staticClass:"label"},[e._v("nick:")]),e._v("\n    "+e._s(e.member.nick||"暂无")+"\n  ")]),r("div",[r("span",{staticClass:"label"},[e._v("nameCard:")]),e._v("\n    "+e._s(e.member.nameCard||"暂无")+"\n    "),r("el-popover",{directives:[{name:"show",rawName:"v-show",value:e.showEditNameCard,expression:"showEditNameCard"}],attrs:{title:"修改群名片"},model:{value:e.nameCardPopoverVisible,callback:function(t){e.nameCardPopoverVisible=t},expression:"nameCardPopoverVisible"}},[r("el-input",{attrs:{placeholder:"请输入群名片"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.setGroupMemberNameCard(t)}},model:{value:e.nameCard,callback:function(t){e.nameCard=t},expression:"nameCard"}}),r("i",{staticClass:"el-icon-edit",staticStyle:{cursor:"pointer","font-size":"1.6rem"},attrs:{slot:"reference",title:"修改群名片"},slot:"reference"})],1)],1),r("div",[r("span",{staticClass:"label"},[e._v("role:")]),r("span",{staticClass:"content role",attrs:{title:e.changeRoleTitle}},[e._v(e._s(e.member.role))])]),e.showMuteUntil?r("div",[r("span",{staticClass:"label"},[e._v("禁言至:")]),r("span",{staticClass:"content"},[e._v(e._s(e.muteUntil))])]):e._e(),e.canChangeRole?r("el-button",{attrs:{type:"text"},on:{click:e.changeMemberRole}},[e._v("\n    "+e._s("Admin"===e.member.role?"取消管理员":"设为管理员")+"\n  ")]):e._e(),e.showKickout?r("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:e.kickoutGroupMember}},[e._v("踢出群组")]):e._e()],1)},ls=[];r("c5f6");function ps(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ms(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ps(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ps(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var fs={components:{ElPopover:bt.a},props:["member"],data:function(){return{muteTime:"",popoverVisible:!1,nameCardPopoverVisible:!1,nameCard:this.member.nameCard}},computed:ms(ms({},Object(ae["c"])({currentConversation:function(e){return e.conversation.currentConversation},currentUserProfile:function(e){return e.user.currentUserProfile},current:function(e){return e.current}})),{},{showKickout:function(){return(this.isOwner||this.isAdmin)&&!this.isMine},isOwner:function(){return!1},isAdmin:function(){return!1},isMine:function(){return this.currentUserProfile.userID===this.member.userID},canChangeRole:function(){return this.isOwner&&["ChatRoom","Public"].includes(this.currentConversation.subType)},changeRoleTitle:function(){},showMuteUntil:function(){return 1e3*this.member.muteUntil>this.current},showCancelBan:function(){return!(!this.showMuteUntil||this.currentConversation.type!==this.TIM.TYPES.CONV_GROUP||this.isMine)&&(this.isOwner||this.isAdmin)},showBan:function(){return this.currentConversation.type===this.TIM.TYPES.CONV_GROUP&&(this.isOwner||this.isAdmin)},showEditNameCard:function(){return this.isOwner||this.isAdmin},muteUntil:function(){return Jt(new Date(1e3*this.member.muteUntil))}}),methods:{kickoutGroupMember:function(){var e=this;this.tim.deleteGroupMember({groupID:this.currentConversation.groupProfile.groupID,reason:"我要踢你出群",userIDList:[this.member.userID]}).then((function(){e.$store.commit("deleteGroupMemeber",e.member.userID)})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))},changeMemberRole:function(){},setGroupMemberMuteTime:function(){var e=this;this.tim.setGroupMemberMuteTime({groupID:this.currentConversation.groupProfile.groupID,userID:this.member.userID,muteTime:Number(this.muteTime)}).then((function(){e.muteTime="",e.popoverVisible=!1})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))},cancelMute:function(){var e=this;this.tim.setGroupMemberMuteTime({groupID:this.currentConversation.groupProfile.groupID,userID:this.member.userID,muteTime:0}).then((function(){e.muteTime=""})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))},setGroupMemberNameCard:function(){var e=this;0!==this.nameCard.trim().length?this.tim.setGroupMemberNameCard({groupID:this.currentConversation.groupProfile.groupID,userID:this.member.userID,nameCard:this.nameCard}).then((function(){e.nameCardPopoverVisible=!1,e.$store.commit("showMessage",{message:"修改成功"})})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})})):this.$store.commit("showMessage",{message:"不能设置空的群名片",type:"warning"})}}},ds=fs,hs=(r("3a8d"),Object(Z["a"])(ds,us,ls,!1,null,"f9fe53b0",null)),gs=hs.exports;function vs(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function bs(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?vs(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vs(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Os={data:function(){return{addGroupMemberVisible:!1,currentMemberID:"",count:30}},props:["groupProfile"],components:{Popover:bt.a,AddGroupMember:cs,GroupMemberInfo:gs},computed:bs(bs({},Object(ae["c"])({currentConversation:function(e){return e.conversation.currentConversation}})),{},{showLoadMore:function(){return this.members.length<this.groupProfile.memberNum},members:function(){return this.currentConversation.groupProfile.members}}),methods:{getGroupMemberAvatarText:function(e){switch(e){case"Owner":return"群主";case"Admin":return"管理员";default:return"群成员"}},loadMore:function(){var e=this;this.$store.dispatch("getGroupMemberList",this.groupProfile.groupID).then((function(){e.count+=30}))}}},ys=Os,_s=(r("afca"),Object(Z["a"])(ys,Xn,es,!1,null,"0dd9c888",null)),Cs=_s.exports,Is={props:["groupProfile"],components:{GroupMemberList:Cs,ElSelect:m.a,ElOption:l.a,ElSwitch:Zn.a},data:function(){return{showEditName:!1,showEditFaceUrl:!1,showEditIntroduction:!1,showEditNotification:!1,showEditJoinOption:!1,showChangeGroupOwner:!1,showEditMessageRemindType:!1,showEditNameCard:!1,name:this.groupProfile.name,avatar:this.groupProfile.avatar,introduction:this.groupProfile.introduction,notification:this.groupProfile.notification,joinOption:this.groupProfile.joinOption,newOwnerUserID:"",messageRemindTypeMap:{AcceptAndNotify:"接收消息并提示",AcceptNotNotify:"接收消息但不提示",Discard:"屏蔽消息"},joinOptionMap:{FreeAccess:"自由加入",NeedPermission:"需要验证",DisableApply:"禁止加群"},active:!1}},computed:{editable:function(){return this.groupProfile.type===this.TIM.TYPES.GRP_WORK||[this.TIM.TYPES.GRP_MBR_ROLE_OWNER,this.TIM.TYPES.GRP_MBR_ROLE_ADMIN].includes(this.groupProfile.selfInfo.role)},isOwner:function(){return this.groupProfile.userID==localStorage.getItem("userID")},isAdmin:function(){return this.groupProfile.selfInfo.role===this.TIM.TYPES.GRP_MBR_ROLE_ADMIN},showDissmissGroup:function(){return this.isOwner&&this.groupProfile.type!==this.TIM.TYPES.GRP_WORK}},watch:{groupProfile:function(e){Object.assign(this,{showEditName:!1,showEditFaceUrl:!1,showEditIntroduction:!1,showEditNotification:!1,showEditJoinOption:!1,showChangeGroupOwner:!1,showEditNameCard:!1,name:e.name,avatar:e.avatar,introduction:e.introduction,notification:e.notification,joinOption:e.joinOption,messageRemindType:e.messageRemindType,nameCard:e.selfInfo.nameCard||"",muteAllMembers:e.muteAllMembers})}},methods:{inputFocus:function(e){var t=this;this.$nextTick((function(){t.$refs[e].focus()}))},editName:function(){var e=this;this.tim.updateGroupProfile({groupID:this.groupProfile.groupID,name:this.name.trim()}).then((function(){e.showEditName=!1})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))},editFaceUrl:function(){var e=this;this.tim.updateGroupProfile({groupID:this.groupProfile.groupID,avatar:this.avatar.trim()}).then((function(){e.showEditFaceUrl=!1})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))},changeMuteStatus:function(){var e=this;this.isOwner||this.isAdmin?this.tim.updateGroupProfile({muteAllMembers:this.muteAllMembers,groupID:this.groupProfile.groupID}).then((function(t){e.muteAllMembers=t.data.group.muteAllMembers,e.muteAllMembers?(e.active=!0,e.$store.commit("showMessage",{message:"全体禁言"})):(e.active=!1,e.$store.commit("showMessage",{message:"取消全体禁言"}))})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})})):(this.muteAllMembers=this.groupProfile.muteAllMembers,this.$store.commit("showMessage",{type:"error",message:"普通群成员不能对全体禁言"}))},editIntroduction:function(){var e=this;this.tim.updateGroupProfile({groupID:this.groupProfile.groupID,introduction:this.introduction.trim()}).then((function(){e.showEditIntroduction=!1})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))},editNotification:function(){var e=this;this.tim.updateGroupProfile({groupID:this.groupProfile.groupID,notification:this.notification.trim()}).then((function(){e.showEditNotification=!1})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))},editJoinOption:function(){var e=this;this.tim.updateGroupProfile({groupID:this.groupProfile.groupID,joinOption:this.joinOption}).then((function(){e.showEditJoinOption=!1})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))},changeOwner:function(){var e=this;this.tim.changeGroupOwner({groupID:this.groupProfile.groupID,newOwnerID:this.newOwnerUserID}).then((function(){e.showChangeGroupOwner=!1,e.$store.commit("showMessage",{message:"转让群主成功，新群主ID：".concat(e.newOwnerUserID)}),e.newOwnerUserID=""})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))},quitGroup:function(){var e=this;this.tim.quitGroup(this.groupProfile.groupID).then((function(t){var r=t.data.groupID;e.$store.commit("showMessage",{message:"退群成功"}),r===e.groupProfile.groupID&&e.$store.commit("resetCurrentConversation")})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))},dismissGroup:function(){var e=this;this.tim.dismissGroup(this.groupProfile.groupID).then((function(t){var r=t.data.groupID;e.$store.commit("showMessage",{message:"群：".concat(e.groupProfile.name||e.groupProfile.groupID,"解散成功！"),type:"success"}),r===e.groupProfile.groupID&&e.$store.commit("resetCurrentConversation")})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))},editMessageRemindType:function(){var e=this;this.tim.setMessageRemindType({groupID:this.groupProfile.groupID,messageRemindType:this.messageRemindType}).then((function(){e.showEditMessageRemindType=!1})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))},editNameCard:function(){var e=this;0!==this.nameCard.trim().length?this.tim.setGroupMemberNameCard({groupID:this.groupProfile.groupID,nameCard:this.nameCard.trim()}).then((function(){e.showEditNameCard=!1})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})})):this.$store.commit("showMessage",{message:"不能设置空的群名片",type:"warning"})}}},Ps=Is,ws=(r("0716"),Object(Z["a"])(Ps,Wn,Jn,!1,null,null,null)),Ms=ws.exports,Es=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"profile-user"},[r("div",{staticClass:"item text-ellipsis"},[r("span",{attrs:{title:e.userProfile.nick}},[e._v("\n     昵称"),r("i",{staticClass:"el-icon-user-solid"}),e._v("："+e._s(e.userProfile.nick)+"\n    ")])]),r("div",{staticClass:"item"},[e._v("\n    性别：\n    "),1==e.userProfile.gender?r("i",{staticClass:"el-icon-male"}):r("i",{staticClass:"el-icon-female"})]),r("div",{staticClass:"item"},[e._v("\n    家乡"),r("i",{staticClass:"el-icon-s-home"}),e._v("：\n    "),r("span",[e._v(e._s(e.userProfile.home))])]),r("div",{staticClass:"item"},[e._v("\n    年龄："+e._s(e.userProfile.age)+"\n  ")])])},js=[];function Ts(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ds(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ts(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ts(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ss={props:{userProfile:{type:Object,required:!0}},computed:Ds(Ds({},Object(ae["c"])({myUserID:function(e){return e.user.currentUserProfile.userID}})),{},{isInBlacklist:function(){var e=this;return this.blacklist.findIndex((function(t){return t.userID===e.userProfile.userID}))>=0},gender:function(){switch(this.userProfile.gender){case this.TIM.TYPES.GENDER_MALE:return"男";case this.TIM.TYPES.GENDER_FEMALE:return"女";default:return"未设置"}},genderClass:function(){switch(this.userProfile.gender){case this.TIM.TYPES.GENDER_MALE:return"icon-male";case this.TIM.TYPES.GENDER_FEMALE:return"icon-female";default:return""}}}),methods:{addToBlackList:function(){var e=this;this.tim.addToBlacklist({userIDList:[this.userProfile.userID]}).then((function(){e.$store.dispatch("getBlacklist")})).catch((function(t){e.$store.commit("showMessage",{message:t.message,type:"error"})}))},removeFromBlacklist:function(){var e=this;this.tim.removeFromBlacklist({userIDList:[this.userProfile.userID]}).then((function(){e.$store.commit("removeFromBlacklist",e.userProfile.userID)})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))}}},ks=Ss,xs=(r("9f24"),Object(Z["a"])(ks,Es,js,!1,null,"130513d0",null)),Ls=xs.exports;function Rs(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function As(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Rs(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rs(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ns={name:"ConversationProfile",components:{GroupProfile:Ms,UserProfile:Ls},data:function(){return{}},computed:As({},Object(ae["c"])({currentConversation:function(e){return e.conversation.currentConversation}}))},Gs=Ns,Us=(r("64ef"),Object(Z["a"])(Gs,Kn,zn,!1,null,"f691ec10",null)),$s=Us.exports;function Fs(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Bs(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Fs(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fs(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ys={name:"CurrentConversation",components:{MessageSendBox:Et,MessageItem:Gn,ConversationItem:Hn,ConversationProfile:$s},data:function(){return{isShowScrollButtomTips:!1,preScrollHeight:0,showConversationProfile:!1,timeout:""}},computed:Bs(Bs(Bs({},Object(ae["c"])({currentConversation:function(e){return e.conversation.currentConversation},currentUnreadCount:function(e){return e.conversation.currentConversation.unreadCount},currentMessageList:function(e){return e.conversation.currentMessageList},isCompleted:function(e){return e.conversation.isCompleted}})),Object(ae["b"])(["toAccount","hidden"])),{},{showCurrentConversation:function(){return!!this.currentConversation.conversationID},name:function(){return"C2C"===this.currentConversation.type?this.currentConversation.userProfile.nick:"GROUP"===this.currentConversation.type?this.currentConversation.groupProfile.nick:(this.currentConversation.type,"系统通知")},showMessageSendBox:function(){return this.currentConversation.type!==this.TIM.TYPES.CONV_SYSTEM}}),mounted:function(){if(this.$bus.$on("image-loaded",this.onImageLoaded),this.$bus.$on("scroll-bottom",this.scrollMessageListToButtom),"@TIM#SYSTEM"===this.currentConversation.conversationID)return!1},updated:function(){this.keepMessageListOnButtom(),"@TIM#SYSTEM"!==this.currentConversation.conversationID&&"undefined"!==typeof this.currentConversation.conversationID||(this.showConversationProfile=!1)},watch:{currentUnreadCount:function(e){!this.hidden&&e>0&&this.$store.commit("resetCurrentConversationUnread")},hidden:function(e){!e&&this.currentUnreadCount>0&&this.$store.commit("resetCurrentConversationUnread")}},methods:{onScroll:function(e){var t=e.target.scrollTop,r=this.$refs["message-list"];r&&this.preScrollHeight-r.clientHeight-t<20&&(this.isShowScrollButtomTips=!1)},keepMessageListOnButtom:function(){var e=this.$refs["message-list"];e&&(this.preScrollHeight-e.clientHeight-e.scrollTop<20?(this.$nextTick((function(){e.scrollTop=e.scrollHeight})),this.isShowScrollButtomTips=!1):this.isShowScrollButtomTips=!0,this.preScrollHeight=e.scrollHeight)},scrollMessageListToButtom:function(){var e=this;this.$nextTick((function(){var t=e.$refs["message-list"];t&&(t.scrollTop=t.scrollHeight,e.preScrollHeight=t.scrollHeight,e.isShowScrollButtomTips=!1)}))},showMore:function(){this.showConversationProfile=!this.showConversationProfile},onImageLoaded:function(){this.keepMessageListOnButtom()}}},Vs=Ys,qs=(r("424b"),Object(Z["a"])(Vs,ut,lt,!1,null,"5b774862",null)),Hs=qs.exports,Ks=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"current-group"},[r("div",{staticClass:"top-part"},[r("div",{staticClass:"avatar"},[r("el-avatar",{attrs:{size:100,src:e.group.Avatar}})],1),r("div",{staticClass:"info"},[r("div",{staticClass:"name"},[e._v(e._s(e.group.Name))]),r("div",{staticClass:"btn",on:{click:e.openConversation}},[e._v("打开群聊")])])]),r("div",{staticClass:"bottom-part"},[r("div",{staticClass:"intro"},[e._v("群ID："+e._s(e.group.ID))]),r("div",{staticClass:"intro"},[e._v("群介绍："+e._s(e.group.Intro))]),r("div",{staticClass:"intro"},[e._v("群成员:")]),r("div",{staticClass:"member-list"},e._l(e.group.Members,(function(t,n){return r("div",{key:n,staticClass:"user-item"},[r("el-avatar",{attrs:{shape:"square",size:40,src:t.Avatar}}),r("div",{staticStyle:{"text-align":"center"}},[e._v(e._s(t.Name))]),e.group.UserID==t.ID?r("div",{staticClass:"leader"},[e._v("群主")]):e._e()],1)})),0)])])},zs=[];function Ws(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Js(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ws(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ws(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Qs={data:function(){return{renderKeys:{ID:{key:"ID",label:"群ID"},UserID:{key:"UserID",label:"群主ID"}}}},computed:Js({},Object(ae["c"])({group:function(e){return e.group.currentGroup}})),watch:{},methods:{openConversation:function(){this.$store.commit("setActiveTab",Le.CONVERSATION_LIST),this.$store.dispatch("group2Conversation",this.group.ID)}}},Zs=Qs,Xs=(r("0dbf"),Object(Z["a"])(Zs,Ks,zs,!1,null,"50eb23a0",null)),eo=Xs.exports,to=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"current-friend"},[r("div",{staticClass:"top-part"},[r("div",{staticClass:"avatar"},[r("el-avatar",{attrs:{size:100,src:e.friend.Avatar}})],1),r("div",{staticClass:"name"},[e._v(e._s(e.friend.Name))]),e.currentFriendRelated?r("div",{staticClass:"send-btn",on:{click:e.openConversation}},[e._v("\n      发送消息\n    ")]):e._e(),e.showHandleBtn?r("div",{staticClass:"handle-btn"},[r("el-button",{attrs:{type:"success",round:""},on:{click:function(t){return e.handleFriend(e.RELATION_AGREE)}}},[e._v("同意")]),r("el-button",{attrs:{type:"danger",round:""},on:{click:function(t){return e.handleFriend(e.RELATION_REFUSE)}}},[e._v("拒绝")])],1):e._e()]),r("div",{staticClass:"bottom-part"},e._l(e.renderKeys,(function(t,n){return r("div",{key:n,staticClass:"item"},[r("div",[r("span",{staticStyle:{"margin-right":"10px",color:"grey"}},[e._v(e._s(t.label)+": ")]),r("span",{staticStyle:{"margin-right":"5px"}},[e._v(e._s(t.transform?t.transform(e.friend[n]):e.friend[n]))])])])})),0)])},ro=[];function no(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function so(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?no(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):no(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var oo={data:function(){return{RELATION_REFUSE:2,RELATION_AGREE:1,renderKeys:{ID:{key:"ID",label:"账号ID"},Gender:{key:"Gender",label:"性别",transform:function(e){return 1==e?"男":"女"}},Age:{key:"Age",label:"年龄"},SchoolCode:{key:"SchoolCode",label:"学校代码"}}}},computed:so({},Object(ae["c"])({friend:function(e){return e.friend.currentFriend},currentFriendRelated:function(e){return e.friend.currentFriendRelated},currentRelationID:function(e){return e.friend.currentRelation.ID},showHandleBtn:function(e){return e.user.userID==e.friend.currentRelation.RelatedId&&0===e.friend.currentRelation.State}})),watch:{},methods:{openConversation:function(){this.$store.commit("setActiveTab",Le.CONVERSATION_LIST),this.$store.dispatch("friend2Conversation",this.friend.ID)},handleFriend:function(e){console.log("agreeToFriend",e),this.$store.dispatch("handleFriendRelation",{ws:this.ws,handleSig:e,relationID:this.currentRelationID})},getInitData:function(){}}},io=oo,ao=(r("30ed"),Object(Z["a"])(io,to,ro,!1,null,"aec04d16",null)),co=ao.exports,uo=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"side-bar-wrapper"},[r("div",{staticClass:"bar-left"},[r("my-profile"),r("div",{staticClass:"tab-items",on:{click:e.handleClick}},[r("div",{staticClass:"iconfont icon-conversation",class:{active:e.showConversationList},attrs:{id:"conversation-list",title:"会话列表"}},[0!==e.totalUnreadCount.count?r("sup",{staticClass:"unread"},[e.totalUnreadCount.count>99?[e._v("99+")]:[e._v(e._s(e.totalUnreadCount.count))]],2):e._e()]),r("div",{staticClass:"iconfont icon-group",class:{active:e.showGroupList},attrs:{id:"group-list",title:"群组列表"}}),r("div",{staticClass:"iconfont icon-contact",class:{active:e.showFriendList},attrs:{id:"friend-list",title:"好友列表"}})]),r("div",{staticClass:"bottom"},[r("div",{staticClass:"iconfont icon-tuichu",attrs:{title:"退出"},on:{click:e.logout}})])],1),r("div",{staticClass:"bar-right"},[r("conversation-list",{directives:[{name:"show",rawName:"v-show",value:e.showConversationList,expression:"showConversationList"}]}),r("group-list",{directives:[{name:"show",rawName:"v-show",value:e.showGroupList,expression:"showGroupList"}]}),r("friend-list",{directives:[{name:"show",rawName:"v-show",value:e.showFriendList,expression:"showFriendList"}]})],1)])},lo=[],po=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"my-profile-wrapper"},[r("el-dialog",{attrs:{title:"编辑个人资料",visible:e.showEditMyProfile,width:"30%"},on:{"update:visible":function(t){e.showEditMyProfile=t}}},[r("el-form",{attrs:{"label-width":"100px"},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}},[r("el-form-item",{attrs:{label:"头像"}},[r("el-input",{attrs:{placeholder:"头像地址(URL)"},model:{value:e.form.avatar,callback:function(t){e.$set(e.form,"avatar",t)},expression:"form.avatar"}})],1),r("el-form-item",{attrs:{label:"昵称"}},[r("el-input",{attrs:{placeholder:"昵称"},model:{value:e.form.nick,callback:function(t){e.$set(e.form,"nick",t)},expression:"form.nick"}})],1),r("el-form-item",{attrs:{label:"性别"}},[r("el-radio-group",{model:{value:e.form.gender,callback:function(t){e.$set(e.form,"gender",t)},expression:"form.gender"}},[r("el-radio",{attrs:{label:e.TIM.TYPES.GENDER_MALE}},[e._v("男")]),r("el-radio",{attrs:{label:e.TIM.TYPES.GENDER_FEMALE}},[e._v("女")]),r("el-radio",{attrs:{label:e.TIM.TYPES.GENDER_UNKNOWN}},[e._v("不显示")])],1)],1)],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.showEditMyProfile=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.editMyProfile}},[e._v("确 定")])],1)],1),r("el-popover",{staticClass:"popover",attrs:{width:200,trigger:"click",placement:"right"}},[r("profile-card",{attrs:{profile:e.userInfo}}),r("i",{staticClass:"el-icon-setting edit-my-profile",on:{click:e.handleEdit}}),r("avatar",{staticClass:"my-avatar",attrs:{slot:"reference",src:e.userInfo.avatar},slot:"reference"})],1)],1)},mo=[],fo=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"profile-card-wrapper"},[r("div",{staticClass:"content"},[r("avatar",{attrs:{src:e.profile.avatar}}),r("div",{staticClass:"basic"},[r("span",{staticClass:"nick text-ellipsis"},[e._v(e._s(e.profile.name||e.profile.userID))]),r("span",{staticClass:"iconfont",class:e.genderClass})])],1)])},ho=[],go={name:"ProfileCard",props:{profile:{type:Object,required:!0}},computed:{genderClass:function(){switch(this.profile.gender){case this.TIM.TYPES.GENDER_MALE:return"icon-male";case this.TIM.TYPES.GENDER_FEMALE:return"icon-female";default:return"暂无"}}}},vo=go,bo=(r("8127"),Object(Z["a"])(vo,fo,ho,!1,null,null,null)),Oo=bo.exports;function yo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yo(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yo(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Co={name:"MyProfile",components:{ElPopover:bt.a,ProfileCard:Oo,ElForm:ln.a,ElFormItem:s.a,ElRadioGroup:gt.a,ElRadio:P.a},data:function(){return{showEditMyProfile:!1,form:{avatar:"",nick:"",gender:""}}},computed:_o(_o({},Object(ae["c"])({userInfo:function(e){return e.user},currentConversation:function(e){return e.conversation.currentConversation}})),{},{gender:function(){switch(this.userProfile.gender){case this.TIM.TYPES.GENDER_MALE:return"男";case this.TIM.TYPES.GENDER_FEMALE:return"女";default:return"暂无"}}}),methods:{editMyProfile:function(){var e=this;if(this.form.avatar&&-1===this.form.avatar.indexOf("http"))return this.$store.commit("showMessage",{message:"头像应该是 Url 地址",type:"warning"}),void(this.form.avatar="");var t={};Object.keys(this.form).forEach((function(r){e.form[r]&&(t[r]=e.form[r])})),this.tim.updateMyProfile(t).then((function(){e.$store.commit("showMessage",{message:"修改成功"}),e.showEditMyProfile=!1})).catch((function(t){e.$store.commit("showMessage",{message:t.message,type:"error"})}))},handleEdit:function(){var e=this.userInfo,t=e.avatar,r=e.name,n=e.gender;Object.assign(this.form,{avatar:t,name:r,gender:n}),this.showEditMyProfile=!0}}},Io=Co,Po=(r("4af9"),Object(Z["a"])(Io,po,mo,!1,null,"c90fdd72",null)),wo=Po.exports,Mo=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"list-container"},[e._m(0),r("div",{staticClass:"scroll-container"},e._l(e.conversationList,(function(e){return r("conversation-item",{key:e.conversationID,attrs:{conversation:e}})})),1),r("el-dialog",{attrs:{title:"快速发起群会话",visible:e.showDialog,width:"30%"},on:{"update:visible":function(t){e.showDialog=t}}},[r("el-input",{attrs:{placeholder:"请输入用户ID"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleConfirm(t)}},model:{value:e.userID,callback:function(t){e.userID=t},expression:"userID"}}),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.showDialog=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.handleConfirm}},[e._v("确 定")])],1)],1)],1)},Eo=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"header-bar"},[r("div",[e._v("会话列表")])])}];function jo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function To(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?jo(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jo(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Do={name:"ConversationList",components:{ConversationItem:Hn},data:function(){return{showDialog:!1,searchToUid:"",isCheckouting:!1,timeout:null,userID:null}},computed:To({},Object(ae["c"])({conversationList:function(e){console.log("conversationList render",e.conversation.forkList);var t=[],r=[];return Object.values(e.conversation.conversationObject).forEach((function(n,s){-1!==e.conversation.forkList.indexOf(n.conversationID)?(n.isFork=!0,t.push(n)):(n.isFork=!1,r.push(n))})),[].concat(t,Object(ce["a"])(r.sort((function(e,t){return t.lastMessage.lastTime-e.lastMessage.lastTime}))))},currentConversation:function(e){return e.conversation.currentConversation}})),mounted:function(){window.addEventListener("keydown",this.handleKeydown)},destroyed:function(){window.removeEventListener("keydown",this.handleKeydown)},methods:{handleRefresh:function(){this.refreshConversation()()},handleAddButtonClick:function(){this.showDialog=!0},handleConfirm:function(){var e=this;"@TIM#SYSTEM"!==this.userID?this.$store.dispatch("checkoutConversation","C2C".concat(this.userID)).then((function(){e.showDialog=!1})).catch((function(){e.$store.commit("showMessage",{message:"没有找到该用户",type:"warning"})})):this.$store.commit("showMessage",{message:"没有找到该用户",type:"warning"}),this.userID=""},refreshConversation:function(){var e=this;return function(){e.timeout||(e.timeout=setTimeout((function(){e.timeout=null,e.tim.getConversationList().then((function(){e.$store.commit("showMessage",{message:"刷新成功",type:"success"})}))}),1e3))}},handleKeydown:function(e){var t=this;if(!(38!==e.keyCode&&40!==e.keyCode||this.isCheckouting)){var r=this.conversationList.findIndex((function(e){return e.conversationID===t.currentConversation.conversationID}));38===e.keyCode&&r-1>=0&&this.checkoutPrev(r),40===e.keyCode&&r+1<this.conversationList.length&&this.checkoutNext(r)}},checkoutPrev:function(e){var t=this;this.isCheckouting=!0,this.$store.dispatch("checkoutConversation",this.conversationList[e-1].conversationID).then((function(){t.isCheckouting=!1})).catch((function(){t.isCheckouting=!1}))},checkoutNext:function(e){var t=this;this.isCheckouting=!0,this.$store.dispatch("checkoutConversation",this.conversationList[e+1].conversationID).then((function(){t.isCheckouting=!1})).catch((function(){t.isCheckouting=!1}))}}},So=Do,ko=(r("daf3"),Object(Z["a"])(So,Mo,Eo,!1,null,"cd640c10",null)),xo=ko.exports,Lo=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"list-container"},[r("div",{staticClass:"header-bar"},[r("div"),r("div",[e._v("群组列表")]),r("button",{attrs:{title:"创建群组"},on:{click:e.showCreateGroupModel}},[r("i",{staticClass:"tim-icon-add"})])]),r("div",{staticClass:"group-container"},[e._l(e.groupList,(function(e){return r("group-item",{key:e.groupID,attrs:{group:e}})})),r("el-dialog",{attrs:{title:"创建群组",visible:e.createGroupModelVisible,width:"30%"},on:{close:e.closeCreateGroupModel}},[r("create-group")],1)],2)])},Ro=[],Ao=(r("3db2"),r("58b8")),No=r.n(Ao),Go=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-form",{ref:"createGroupForm",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"群名称",prop:"name"}},[r("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),r("el-form-item",{attrs:{label:"群头像地址"}},[r("el-input",{model:{value:e.form.avatar,callback:function(t){e.$set(e.form,"avatar",t)},expression:"form.avatar"}})],1),r("el-form-item",{attrs:{label:"群简介"}},[r("el-input",{attrs:{type:"textarea",maxlength:240},model:{value:e.form.introduction,callback:function(t){e.$set(e.form,"introduction",t)},expression:"form.introduction"}})],1),r("el-form-item",{attrs:{label:"群成员列表"}},[r("el-select",{attrs:{"default-first-option":"",multiple:"",filterable:"",remote:"",disabled:e.form.type===e.TIM.TYPES.GRP_AVCHATROOM,"remote-method":e.handleSearchUser,loading:e.loading,placeholder:"请输入群成员 userID"},model:{value:e.form.memberList,callback:function(t){e.$set(e.form,"memberList",t)},expression:"form.memberList"}},e._l(e.options,(function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("createGroupForm")}}},[e._v("立即创建")]),r("el-button",{on:{click:e.closeCreateGroupModel}},[e._v("取消")])],1)],1)},Uo=[];function $o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Fo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$o(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Bo={components:{ElForm:ln.a,ElFormItem:s.a,ElInput:A.a,ElSelect:m.a,ElOption:l.a,ElRadioGroup:gt.a,ElRadio:P.a},data:function(){return{form:{groupID:"",name:"",type:this.TIM.TYPES.GRP_WORK,avatar:"",introduction:"",notification:"",joinOption:"FreeAccess",memberList:[]},options:[],loading:!1,rules:{name:[{required:!0,message:"请输入群名称",trigger:"blur"}]}}},computed:{joinOptionDisabled:function(){return[this.TIM.TYPES.GRP_WORK,this.TIM.TYPES.GRP_MEETING,this.TIM.TYPES.GRP_AVCHATROOM].includes(this.form.type)}},methods:{onSubmit:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.createGroup()}))},closeCreateGroupModel:function(){this.$store.commit("updateCreateGroupModelVisible",!1)},createGroup:function(){var e=this;this.tim.createGroup(this.getOptions()).then((function(t){e.$store.commit("showMessage",{message:"群组：【".concat(t.data.group.name,"】创建成功"),type:"success"}),e.closeCreateGroupModel()})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))},getOptions:function(){var e=Fo(Fo({},this.form),{},{memberList:this.form.memberList.map((function(e){return{userID:e}}))});return[this.TIM.TYPES.GRP_WORK,this.TIM.TYPES.GRP_AVCHATROOM].includes(this.form.type)&&delete e.joinOption,e},handleSearchUser:function(e){var t=this;""!==e&&(this.loading=!0,this.tim.getUserProfile({userIDList:[e]}).then((function(e){var r=e.data;t.options=r.map((function(e){return e.userID})),t.loading=!1})).catch((function(e){t.$store.commit("showMessage",{type:"error",message:e.message})})))}}},Yo=Bo,Vo=Object(Z["a"])(Yo,Go,Uo,!1,null,"1ecb912c",null),qo=Vo.exports,Ho=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"scroll-container",on:{click:e.handleGroupClick}},[r("div",{class:{"group-item":!0,active:e.group.ID===e.currentGroupID}},[r("avatar",{attrs:{src:e.group.Avatar}}),r("div",{staticClass:"group-name text-ellipsis"},[e._v(e._s(e.group.Name))])],1)])},Ko=[];function zo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Wo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?zo(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zo(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Jo={props:{group:{type:Object,required:!0}},computed:Wo({},Object(ae["c"])({currentGroupID:function(e){return e.group.currentGroup.ID}})),data:function(){return{visible:!1,options:[{text:"退出群组",handler:this.quitGroup}]}},methods:{handleGroupClick:function(){this.$store.commit("setCurrentGroup",this.group.ID)},quitGroup:function(){}}},Qo=Jo,Zo=(r("8610"),Object(Z["a"])(Qo,Ho,Ko,!1,null,"385aa7b7",null)),Xo=Zo.exports;function ei(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ti(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ei(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ei(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ri={data:function(){return{groupID:"",hideSearchLoading:!0}},components:{GroupItem:Xo,ElDialog:g.a,CreateGroup:qo,ElAutocomplete:No.a},computed:ti({groupList:function(){return this.$store.state.group.groupList}},Object(ae["c"])({createGroupModelVisible:function(e){return e.group.createGroupModelVisible}})),methods:{onGroupUpdated:function(e){this.$store.dispatch("updateGroupList",e)},createGroup:function(){},closeCreateGroupModel:function(){this.$store.commit("updateCreateGroupModelVisible",!1)},searchGroupByID:function(e,t){var r=this;e.trim().length>0?(this.hideSearchLoading=!1,this.tim.searchGroupByID(e).then((function(e){var r=e.data.group;t([r])})).catch((function(){r.$store.commit("showMessage",{message:"没有找到该群",type:"error"})}))):this.hideSearchLoading=!0},showCreateGroupModel:function(){this.$store.commit("updateCreateGroupModelVisible",!0)},applyJoinGroup:function(e){var t=this;this.tim.joinGroup({groupID:e.groupID}).then(function(){var e=Object(ve["a"])(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:e.t0=r.data.status,e.next=e.t0===t.TIM.TYPES.JOIN_STATUS_WAIT_APPROVAL?3:e.t0===t.TIM.TYPES.JOIN_STATUS_SUCCESS?5:e.t0===t.TIM.TYPES.JOIN_STATUS_ALREADY_IN_GROUP?9:11;break;case 3:return t.$store.commit("showMessage",{message:"申请成功，等待群管理员确认。",type:"info"}),e.abrupt("break",12);case 5:return e.next=7,t.$store.dispatch("checkoutConversation","GROUP".concat(r.data.group.groupID));case 7:return t.$store.commit("showMessage",{message:"加群成功",type:"success"}),e.abrupt("break",12);case 9:return t.$store.commit("showMessage",{message:"您已经是群成员了，请勿重复加群哦！",type:"info"}),e.abrupt("break",12);case 11:return e.abrupt("break",12);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t.$store.commit("showMessage",{message:e.message,type:"error"})}))}}},ni=ri,si=(r("30c9"),Object(Z["a"])(ni,Lo,Ro,!1,null,"f5b12906",null)),oi=si.exports,ii=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"friend-list-container"},[e._m(0),r("div",{staticClass:"group-container"},[e.hasRelation?r("div",e._l(e.relationList,(function(e){return r("friend-item",{key:e.userID,attrs:{related:!1,friend:e}})})),1):e._e(),e.hasFriend?r("div",e._l(e.friendList,(function(e){return r("friend-item",{key:e.userID,attrs:{related:!0,friend:e}})})),1):r("div",{staticClass:"null"},[e._v("暂无好友")])])])},ai=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"header-bar"},[r("div",[e._v("好友列表")])])}],ci=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.related?r("div",{staticClass:"scroll-container",on:{click:e.handleFriendClick}},[r("div",{class:{"friend-item":!0,active:e.friend.ID===e.currentFriendID}},[r("avatar",{attrs:{src:e.friend.Avatar}}),r("div",{staticClass:"friend-name text-ellipsis"},[e._v(e._s(e.friend.Name))])],1)]):e.friend.UserId===e.userID?r("div",{staticClass:"scroll-container",on:{click:e.handleRelationClick}},[r("div",{class:{"friend-item":!0,active:e.friend.RelatedId===e.currentFriendID}},[r("avatar",{attrs:{src:e.friend.RelatedProfile.Avatar}}),r("div",{staticClass:"friend-name text-ellipsis"},[e._v("\n          "+e._s(e.friend.RelatedProfile.Name)+"\n        ")]),0===e.friend.State?r("div",{staticStyle:{"font-size":"12px"}},[e._v("\n          已申请,等待对方同意\n        ")]):e._e(),1===e.friend.State?r("div",{staticStyle:{"font-size":"12px"}},[e._v("已添加")]):e._e(),2===e.friend.State?r("div",{staticStyle:{"font-size":"12px"}},[e._v("对方已拒绝")]):e._e()],1)]):r("div",{staticClass:"scroll-container",on:{click:e.handleRelation2Click}},[r("div",{class:{"friend-item":!0,active:e.friend.RelatedId===e.currentFriendID}},[r("avatar",{attrs:{src:e.friend.UserProfile.Avatar}}),r("div",{staticClass:"friend-name text-ellipsis"},[e._v("\n          "+e._s(e.friend.UserProfile.Name)+"\n        ")]),0===e.friend.State?r("div",{staticStyle:{"font-size":"12px"}},[e._v("申请加你为好友,待处理")]):e._e(),1===e.friend.State?r("div",{staticStyle:{"font-size":"12px"}},[e._v("已添加")]):e._e(),2===e.friend.State?r("div",{staticStyle:{"font-size":"12px"}},[e._v("对方已拒绝")]):e._e()],1)])},ui=[];function li(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pi(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?li(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):li(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var mi={props:{friend:{type:Object,required:!0},related:{type:Boolean,required:!0}},computed:pi({},Object(ae["c"])({currentFriendID:function(e){return e.friend.currentFriend.ID},userID:function(e){return e.user.userID}})),methods:{handleFriendClick:function(){this.$store.commit("setCurrentFriend",this.friend.ID)},handleRelationClick:function(){this.$store.commit("setCurrentRelation",{UserId:this.friend.RelatedId,Is2Me:!1})},handleRelation2Click:function(){this.$store.commit("setCurrentRelation",{UserId:this.friend.UserId,Is2Me:!0})},addConversation:function(){var e=this;this.API.addConversation({chatID:"C2C".concat(this.friend.ID),userID:localStorage.getItem("userID")}).then((function(t){var r=t.data;e.$store.commit("updateCurrentConversation",r)})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))}}},fi=mi,di=(r("c6b9"),Object(Z["a"])(fi,ci,ui,!1,null,"0ece9e18",null)),hi=di.exports;function gi(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function vi(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?gi(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gi(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var bi={components:{FriendItem:hi},computed:vi(vi({},Object(ae["c"])({friendList:function(e){return e.friend.friendList},relationList:function(e){return e.friend.relationList}})),{},{hasFriend:function(){return this.friendList.length>0},hasRelation:function(){return this.relationList.length>0}})},Oi=bi,yi=(r("47b1"),Object(Z["a"])(Oi,ii,ai,!1,null,null,null)),_i=yi.exports,Ci=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"blacklist-wrapper",class:{default:!e.hasBlacklist}},[e.hasBlacklist?r("div",e._l(e.blacklist,(function(e){return r("blacklist-item",{key:e.userID,attrs:{profile:e}})})),1):r("span",{staticStyle:{color:"gray"}},[e._v("黑名单还是空的")])])},Ii=[],Pi=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"blacklist-item-wrapper"},[r("img",{staticClass:"avatar",attrs:{src:e.profile.avatar?e.profile.avatar:"http://imgcache.qq.com/open/qcloud/video/act/webim-avatar/avatar-2.png"}}),r("div",{staticClass:"item"},[e._v(e._s(e.profile.nick||e.profile.userID))]),r("el-button",{attrs:{type:"text"},on:{click:e.removeFromBlacklist}},[e._v("取消拉黑")])],1)},wi=[],Mi={name:"BlacklistItem",props:{profile:{type:Object,required:!0}},methods:{removeFromBlacklist:function(){var e=this;this.tim.removeFromBlacklist({userIDList:[this.profile.userID]}).then((function(){e.$store.commit("removeFromBlacklist",e.profile.userID)})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))}}},Ei=Mi,ji=(r("b849"),Object(Z["a"])(Ei,Pi,wi,!1,null,"6763cfe2",null)),Ti=ji.exports;function Di(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Si(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Di(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Di(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ki={name:"Blacklist",components:{BlacklistItem:Ti},computed:Si(Si({},Object(ae["c"])({blacklist:function(e){return e.blacklist.blacklist}})),{},{hasBlacklist:function(){return this.blacklist.length>0}})},xi=ki,Li=(r("86b5"),Object(Z["a"])(xi,Ci,Ii,!1,null,"00ad617d",null)),Ri=Li.exports;function Ai(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ni(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ai(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ai(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Gi={name:"SideBar",components:{MyProfile:wo,ConversationList:xo,GroupList:oi,FriendList:_i,BlackList:Ri},data:function(){return{}},computed:Ni(Ni(Ni({},Object(ae["b"])(["totalUnreadCount"])),Object(ae["c"])({showConversationList:function(e){return e.activeTab===Le.CONVERSATION_LIST},showGroupList:function(e){return e.activeTab===Le.GROUP_LIST},showFriendList:function(e){return e.activeTab===Le.FRIEND_LIST}})),{},{showAddButton:function(){return[Le.CONVERSATION_LIST,Le.GROUP_LIST].includes(this.active)}}),watch:{},methods:{handleClick:function(e){this.$store.commit("setActiveTab",e.target.id)},logout:function(){var e=this;API.logout({token:localStorage.getItem("token")}).then((function(t){console.log("logout"),e.$store.dispatch("logout"),e.$router.push("/login")}))}}},Ui=Gi,$i=(r("5447"),Object(Z["a"])(Ui,uo,lo,!1,null,"4df6cdc6",null)),Fi=$i.exports,Bi=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"layout-header-bar"},[e._m(0),e._e()])},Yi=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"header-bar-left"},[r("div",{staticClass:"title"},[e._v("IM网页聊天系统")])])}];function Vi(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function qi(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Vi(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vi(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Hi={name:"HeaderBar",computed:qi(qi({},Object(ae["c"])({unreadCount:function(e){return e.unreadCount},unreadNumber:function(e){return e.unreadNumber}})),Object(ae["b"])(["totalUnreadCount"])),data:function(){return{}},methods:{fullScreenPage:function(){var e=window.location.href;console.log("current href",e),window.open(e)}}},Ki=Hi,zi=(r("c635"),Object(Z["a"])(Ki,Bi,Yi,!1,null,"4aefb562",null)),Wi=zi.exports,Ji=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"show",rawName:"v-show",value:e.showPreviewer,expression:"showPreviewer"}],staticClass:"image-previewer-wrapper",on:{mousewheel:e.handleMouseWheel}},[r("div",{staticClass:"image-wrapper"},[r("img",{staticClass:"image-preview",style:{transform:"scale("+e.zoom+") rotate("+e.rotate+"deg)"},attrs:{src:e.previewUrl},on:{click:e.close}})]),r("i",{staticClass:"el-icon-close close-button",on:{click:e.close}}),r("i",{staticClass:"el-icon-back prev-button",on:{click:e.goPrev}}),r("i",{staticClass:"el-icon-right next-button",on:{click:e.goNext}}),r("div",{staticClass:"actions-bar"},[r("i",{staticClass:"el-icon-zoom-out",on:{click:e.zoomOut}}),r("i",{staticClass:"el-icon-zoom-in",on:{click:e.zoomIn}}),r("i",{staticClass:"el-icon-refresh-left",on:{click:e.rotateLeft}}),r("i",{staticClass:"el-icon-refresh-right",on:{click:e.rotateRight}}),r("span",{staticClass:"image-counter"},[e._v(e._s(e.index+1)+" / "+e._s(e.imgUrlList.length))])])])},Qi=[],Zi={name:"ImagePreviewer",data:function(){return{url:"",index:0,visible:!1,zoom:1,rotate:0,minZoom:.1,imgUrlList:[]}},computed:{showPreviewer:function(){return this.url.length>0&&this.visible},imageStyle:function(){return{transform:"scale(".concat(this.zoom,");")}},previewUrl:function(){return this.formatUrl(this.imgUrlList[this.index])}},mounted:function(){this.$bus.$on("image-preview",this.handlePreview)},methods:{handlePreview:function(e){var t=e.url,r=e.urlList;this.url=t,this.imgUrlList=r,this.index=this.imgUrlList.findIndex((function(e){return e===t})),this.visible=!0},handleMouseWheel:function(e){e.wheelDelta>0?this.zoomIn():this.zoomOut()},zoomIn:function(){this.zoom+=.1},zoomOut:function(){this.zoom=this.zoom-.1>this.minZoom?this.zoom-.1:this.minZoom},close:function(){Object.assign(this,{zoom:1}),this.visible=!1},rotateLeft:function(){this.rotate-=90},rotateRight:function(){this.rotate+=90},goNext:function(){this.index=(this.index+1)%this.imgUrlList.length},goPrev:function(){this.index=this.index-1>=0?this.index-1:this.imgUrlList.length-1},formatUrl:function(e){return e?"//"===e.slice(0,2)?"https:".concat(e):e:""}}},Xi=Zi,ea=(r("0a44"),Object(Z["a"])(Xi,Ji,Qi,!1,null,"208c032b",null)),ta=ea.exports,ra=r("9579"),na=r.n(ra);na.a.init({sid:"500702399",cid:"500702403",autoReport:1,senseHash:0,senseQuery:0,performanceMonitor:0,ignoreParams:[]});var sa,oa=na.a;function ia(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function aa(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ia(Object(r),!0).forEach((function(t){Object(ue["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ia(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ca="ws://39.105.116.143:8000/ws",ua=(sa={title:"TIMSDK DEMO",components:{SideBar:Fi,CurrentConversation:Hs,CurrentFriend:co,CurrentGroup:eo,ImagePreviewer:ta,HeaderBar:Wi},computed:aa(aa({},Object(ae["c"])({currentUserProfile:function(e){return e.user.currentUserProfile},currentConversation:function(e){return e.conversation.currentConversation},isLogin:function(e){return e.user.isLogin},isWsReady:function(e){return e.user.isWsReady},isBusy:function(e){return e.video.isBusy},userID:function(e){return e.user.userID},conversationPageSize:function(e){return e.conversation.conversationPageSize},activeTab:function(e){return e.activeTab},showConversationList:function(e){return e.activeTab===Le.CONVERSATION_LIST},showGroupList:function(e){return e.activeTab===Le.GROUP_LIST},showFriendList:function(e){return e.activeTab===Le.FRIEND_LIST}})),{},{showLoading:function(){return!this.isWsReady}}),watch:{activeTab:function(e){}},mounted:function(){var e=JSON.parse(localStorage.getItem("userInfo"));this.$store.commit("setUserInfo",e),this.initWebSocket()},data:function(){return{websock:null}}},Object(ue["a"])(sa,"watch",{isLogin:function(e){e&&oa.clickStat("link_two",{show:"true"})}}),Object(ue["a"])(sa,"methods",{initWebSocket:function(){q["default"].prototype.ws=new WebSocket(ca),this.ws.onmessage=this.websocketonmessage,this.ws.onopen=this.websocketopen,this.ws.onclose=this.websocketclose},websocketopen:function(){var e=localStorage.getItem("token");this.ws.send(JSON.stringify({authToken:e,cop:Re.COP_AUTH})),this.onReady()},websocketonmessage:function(e){if(e.data){var t=JSON.parse(e.data);console.log("new ws:",t),this.$store.commit("pushCurrentMessageList",{msg:t,store:this.$store})}},websocketsend:function(e){this.ws.send(e)},websocketclose:function(e){console.log("connection closed ("+e.code+")")},initListener:function(){this.tim.on(this.TIM.EVENT.KICKED_OUT,this.onKickOut),this.tim.on(this.TIM.EVENT.ERROR,this.onError),this.tim.on(this.TIM.EVENT.MESSAGE_RECEIVED,this.onReceiveMessage),this.tim.on(this.TIM.EVENT.CONVERSATION_LIST_UPDATED,this.onUpdateConversationList),this.tim.on(this.TIM.EVENT.NET_STATE_CHANGE,this.onNetStateChange),this.tim.on(this.TIM.EVENT.MESSAGE_READ_BY_PEER,this.onMessageReadByPeer)},addHistoryFriendList:function(){this.$store.commit("addConversationList",res.data.contact_list),this.$store.commit("setTotalConvasation",res.data.total),this.$store.commit("updateUnreadTotal",{unreadCount:res.data.unread_count,unreadNumber:res.data.unread_number})},onReceiveMessage:function(e){var t=e.data;this.handleVideoMessage(t),this.handleAt(t),this.handleQuitGroupTip(t),this.$store.commit("pushCurrentMessageList",t)},onError:function(e){var t=e.data;"Network Error"!==t.message&&this.$store.commit("showMessage",{message:t.message,type:"error"})},onMessageReadByPeer:function(){},onReady:function(){var e=this;this.$store.commit("toggleIsWsReady",!0),this.API.getChatList({userID:localStorage.getItem("userID")}).then((function(t){console.log("getRoomInfo",t);var r=t.data.list[0].Sort+t.data.list[0].ID;e.$store.commit("initConversationList",t.data.list),e.$store.dispatch("checkoutConversation",r),e.$store.dispatch("getFriendList"),e.$store.dispatch("getGroupList")}))},kickedOutReason:function(e){switch(e){case this.TIM.TYPES.KICKED_OUT_MULT_ACCOUNT:return"由于多实例登录";case this.TIM.TYPES.KICKED_OUT_MULT_DEVICE:return"由于多设备登录";case this.TIM.TYPES.KICKED_OUT_USERSIG_EXPIRED:return"由于 userSig 过期";default:return""}},checkoutNetState:function(e){switch(e){case this.TIM.TYPES.NET_STATE_CONNECTED:return{message:"已接入网络",type:"success"};case this.TIM.TYPES.NET_STATE_CONNECTING:return{message:"当前网络不稳定",type:"warning"};case this.TIM.TYPES.NET_STATE_DISCONNECTED:return{message:"当前网络不可用",type:"error"};default:return""}},onNetStateChange:function(e){this.$store.commit("showMessage",this.checkoutNetState(e.data.state))},onKickOut:function(e){this.$store.commit("showMessage",{message:"".concat(this.kickedOutReason(e.data.type),"被踢出，请重新登录。"),type:"error"}),this.$store.commit("toggleIsLogin",!1),this.$store.commit("reset")},onUpdateConversationList:function(e){console.log("更新会话联系人列表",e),this.$store.commit("updateConversationList",e.data)},handleAt:function(e){for(var t=this,r=e.filter((function(e){return e.type===t.TIM.TYPES.MSG_TEXT&&e.payload.text.includes("@")})),n=0;n<r.length;n++){var s=r[n],o=s.payload.text.match(/@\w+/g);o&&(o.includes("@".concat(this.currentUserProfile.userID))&&(this.$store.getters.hidden&&this.notifyMe(s),ct()({title:"有人在群".concat(s.conversationID.slice(5),"提到了你"),message:s.payload.text,duration:3e3}),this.$bus.$emit("new-messsage-at-me",{data:{conversationID:s.conversationID}})))}},selectConversation:function(e){e!==this.currentConversation.conversationID&&this.$store.dispatch("checkoutConversation",e)},isJsonStr:function(e){try{return JSON.parse(e),!0}catch(t){return!1}},handleVideoMessage:function(e){var t=this,r=e.filter((function(e){return e.type===t.TIM.TYPES.MSG_CUSTOM&&t.isJsonStr(e.payload.data)}));if(0!==r.length){var n=JSON.parse(r[0].payload.data);if(n.action===yn.VIDEO_CALL_ACTION_DIALING){if(this.isBusy)return void this.$bus.$emit("busy",n,r[0]);this.$store.commit("GENERATE_VIDEO_ROOM",n.room_id),this.selectConversation(r[0].conversationID),r[0].from!==this.userID&&this.$bus.$emit("isCalled")}n.action===yn.VIDEO_CALL_ACTION_SPONSOR_CANCEL&&this.$bus.$emit("missCall"),n.action===yn.VIDEO_CALL_ACTION_REJECT&&this.$bus.$emit("isRefused"),n.action===yn.VIDEO_CALL_ACTION_SPONSOR_TIMEOUT&&this.$bus.$emit("missCall"),n.action===yn.VIDEO_CALL_ACTION_ACCEPTED&&this.$bus.$emit("isAccept"),n.action===yn.VIDEO_CALL_ACTION_HANGUP&&this.$bus.$emit("isHungUp"),n.action===yn.VIDEO_CALL_ACTION_LINE_BUSY&&this.$bus.$emit("isRefused"),n.action===yn.VIDEO_CALL_ACTION_ERROR&&this.$bus.$emit("isRefused")}},notifyMe:function(e){var t=this;"Notification"in window&&("granted"===window.Notification.permission?this.handleNotify(e):"denied"!==window.Notification.permission&&window.Notification.requestPermission().then((function(r){"granted"===r&&t.handleNotify(e)})))},handleNotify:function(e){var t=this,r=new window.Notification("有人提到了你",{icon:"https://webim-1252463788.file.myqcloud.com/demo/img/logo.dc3be0d4.png",body:e.payload.text});r.onclick=function(){window.focus(),t.$store.dispatch("checkoutConversation",e.conversationID),r.close()}},handleLinkClick:function(){oa.clickStat("link_two",{click:"true"})},handleQuitGroupTip:function(e){var t=this,r=e.filter((function(e){return t.currentConversation.conversationID===e.conversationID&&e.type===t.TIM.TYPES.MSG_GRP_TIP&&(e.payload.operationType===t.TIM.TYPES.GRP_TIP_MBR_QUIT||e.payload.operationType===t.TIM.TYPES.GRP_TIP_MBR_KICKED_OUT)}));r.length>0&&r.forEach((function(e){(Array.isArray(e.payload.userIDList)||e.payload.userIDList.length>0)&&t.$store.commit("deleteGroupMemberList",e.payload.userIDList)}))}}),sa),la=ua,pa=(r("0650"),Object(Z["a"])(la,ot,it,!1,null,null,null)),ma=pa.exports,fa=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"login-box"},[r("div",{staticClass:"login-wrapper"},[r("img",{staticClass:"logo",attrs:{src:e.logo}}),r("el-form",{ref:"login",staticStyle:{width:"100%"},attrs:{rules:e.rules,model:e.form,"label-width":"0"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}}},[r("el-form-item",{attrs:{prop:"userID"}},[r("el-select",{attrs:{placeholder:"请选择用户名"},model:{value:e.form.userID,callback:function(t){e.$set(e.form,"userID",t)},expression:"form.userID"}},e._l(e.userOptions,(function(e){return r("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)],1),r("el-form-item",{attrs:{prop:"password"}},[r("el-input",{attrs:{placeholder:"请输入密码",type:"password","show-password":"",clearable:""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)],1),r("el-button",{staticStyle:{width:"100%","margin-top":"6px"},attrs:{type:"primary",loading:e.loading},on:{click:e.submit}},[e._v("登录")]),r("div",{staticStyle:{width:"240px","text-align":"right"}},[r("el-button",{attrs:{type:"text"},on:{click:e.handelRegister}},[e._v("去注册")])],1)],1)])},da=[],ha=r("a1d8"),ga=r.n(ha),va=null,ba={name:"Login",components:{ElForm:ln.a},data:function(){var e=function(e,t,r){/^[a-zA-Z][a-zA-Z0-9_]{3,23}$/.test(t)?r():r(new Error("不合法（字母开头+字母/数字，长度4-24)"))};return{form:{userID:"root",password:"root"},rules:{userID:[{required:!0,message:"请输入 userID",trigger:"blur"},{validator:e,trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},logo:ga.a,registerVisible:!1,loading:!1,userOptions:[{name:"root"},{name:"root2"},{name:"root3"},{name:"root4"},{name:"root5"},{name:"Elaine"},{name:"Gemma"},{name:"Shailene"},{name:"Lydia"},{name:"Allison"}]}},beforeMount:function(){},methods:{submit:function(){var e=this;this.$refs["login"].validate((function(t){t&&e.submitLogin()}))},handelRegister:function(){},submitLogin:function(e,t){var r=this;va=D.a.service(),this.API.login({name:this.form.userID,pwd:this.form.password}).then((function(e){r.loading=!1,r.$store.commit("toggleIsLogin",!0),r.$store.commit("startComputeCurrent"),r.$nextTick((function(){va.close()})),localStorage.setItem("token",e.data.token),localStorage.setItem("userID",e.data.userInfo.ID),localStorage.setItem("userInfo",JSON.stringify(e.data.userInfo)),r.$router.push("/home"),r.$store.commit("showMessage",{type:"success",message:"登录成功"})})).catch((function(e){r.loading=!1,r.$store.commit("showMessage",{message:"登录失败：444"+e.message,type:"error"})}))}}},Oa=ba,ya=(r("990f"),Object(Z["a"])(Oa,fa,da,!1,null,"222d8c1c",null)),_a=ya.exports;q["default"].use(st["a"]);var Ca=[{path:"/",redirect:"/login"},{path:"/login",name:"login",component:_a},{path:"/home",name:"home",component:ma}],Ia=new st["a"]({mode:"history",routes:Ca});Ia.beforeEach(function(){var e=Object(ve["a"])(regeneratorRuntime.mark((function e(t,r,n){var s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("/login"!==t.path){e.next=2;break}return e.abrupt("return",n());case 2:return s=window.localStorage.getItem("token"),e.next=5,xe.checkAuth({token:s});case 5:if(o=e.sent,o.data){e.next=8;break}return e.abrupt("return",n("/login"));case 8:n();case 9:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}());var Pa=Ia;r("ed2c"),r("8e84");window.tim=ge,window.TIM=pe.a,window.API=xe,window.store=nt,q["default"].prototype.$bus=new q["default"],q["default"].prototype.tim=ge,q["default"].prototype.TIM=pe.a,q["default"].prototype.API=xe,q["default"].prototype.$store=nt,q["default"].prototype.$message=V.a,q["default"].use(B.a),q["default"].use($.a),q["default"].use(G.a),q["default"].use(A.a),q["default"].use(L.a),q["default"].use(k.a),q["default"].use(D.a),q["default"].use(j.a),q["default"].use(M.a),q["default"].use(P.a),q["default"].use(C.a),q["default"].use(y.a),q["default"].use(b.a),q["default"].use(g.a),q["default"].use(d.a),q["default"].use(m.a),q["default"].use(l.a),q["default"].use(c.a),q["default"].use(i.a),q["default"].use(s.a),q["default"].component("avatar",ee),new q["default"]({router:Pa,render:function(e){return e(ie)}}).$mount("#app")},"597a":function(e,t,r){"use strict";var n=r("1e3a"),s=r.n(n);s.a},"5aaf":function(e,t,r){},"5e1b":function(e,t,r){"use strict";var n=r("9256"),s=r.n(n);s.a},6160:function(e,t,r){"use strict";var n=r("0f85"),s=r.n(n);s.a},"64a9":function(e,t,r){},"64ef":function(e,t,r){"use strict";var n=r("7a40"),s=r.n(n);s.a},6829:function(e,t,r){},"691c":function(e,t,r){"use strict";var n=r("5406"),s=r.n(n);s.a},"704b":function(e,t,r){},7177:function(e,t,r){},"777c":function(e,t,r){"use strict";var n=r("c1f9"),s=r.n(n);s.a},"7a40":function(e,t,r){},"7a62":function(e,t,r){},8127:function(e,t,r){"use strict";var n=r("12d4"),s=r.n(n);s.a},"854e":function(e,t,r){},8610:function(e,t,r){"use strict";var n=r("4988"),s=r.n(n);s.a},"86b5":function(e,t,r){"use strict";var n=r("b8dc"),s=r.n(n);s.a},"8e84":function(e,t,r){},"8e94":function(e,t,r){},"902f":function(e,t,r){},9256:function(e,t,r){},"95a3":function(e,t,r){},9668:function(e,t,r){"use strict";var n=r("1b21"),s=r.n(n);s.a},9908:function(e,t,r){},"990f":function(e,t,r){"use strict";var n=r("8e94"),s=r.n(n);s.a},"9f24":function(e,t,r){"use strict";var n=r("f179"),s=r.n(n);s.a},a1d8:function(e,t,r){e.exports=r.p+"img/logo.dc3be0d4.png"},a359:function(e,t,r){},a433:function(e,t,r){},a86b:function(e,t,r){"use strict";var n=r("854e"),s=r.n(n);s.a},afca:function(e,t,r){"use strict";var n=r("704b"),s=r.n(n);s.a},b849:function(e,t,r){"use strict";var n=r("fbe1"),s=r.n(n);s.a},b8dc:function(e,t,r){},c1f9:function(e,t,r){},c4b9:function(e,t,r){},c635:function(e,t,r){"use strict";var n=r("d24c"),s=r.n(n);s.a},c6b9:function(e,t,r){"use strict";var n=r("902f"),s=r.n(n);s.a},ce0c:function(e,t,r){"use strict";var n=r("95a3"),s=r.n(n);s.a},ce90:function(e,t,r){"use strict";var n=r("3a1d"),s=r.n(n);s.a},d24c:function(e,t,r){},d4e4:function(e,t,r){},d6a4:function(e,t,r){"use strict";var n=r("7177"),s=r.n(n);s.a},daca:function(e,t,r){"use strict";var n=r("d4e4"),s=r.n(n);s.a},daf3:function(e,t,r){"use strict";var n=r("c4b9"),s=r.n(n);s.a},e225:function(e,t,r){"use strict";var n=r("34a8"),s=r.n(n);s.a},e26e:function(e,t,r){},e3ec:function(e,t,r){"use strict";var n=r("53b9"),s=r.n(n);s.a},e6da:function(e,t,r){"use strict";var n=r("a359"),s=r.n(n);s.a},eaaf:function(e,t,r){},ed2c:function(e,t,r){},f179:function(e,t,r){},f6e3:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACpCAMAAAHy0MbyAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAJYUExURQrBYAvBYRPDZhzGbCXIcSrJdSHHbxjFaQ7CYwzBYSnJdEzSi3bcpqLnw87z3+X47uj58Ov68uz68+n58ef579/36rzu05Djt2TYmz7OghnFai/KeIHfrcPw2OP47fz+/f////P8+Nb15K7ry1vVlBrFaw7CYlDTjqrqyPP899j15YrhsxDCZFfUksDv1vr+/C7KdyzKdq3qynLbo2HXmf7//rTszhTDZo/jtk7SjCjJc7nt0fX9+THLes3y3/3//oXgsA3CYjTMe5HjuA/CY8/z4IDfrRbEaLft0GbYnO779Pb9+cLv1x3GbNL04ub575zmv5flvEDPgzDLeaXoxIzitPD79TXMfB7GbeL47F7WlhLDZavqyfj9+03SjN326YvitEbQh3jdqO/79CLHcLHrzE/TjSPHcOT47vH79rHrzUvSivf9+vn++8zy3lXUkdf15SDHblnVk+D36ybIclrVlGfZnHjdpznNf1HTjhfEadv26I3itUfRiMfx26Pow0HPhJPkuZjlvMHv1zjNfkTQhWnZnhvFa8ry3TLLepXkurbt0Gvan4LfrknRiV/Wl9X05HHbo7/v1Z3mv8jx24jhskjRiTrNf8nx3Mvy3WLXmUfQh0XQhu3681LTj9n15ljVk2XYm6/ry+H37Or68bXsz2PYmjfMfW3aoLvu0zbMfTPLe77u1S7KeErRirDrzNr253fcpkPPhSvJdafpxr3u1N736n/frPL89o7itW/boWDXl3ndqJvmvvv+/Xveqsbx2tz26fT8+BHDZD3OgYTgr4fhsQAAAKRC35oAAADIdFJOU/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8A9ppxxwAAAAlwSFlzAAAXEQAAFxEByibzPwAABVpJREFUaEPt2zuP2koUB3BaN1dCLikwols5fVb5Cim3QaxEtNomDdJKaHWbbaBASPcTUKVBShv6NNH6e2Uefxs/5u0H7NX5NXiOzwwjY+yxPR4N422MhYqEw/KFiDbiZ3UY0V7D1ThizDMiAmIcIkIURaycxlGEQCFLRvUvlDJ8/j+MP2OhTGymxoqxCDc2ioz6/mgo5hB1C39BtBZGkEFAQIiLERKiKN2xtc0ffpSkD1MsVhzxSZxgoydLlA2QKfyLmA7S4Buiaitk5RBWQ04BYTXkFBBWQ04BYTXkFA6IqyCl5AvWNGB9DVbWYW3NGWvVZGOZsb8X8i+MAiHe5rOFeYfMbcSuliQzlA3WSGUQ0fqGPAExHWRJvxFUwzk2h6gacnKIqiEnt0VYCTm5FcJKyMlVzrB1yMl9tFzTBn5ASgFxFWRc6I+YSCjDmoZGDzisq8PaKuWQR52qaTi/BKjB2jo28mZjb7k2TkRRLGv9lCcgTUdrkiQbpbZTVk5003VYH2X3lo4SQkiAN3EokhYbBNuqDFWkN6xqoTRWKmt5d2SJZhSQESQfAyohJwRa0ECSvzka0LhHmrcZGtBYI80b6usYR1kG7ARuRO1KH63d0D8GausFdfiAykbI9fAdNS0+Id2RU2cl1HCivHrQ8bgPihpuvqOSi/RxFRd4XSwyU1bEIndKUcVbym8fYplhBeNlswfWVIJuTXh35WIH7lhjvEHhAcEuRO9/ZKOrPSKEEEIIIVey+e+f8Wy8e3V4yuxuWb4AV02QCFO/rH9CvB3FLRPlbB5P6lsmWBnuBQ3VYXUwNNPg8NTPhA+o1Vr9eKb7UUgJUnt8WDFHTgDDXTkGSQHM97ncHt6ooAGN4NtctstZZHnbo74O0rxpHsgVkObtHvV1Qq+4be2G3hCndiVqV6J2pb7afUJ9HbcpYk316Xx15smAeqiuhzxPW9TWq8xQdmW9u+53J7VQ3Dc0CJgCa98KHJLd2c5tOaQ7QzUr46yoJpeNK3ndY85QyYXPcApV3KCOA9cfTZqglp1fu+7/utT9Z9NNoFJLj2s8nuBYZSxx1dKd919OTKxixLOiNC+OnnkJBdtUKzN+ALo8gub/byy2xVq6bMRKoR3WxekjllfsJw1+fl7H+pjEfHd65ztKV90did/q8hynw+lmomEIfi6mdEKr284nx02y7GlPU+4IIYQQQgghhBBisVxuNptOp4j0YpOt60/wF/MfN9nvHzt0UGH2OfTJUT9eTdMipPmt9Hhj2K4Vr6hwTYcFOuOiu3lUYZauWzZ31S3s90hD2F3vQKF4xdBudq3/3G90wFfoc+t2grYtN75Gf1/x5QEWaGJAL7YpBSah0w3C2SZWGI0HPzzoJ0+66GZ2rDuPV+tUWkyvDGKbvGOx7vbxn9UnfG+g1cDnirbdfUE7A6Hu9om62yfqbp+ou336YN1tMTjn4oFPwm5TR/U6m+flJOCKvSr8vZQA5ZlggQa8/jn7TMTU8ZpZ20ary7SLfMpiv9J2V2klsfuE3WBHfFcnMjTal32buwsKcfgbcQ463bRSfxeZ6Rpf0a2A9xtcTLo4fKn0soH3fAp6P/o4xfWw3+amPfzhetpzuR2+olv3fMp89+56HJ1F+4kCdpQTihVnuc/HB5TLDpOB75VJE9GjZKX6cow1Bx0xWkR4A+AB5ZIU58Gejq5hnnGUaxxCMdacnlC+EZP8qHwqvwyB/ZZF0xt7RSJdF4eN6Wl7PP7asoHmFNv2J5JuyVk3Wnu8yt/fKkq32Jwlq/tbflMmet/e/ZEdncZfj0Gvvw4s35ztXpkjhBBCCCGkrdHoLzv9X1u4OdoGAAAAAElFTkSuQmCC"},fbe1:function(e,t,r){}});