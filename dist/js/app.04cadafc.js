(function(e){function t(t){for(var r,o,i=t[0],c=t[1],u=t[2],f=0,d=[];f<i.length;f++)o=i[f],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&d.push(s[o][0]),s[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(d.length)d.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,i=1;i<n.length;i++){var c=n[i];0!==s[c]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},s={app:0},a=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"014d":function(e,t,n){"use strict";var r=n("a433"),s=n.n(r);s.a},"0362":function(e,t,n){},"0a44":function(e,t,n){"use strict";var r=n("6829"),s=n.n(r);s.a},"0b14":function(e,t,n){"use strict";var r=n("4753"),s=n.n(r);s.a},"0c24":function(e,t,n){},"12d4":function(e,t,n){},1756:function(e,t,n){"use strict";var r=n("0362"),s=n.n(r);s.a},"1b21":function(e,t,n){},"1bd4":function(e,t,n){},"1fdb":function(e,t,n){},2054:function(e,t,n){"use strict";var r=n("fc3e"),s=n.n(r);s.a},"224b":function(e,t,n){"use strict";var r=n("5056"),s=n.n(r);s.a},2482:function(e,t,n){"use strict";var r=n("fee6"),s=n.n(r);s.a},"25ca":function(e,t,n){"use strict";var r=n("34c3"),s=n.n(r);s.a},"275a":function(e,t,n){},"34c3":function(e,t,n){},"3a1d":function(e,t,n){},"3a4c":function(e,t,n){"use strict";var r=n("d274"),s=n.n(r);s.a},"3f3f":function(e,t,n){},4011:function(e,t,n){"use strict";var r=n("7a62"),s=n.n(r);s.a},4753:function(e,t,n){},"47b1":function(e,t,n){"use strict";var r=n("9908"),s=n.n(r);s.a},"480b":function(e,t,n){"use strict";var r=n("3f3f"),s=n.n(r);s.a},"4d06":function(e,t,n){"use strict";var r=n("0c24"),s=n.n(r);s.a},5056:function(e,t,n){},"53b9":function(e,t,n){},5406:function(e,t,n){},"54c0":function(e,t,n){},"54c3":function(e,t,n){},"568c":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("bd49"),n("450d");var r=n("18ff"),s=n.n(r),a=(n("960d"),n("defb")),o=n.n(a),i=(n("cb70"),n("b370")),c=n.n(i),u=(n("a7cc"),n("df33")),l=n.n(u),f=(n("075a"),n("72aa")),d=n.n(f),p=(n("b0ee"),n("d180")),m=n.n(p),g=(n("a335"),n("c0bb")),h=n.n(g),v=(n("b5d8"),n("f494")),b=n.n(v),y=(n("826b"),n("c263")),O=n.n(y),C=(n("e612"),n("dd87")),_=n.n(C),I=(n("be4f"),n("896a")),M=n.n(I),w=(n("acb6"),n("c673")),E=n.n(w),T=(n("920a"),n("4f0c")),P=n.n(T),D=(n("10cb"),n("f3ad")),S=n.n(D),k=(n("f4f9"),n("c2cc")),j=n.n(k),L=(n("7a0f"),n("0f6c")),A=n.n(L),x=(n("1951"),n("eedf")),U=n.n(x),N=(n("0fb7"),n("f529")),R=n.n(N),G=(n("9e1f"),n("6ed5")),$=n.n(G),Y=(n("cadf"),n("551c"),n("f751"),n("097d"),n("2b0e")),F=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"avatar",class:"circle"===e.shape?"shape-circle":""},[n("img",{attrs:{src:e.avatarSrc}})])},B=[],q=n("f6e3"),H=n.n(q),V={props:{src:String,type:{type:String,default:"C2C"},shape:{type:String,default:"circle"}},computed:{avatarSrc:function(){var e=this.src;return/^(https:|http:|\/\/)/.test(e)?e:this.defaultSrc},defaultSrc:function(){switch(this.type){case"C2C":return"https://imgcache.qq.com/open/qcloud/video/act/webim-avatar/avatar-2.png";case"GROUP":return"https://imgcache.qq.com/open/qcloud/video/act/webim-avatar/avatar-3.png";case this.TIM.TYPES.CONV_SYSTEM:return H.a;default:return"https://imgcache.qq.com/open/qcloud/video/act/webim-avatar/avatar-1.png"}}}},K=V,z=(n("691c"),n("2877")),W=Object(z["a"])(K,F,B,!1,null,"bd1b31fe",null),J=W.exports,Q=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[e.isLogin?n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.showLoading,expression:"showLoading"}],staticClass:"loading",attrs:{"element-loading-text":"正在拼命初始化...","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[n("div",{staticClass:"chat-wrapper"},[n("header-bar"),n("el-row",[n("el-col",{attrs:{span:4}},[n("side-bar")],1),n("el-col",{attrs:{span:12}},[n("current-conversation")],1),n("el-col",{attrs:{span:8}},[n("right-side")],1)],1)],1),n("image-previewer")],1):n("div",{attrs:{id:"wrapper"}},[n("login")],1)])},X=[],Z=(n("8e6e"),n("456d"),n("ac6a"),n("46a1"),n("e5f2")),ee=n.n(Z),te=(n("4917"),n("6762"),n("2fdb"),n("7f7f"),n("bd86")),ne=n("2f62"),re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"current-conversation-wrapper"},[e.showCurrentConversation?n("div",{staticClass:"current-conversation",on:{scroll:e.onScroll}},[n("div",{staticClass:"header"},[n("div",{staticClass:"name"},[e._v(e._s(e.name)+" "+e._s(e.currentConversationTitle)+" ")])]),n("div",{staticClass:"content"},[n("div",{ref:"message-list",staticClass:"message-list",on:{scroll:this.onScroll}},[e.isCompleted?n("div",{staticClass:"no-more"},[e._v("没有更多了")]):n("div",{staticClass:"more"},[n("el-button",{attrs:{type:"text"},on:{click:function(t){return e.$store.dispatch("getMoreHistoryMessageList",e.currentConversation.conversationID)}}},[e._v("查看更多")])],1),e._l(e.currentMessageList,(function(e){return n("message-item",{key:e.ID,attrs:{message:e}})}))],2),n("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowScrollButtomTips,expression:"isShowScrollButtomTips"}],staticClass:"newMessageTips",on:{click:e.scrollMessageListToButtom}},[e._v("\n        回到最新位置\n      ")])]),e.showMessageSendBox?n("div",{staticClass:"footer"},[n("message-send-box")],1):e._e()]):e._e()])},se=[],ae=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{style:e.focus?{backgroundColor:"white"}:{},attrs:{id:"message-send-box-wrapper"},on:{drop:e.dropHandler}},[n("div",{staticClass:"send-header-bar"},[n("el-popover",{attrs:{placement:"top",width:"400",trigger:"click"}},[n("div",{staticClass:"emojis"},e._l(e.emojiName,(function(t){return n("div",{key:t,staticClass:"emoji",on:{click:function(n){return e.chooseEmoji(t)}}},[n("img",{staticStyle:{width:"30px",height:"30px"},attrs:{src:e.emojiUrl+e.emojiMap[t]}})])})),0),n("i",{staticClass:"iconfont icon-smile",attrs:{slot:"reference",title:"发表情"},slot:"reference"})]),n("i",{staticClass:"iconfont icon-tupian",attrs:{title:"发图片"},on:{click:e.handleSendImageClick}})],1),n("el-popover",{staticStyle:{"max-height":"500px","overflow-y":"scroll"},attrs:{trigger:"manual",placement:"top"},model:{value:e.showAtGroupMember,callback:function(t){e.showAtGroupMember=t},expression:"showAtGroupMember"}},e._l(e.memberList,(function(t){return n("el-radio-group",{key:t.userID,staticStyle:{display:"flex","flex-decoration":"column"},on:{change:e.handleSelectAtUser},model:{value:e.atUserID,callback:function(t){e.atUserID=t},expression:"atUserID"}},[n("el-radio",{attrs:{label:t.userID}},[e._v(e._s(t.nameCard||t.nick||t.userID))])],1)})),1),n("div",{staticClass:"bottom"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.messageContent,expression:"messageContent"}],ref:"text-input",staticClass:"text-input",attrs:{rows:"4",resize:"false"},domProps:{value:e.messageContent},on:{focus:function(t){e.focus=!0},blur:function(t){e.focus=!1},keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:(t.preventDefault(),e.handleEnter(t))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"])?null:(t.stopPropagation(),e.handleUp(t))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"])?null:(t.stopPropagation(),e.handleDown(t))}],keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?(t.preventDefault(),t.shiftKey||t.altKey||t.metaKey?null:e.handleLine(t)):null},input:function(t){t.target.composing||(e.messageContent=t.target.value)}}}),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"按Enter发送消息，Ctrl+Enter换行",placement:"left-start"}},[n("div",{staticClass:"btn-send",on:{click:e.sendTextMessage}},[n("div",{staticClass:"tim-icon-send"})])])],1),n("input",{ref:"imagePicker",staticStyle:{display:"none"},attrs:{type:"file",id:"imagePicker",accept:".jpg, .jpeg, .png, .gif"},on:{change:e.sendImage}})],1)},oe=[],ie=(n("20d6"),n("0c67"),n("299c")),ce=n.n(ie),ue=(n("fe07"),n("6ac5")),le=n.n(ue),fe=(n("06f1"),n("6ac9")),de=n.n(fe),pe="https://oss.pocketuniversity.cn/media/2020-08-20/",me={"[啊]":"5f3e1581eb5f5.png","[爱你]":"5f3e1581eb402.png","[花痴]":"5f3e15825e436.png","[爱心]":"5f3e1581e76e7.png","[白眼]":"5f3e1581ed254.png","[便便]":"5f3e1581eb8c9.png","[鼻涕]":"5f3e158200cf1.png","[闭嘴]":"5f3e158231e7d.png","[不舒服]":"5f3e158232df3.png","[大惊]":"5f3e15823223b.png","[大闹]":"5f3e158231e2a.png","[大笑]":"5f3e15823e0d7.png","[点赞]":"5f3e15823df23.png","[恶魔]":"5f3e15823ebe1.png","[嗯]":"5f3e15823dd3c.png","[饿死]":"5f3e2a38063f3.png","[发呆]":"5f3e158248254.png","[打瞌睡]":"5f3e158232280.png","[犯困]":"5f3e158249b01.png","[飞吻]":"5f3e158249867.png","[奋斗]":"5f3e15824c2af.png","[愤怒]":"5f3e158253476.png","[尴尬]":"5f3e158253108.png","[感冒]":"5f3e158254120.png","[怪物]":"5f3e158254af0.png","[汗颜]":"5f3e15825cd82.png","[好吃]":"5f3e158255439.png","[哼]":"5f3e15825f6d6.png","[坏笑]":"5f3e15825e75f.png","[呼气]":"5f3e15825e9cd.png","[惊恐]":"5f3e1582689ff.png","[惊悚]":"5f3e158268a2c.png","[惊讶]":"5f3e15826a463.png","[开心]":"5f3e15826a998.png","[瞌睡]":"5f3e15826b430.png","[酷]":"5f3e158272929.png","[骷髅]":"5f3e1582734af.png","[冷]":"5f3e158273cc4.png","[冷酷]":"5f3e1582746a6.png","[流鼻血]":"5f3e158274737.png","[流汗]":"5f3e158283063.png","[流口水]":"5f3e158280489.png","[流泪]":"5f3e158280557.png","[骂人]":"5f3e158282e5f.png","[懵逼]":"5f3e158282ac6.png","[面无表情]":"5f3e15828d122.png","[难过]":"5f3e1582898e0.png","[呕吐]":"5f3e15828d34c.png","[忍者]":"5f3e15828e21c.png","[三条线]":"5f3e1582926fc.png","[生气]":"5f3e158296363.png","[失魄]":"5f3e158298c35.png","[受伤]":"5f3e1582975e6.png","[帅]":"hf3e15828f9e8.png","[睡醒]":"5f3e15829a60d.png","[睡着]":"5f3e15829a71c.png","[死了]":"5f3e15829edde.png","[贪吃]":"5f3e15829eeda.png","[吐舌]":"5f3e297ea293d.png","[讨厌]":"5f3e1582a1bea.png","[天使]":"5f3e293757964.png","[调皮]":"5f3e1582a3376.png","[无聊]":"5f3e2a625054f.png","[献吻]":"5f3e1582a4f86.png","[笑哭]":"5f3e1582accf4.png","[笑掉大牙]":"5f3e1582a8b02.png","[笑脸]":"5f3e1582ab79e.png","[吓死]":"5f3e1582ad70e.png","[斜眼]":"5f3e1582ada7a.png","[星星眼]":"5f3e1582ae06e.png","[心碎]":"5f3e1582b1375.png","[凶]":"5f3e1582b670d.png","[疑问]":"5f3e1582b58d9.png","[幽灵]":"5f3e29f0d94c3.png","[又死了]":"5f3e29c9827f3.png","[有意思]":"5f3e1582b72e9.png","[晕]":"5hf3e1582b729d.png","[炸弹]":"5f3e1582b85bd.png","[猪头]":"5f3e1582b98c8.png","[呲牙]":"5f3e1582bf3ff.png"},ge=Object.keys(me);function he(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?he(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):he(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var be={name:"message-send-box",props:["scrollMessageListToButtom"],components:{ElPopover:de.a,ElRadioGroup:le.a,ElRadio:b.a,ElTooltip:ce.a},data:function(){return{colors:["#99A9BF","#F7BA2A","#FF9900"],messageContent:"",isSendCustomMessage:!1,sendCustomDialogVisible:!1,surveyDialogVisible:!1,form:{data:"",description:"",extension:""},rate:5,suggestion:"",file:"",emojiMap:me,emojiName:ge,emojiUrl:pe,showAtGroupMember:!1,atUserID:"",focus:!1}},computed:ve(ve({},Object(ne["b"])(["toAccount","currentConversationType"])),Object(ne["c"])({memberList:function(e){return e.group.currentMemberList},userID:function(e){return e.user.userID}})),mounted:function(){this.$refs["text-input"].addEventListener("paste",this.handlePaste),this.$bus.$on("reEditMessage",this.reEditMessage)},beforeDestroy:function(){this.$refs["text-input"].removeEventListener("paste",this.handlePaste)},methods:{reEditMessage:function(e){this.messageContent=e},handleSelectAtUser:function(){this.messageContent+=this.atUserID+" ",this.showAtGroupMember=!1},handleUp:function(){var e=this,t=this.memberList.findIndex((function(t){return t.userID===e.atUserID}));t-1<0||(this.atUserID=this.memberList[t-1].userID)},handleDown:function(){var e=this,t=this.memberList.findIndex((function(t){return t.userID===e.atUserID}));t+1>=this.memberList.length||(this.atUserID=this.memberList[t+1].userID)},handleEnter:function(){this.showAtGroupMember?this.handleSelectAtUser():this.sendTextMessage()},handleLine:function(){this.messageContent+="\n"},handlePaste:function(e){var t,n=this,r=e.clipboardData;if(r&&r.files&&r.files.length>0&&(t=r.files[0]),"undefined"!==typeof t){var s=this.tim.createImageMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{file:t},onProgress:function(e){n.$set(s,"progress",e)}});this.$store.commit("pushCurrentMessageList",s);var a=this.tim.sendMessage(s);a.catch((function(e){n.$store.commit("showMessage",{type:"error",message:e.message})}))}},dropHandler:function(e){var t=this;e.preventDefault();var n=e.dataTransfer.files[0],r={};r="video/mp4"===n.type?this.tim.createVideoMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{file:n},onProgress:function(e){t.$set(r,"progress",e)}}):this.tim.createFileMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{file:n},onProgress:function(e){t.$set(r,"progress",e)}}),this.$store.commit("pushCurrentMessageList",r),this.tim.sendMessage(r).then((function(){t.$refs.videoPicker.value=null})).catch((function(e){t.$store.commit("showMessage",{message:e.message,type:"error"})}))},sendTextMessage:function(){var e=this;if(""===this.messageContent||0===this.messageContent.trim().length)return this.messageContent="",void this.$store.commit("showMessage",{message:"不能发送空消息哦！",type:"info"});var t=this.tim.createTextMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{text:this.messageContent}});this.$store.commit("pushCurrentMessageList",t),this.$bus.$emit("scroll-bottom"),this.tim.sendMessage(t).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})})),this.messageContent=""},chooseEmoji:function(e){this.messageContent+=e},handleSendImageClick:function(){this.$refs.imagePicker.click()},sendImage:function(){var e=this,t=this.tim.createImageMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{file:document.getElementById("imagePicker")},onProgress:function(n){e.$set(t,"progress",n)}});this.$store.commit("pushCurrentMessageList",t),this.tim.sendMessage(t).then((function(){e.$refs.imagePicker.value=null})).catch((function(t){e.$store.commit("showMessage",{message:t.message,type:"error"})}))}}},ye=be,Oe=(n("f0f6"),Object(z["a"])(ye,ae,oe,!1,null,"2f1c6851",null)),Ce=Oe.exports,_e=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"message-wrapper",class:e.messagePosition},[e.currentConversationType===e.TIM.TYPES.CONV_C2C?n("div",{staticClass:"c2c-layout",class:e.messagePosition},[e.showAvatar?n("div",{staticClass:"col-1"},[n("avatar",{attrs:{src:e.avatar}})],1):e._e(),n("div",{staticClass:"col-2"},[n("div",{staticClass:"content-wrapper"},[e.isMine?n("message-status-icon",{attrs:{message:e.message}}):e._e(),e.message.type===e.TIM.TYPES.MSG_TEXT?n("text-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_IMAGE?n("image-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_FILE?n("file-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_SOUND?n("sound-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_GRP_TIP?n("group-tip-element",{attrs:{payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_GRP_SYS_NOTICE?n("group-system-notice-element",{attrs:{payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_CUSTOM?n("custom-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_FACE?n("face-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_VIDEO?n("video-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_GEO?n("geo-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):n("span",[e._v("暂未支持的消息类型："+e._s(e.message.type))])],1),e.showMessageHeader?n("message-footer",{attrs:{message:e.message}}):e._e()],1),n("div",{staticClass:"col-3"})]):e._e(),e.currentConversationType===e.TIM.TYPES.CONV_GROUP?n("div",{staticClass:"group-layout",class:e.messagePosition},[e.showAvatar?n("div",{staticClass:"col-1"},[n("avatar",{staticClass:"group-member-avatar",attrs:{src:e.avatar},nativeOn:{click:function(t){return e.showGroupMemberProfile(t)}}})],1):e._e(),n("div",{staticClass:"col-2"},[e.showMessageHeader?n("message-header",{attrs:{message:e.message}}):e._e(),n("div",{staticClass:"content-wrapper"},[e.isMine?n("message-status-icon",{attrs:{message:e.message}}):e._e(),e.message.type===e.TIM.TYPES.MSG_TEXT?n("text-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_IMAGE?n("image-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_FILE?n("file-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_SOUND?n("sound-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_GRP_TIP?n("group-tip-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_CUSTOM?n("custom-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_FACE?n("face-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_VIDEO?n("video-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_GEO?n("geo-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):n("span",[e._v("暂未支持的消息类型："+e._s(e.message.type))])],1)],1),n("div",{staticClass:"col-3"})]):e._e(),e.currentConversationType===e.TIM.TYPES.CONV_SYSTEM?n("div",{staticClass:"system-layout"},[n("div",{staticClass:"col-1"},[n("avatar",{attrs:{src:e.avatar,type:e.currentConversationType}})],1),n("div",{staticClass:"col-2"},[n("message-header",{attrs:{message:e.message}}),n("group-system-notice-element",{attrs:{payload:e.message.payload,message:e.message}})],1)]):e._e()])},Ie=[],Me=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.messageIconClass,staticStyle:{width:"16px",height:"16px"},on:{click:e.handleIconClick}},[e._v(e._s("message-send-fail"===e.messageIconClass?"!":""))])},we=[],Ee={name:"MessageStatusIcon",props:{message:{type:Object,required:!0}},computed:{messageIconClass:function(){switch(this.message.status){case"unSend":return"el-icon-loading";case"fail":return"message-send-fail";default:return""}}},methods:{handleIconClick:function(){var e=this;"message-send-fail"===this.messageIconClass&&this.tim.resendMessage(this.message).catch((function(t){e.$store.commit("showMessage",{message:t.message,type:"error"})}))}}},Te=Ee,Pe=(n("a86b"),Object(z["a"])(Te,Me,we,!1,null,"97210bde",null)),De=Pe.exports,Se=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"base",class:[e.isMine?"right":"left"]},[n("div",{staticClass:"name text-ellipsis"},[e._v(e._s(e.from))]),n("div",{staticClass:"date"},[e._v(e._s(e.date))])])},ke=[];function je(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",n=e.getFullYear(),r=e.getMonth()+1,s=e.getDate();return"".concat(n).concat(t).concat(Ue(r)).concat(t).concat(Ue(s))}function Le(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.getHours(),r=e.getMinutes(),s=e.getSeconds();return t?"".concat(Ue(n),":").concat(Ue(r),":").concat(Ue(s)):"".concat(n,":").concat(Ue(r))}function Ae(e){return"".concat(je(e)," ").concat(Le(e))}function xe(e){return e.toDateString()===(new Date).toDateString()}function Ue(e){return e<10?"0".concat(e):e}function Ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ne(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ge={name:"MessageHeader",props:{message:{type:Object,required:!0}},computed:Re(Re({},Object(ne["c"])({currentConversation:function(e){return e.conversation.currentConversation},currentUserProfile:function(e){return e.user.currentUserProfile},currentMemberList:function(e){return e.group.currentMemberList}})),{},{date:function(){return Ae(new Date(1e3*this.message.time))},from:function(){var e=this.currentConversation.type===this.TIM.TYPES.CONV_C2C;return this.isMine?this.currentUserProfile.nick||this.currentUserProfile.userID:e?this.currentConversation.userProfile.nick||this.currentConversation.userProfile.userID:this.currentConversation.type===this.TIM.TYPES.CONV_SYSTEM?this.message.type===this.TIM.TYPES.MSG_GRP_SYS_NOTICE?"群系统通知":"系统通知":this.message.nick||this.message.from},isMine:function(){return"out"===this.message.flow}})},$e=Ge,Ye=(n("6b14"),Object(z["a"])($e,Se,ke,!1,null,"2cc0a061",null)),Fe=Ye.exports,Be=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"base",class:[e.isMine?"right":"left"]},[n("div",{staticClass:"date"},[e._v(e._s(e.date))])])},qe=[];function He(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?He(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):He(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ke={name:"MessageFooter",props:{message:{type:Object,required:!0}},computed:Ve(Ve({},Object(ne["c"])({currentConversation:function(e){return e.conversation.currentConversation},currentUserProfile:function(e){return e.user.currentUserProfile},currentMemberList:function(e){return e.group.currentMemberList}})),{},{date:function(){return Ae(new Date(1e3*this.message.time))},from:function(){var e=this.currentConversation.type===this.TIM.TYPES.CONV_C2C;return this.isMine?this.currentUserProfile.nick||this.currentUserProfile.userID:e?this.currentConversation.userProfile.nick||this.currentConversation.userProfile.userID:this.message.nick||this.message.from},isMine:function(){return"out"===this.message.flow}})},ze=Ke,We=(n("e017"),Object(z["a"])(ze,Be,qe,!1,null,"11baf300",null)),Je=We.exports,Qe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[n("div",{staticClass:"file-element-wrapper",attrs:{title:"单击下载"},on:{click:e.downloadFile}},[n("div",{staticClass:"header"},[n("i",{staticClass:"el-icon-document file-icon"}),n("div",{staticClass:"file-element"},[n("span",{staticClass:"file-name"},[e._v(e._s(e.fileName))]),n("span",{staticClass:"file-size"},[e._v(e._s(e.size))])])]),e.showProgressBar?n("el-progress",{attrs:{percentage:e.percentage,color:function(e){return 100===e?"#67c23a":"#409eff"}}}):e._e()],1)])},Xe=[],Ze=(n("6b30"),n("c284")),et=n.n(Ze),tt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"chat-bubble",on:{mousedown:function(e){e.stopPropagation()},contextmenu:function(e){e.preventDefault()}}},[e.message.isRevoked?e._e():n("el-dropdown",{ref:"dropdown",attrs:{trigger:""},on:{command:e.handleCommand}},[n("div",{staticStyle:{display:"flex"}},[e.isMine?n("div",{staticClass:"message-status"},[n("span",[e._v(e._s(e.messageReadByPeer))])]):e._e(),n("div",{staticClass:"message-content",class:e.bubbleStyle},[e._t("default")],2)]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e.isMine?n("el-dropdown-item",{attrs:{command:"revoke"}},[e._v("撤回")]):e._e()],1)],1),e.message.isRevoked?n("div",{staticClass:"group-tip-element-wrapper"},[e._v("\n    "+e._s(e.text)+"\n    "),n("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isEdit,expression:"isEdit"}],staticClass:"edit-button",attrs:{type:"text",size:"mini"},on:{click:e.reEdit}},[e._v(" 重新编辑")])],1):e._e()],1)},nt=[],rt={name:"MessageBubble",data:function(){return{isTimeout:!1}},props:{isMine:{type:Boolean},isNew:{type:Boolean},message:{type:Object,required:!0}},created:function(){this.isTimeoutHandler()},mounted:function(){this.$refs.dropdown&&this.$refs.dropdown.$el&&this.$refs.dropdown.$el.addEventListener("mousedown",this.handleDropDownMousedown)},beforeDestroy:function(){this.$refs.dropdown&&this.$refs.dropdown.$el&&this.$refs.dropdown.$el.removeEventListener("mousedown",this.handleDropDownMousedown)},computed:{bubbleStyle:function(){var e="";return this.isMine?e+="message-send":e+="message-received",this.isNew&&(e+="new"),e},text:function(){return this.message.conversationType!==this.TIM.TYPES.CONV_C2C||this.isMine?this.message.conversationType!==this.TIM.TYPES.CONV_GROUP||this.isMine?"你撤回了一条消息":"".concat(this.message.from,"撤回了一条消息"):"对方撤回了一条消息"},messageReadByPeer:function(){return this.message.conversationType===this.TIM.TYPES.CONV_C2C&&this.message.isPeerRead?"已读":this.message.conversationType!==this.TIM.TYPES.CONV_C2C||this.message.isPeerRead?"":"未读"},isEdit:function(){return!!this.isMine&&(this.message.type===this.TIM.TYPES.MSG_TEXT&&!this.isTimeout)}},methods:{handleDropDownMousedown:function(e){this.isMine&&!this.isTimeout&&2===e.buttons&&(this.$refs.dropdown.visible?this.$refs.dropdown.hide():this.$refs.dropdown.show())},handleCommand:function(e){var t=this;switch(e){case"revoke":this.tim.revokeMessage(this.message).then((function(){t.isTimeoutHandler()})).catch((function(e){t.$store.commit("showMessage",{message:e,type:"warning"})}));break;case"delete":break;default:break}},isTimeoutHandler:function(){var e=new Date;parseInt(e.getTime()/1e3)-this.message.time>120?this.isTimeout=!0:setTimeout(this.isTimeoutHandler,1e3)},reEdit:function(){this.$bus.$emit("reEditMessage",this.message.payload.text)}}},st=rt,at=(n("1756"),Object(z["a"])(st,tt,nt,!1,null,"6d29d32e",null)),ot=at.exports,it={name:"FileElement",props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},components:{MessageBubble:ot,ElProgress:et.a},computed:{fileName:function(){return this.payload.fileName},fileUrl:function(){return this.payload.fileUrl},size:function(){var e=this.payload.fileSize;return e>1024?e/1024>1024?"".concat(this.toFixed(e/1024/1024)," Mb"):"".concat(this.toFixed(e/1024)," Kb"):"".concat(this.toFixed(e),"B")},showProgressBar:function(){return"unSend"===this.$parent.message.status},percentage:function(){return Math.floor(100*(this.$parent.message.progress||0))}},methods:{toFixed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return e.toFixed(t)},downloadFile:function(){var e=this;if(window.fetch)fetch(this.fileUrl).then((function(e){return e.blob()})).then((function(t){var n=document.createElement("a"),r=window.URL.createObjectURL(t);n.href=r,n.download=e.fileName,n.click()}));else{var t=document.createElement("a");t.href=this.fileUrl,t.target="_blank",t.download=this.filename,t.click()}}}},ct=it,ut=(n("4d06"),Object(z["a"])(ct,Qe,Xe,!1,null,"96091f5a",null)),lt=ut.exports,ft=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[n("div",{staticClass:"face-element-wrapper"},[n("img",{attrs:{src:e.url}})])])},dt=[],pt={name:"FaceElement",props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},components:{MessageBubble:ot},computed:{url:function(){var e="";return e=this.payload.data.indexOf("@2x")>0?this.payload.data:this.payload.data+"@2x","https://imgcache.qq.com/open/qcloud/tim/assets/face-elem/".concat(e,".png")}}},mt=pt,gt=(n("ce0c"),Object(z["a"])(mt,ft,dt,!1,null,"0ef044da",null)),ht=gt.exports,vt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[n("img",{staticClass:"image-element",attrs:{src:e.imageUrl},on:{load:e.onImageLoaded,click:e.handlePreview}}),e.showProgressBar?n("el-progress",{attrs:{percentage:e.percentage,color:function(e){return 100===e?"#67c23a":"#409eff"}}}):e._e()],1)},bt=[];function yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ot(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yt(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ct={name:"ImageElemnt",props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},components:{MessageBubble:ot,ElProgress:et.a},computed:Ot(Ot({},Object(ne["b"])(["imgUrlList"])),{},{imageUrl:function(){var e=this.payload.imageInfoArray[0].url||this.payload.imageInfoArray[0].URL;return"string"!==typeof e?"":"//"===e.slice(0,2)?"https:".concat(e):e},showProgressBar:function(){return"unSend"===this.$parent.message.status},percentage:function(){return Math.floor(100*(this.$parent.message.progress||0))}}),methods:{onImageLoaded:function(e){console.log("onImageLoaded",e),this.$bus.$emit("image-loaded",e)},handlePreview:function(){this.$bus.$emit("image-preview",{url:this.payload.imageInfoArray[0].url||this.payload.imageInfoArray[0].URL,urlList:this.imgUrlList})}}},_t=Ct,It=(n("ce90"),Object(z["a"])(_t,vt,bt,!1,null,"393220d3",null)),Mt=It.exports,wt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[e._l(e.contentList,(function(t,r){return["text"===t.name?n("span",{key:r},[e._v(e._s(t.text))]):"img"===t.name?n("img",{key:r,attrs:{src:t.src,width:"20px",height:"20px"}}):e._e()]}))],2)},Et=[];function Tt(e){var t=[],n=e.text,r=-1,s=-1;while(""!==n)switch(r=n.indexOf("["),s=n.indexOf("]"),r){case 0:if(-1===s)t.push({name:"text",text:n}),n="";else{var a=n.slice(0,s+1);me[a]?(t.push({name:"img",src:pe+me[a]}),n=n.substring(s+1)):(t.push({name:"text",text:"["}),n=n.slice(1))}break;case-1:t.push({name:"text",text:n}),n="";break;default:t.push({name:"text",text:n.slice(0,r)}),n=n.substring(r);break}return t}var Pt={name:"TextElement",components:{MessageBubble:ot},props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},computed:{contentList:function(){return Tt(this.payload)}}},Dt=Pt,St=(n("e6da"),Object(z["a"])(Dt,wt,Et,!1,null,"748a76fd",null)),kt=St.exports,jt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[n("div",{staticClass:"sound-element-wrapper",attrs:{title:"单击播放"},on:{click:e.play}},[n("i",{staticClass:"iconfont icon-voice"}),e._v("\n    "+e._s(e.second+'"')+"\n  ")])])},Lt=[],At={name:"SoundElement",props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},components:{MessageBubble:ot},data:function(){return{amr:null}},computed:{url:function(){return this.payload.url},size:function(){return this.payload.size},second:function(){return this.payload.second}},methods:{play:function(){var e=document.createElement("audio");e.addEventListener("error",this.tryPlayAMR),e.src=this.url;var t=e.play();t&&t.catch((function(){}))},tryPlayAMR:function(){try{var e=/MSIE|Trident|Edge/.test(window.navigator.userAgent);if(e)return void this.$store.commit("showMessage",{message:"您的浏览器不支持该格式的语音消息播放，请尝试更换浏览器，建议使用：谷歌浏览器",type:"warning"});if(!window.BenzAMRRecorder){var t=document.createElement("script");t.addEventListener("load",this.playAMR),t.src="./BenzAMRRecorder.js";var n=document.getElementsByTagName("script")[0];return void n.parentNode.insertBefore(t,n)}this.playAMR()}catch(r){this.$store.commit("showMessage",{message:"您的浏览器不支持该格式的语音消息播放，请尝试更换浏览器，建议使用：谷歌浏览器",type:"warning"})}},playAMR:function(){var e=this;!this.amr&&window.BenzAMRRecorder&&(this.amr=new window.BenzAMRRecorder),this.amr.isInit()?this.amr.play():this.amr.initWithUrl(this.url).then((function(){e.amr.play()}))}}},xt=At,Ut=(n("777c"),Object(z["a"])(xt,jt,Lt,!1,null,"7ab0530b",null)),Nt=Ut.exports,Rt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[n("video",{staticClass:"video",attrs:{src:e.payload.videoUrl,controls:""},on:{error:e.videoError}}),e.showProgressBar?n("el-progress",{attrs:{percentage:e.percentage,color:function(e){return 100===e?"#67c23a":"#409eff"}}}):e._e()],1)},Gt=[],$t={name:"VideoElement",components:{MessageBubble:ot,ElProgress:et.a},props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},computed:{showProgressBar:function(){return"unSend"===this.message.status},percentage:function(){return Math.floor(100*(this.$parent.message.progress||0))}},methods:{videoError:function(e){this.$store.commit("showMessage",{type:"error",message:"视频出错，错误原因："+e.target.error.message})}}},Yt=$t,Ft=(n("e3ec"),Object(z["a"])(Yt,Rt,Gt,!1,null,"6237ab78",null)),Bt=Ft.exports,qt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"group-tip-element-wrapper"},[e._v(e._s(e.text))])},Ht=[];n("ac4d"),n("8a81"),n("5df3"),n("1c4c"),n("6b54");function Vt(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Kt(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw a}}}}function Kt(e,t){if(e){if("string"===typeof e)return zt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zt(e,t):void 0}}function zt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Wt={name:"GroupTipElement",props:{payload:{type:Object,required:!0},message:{type:Object,required:!1}},computed:{text:function(){return this.getGroupTipContent(this.message)}},methods:{getGroupTipContent:function(e){var t=e.nick||e.payload.userIDList.join(",");switch(e.payload.operationType){case this.TIM.TYPES.GRP_TIP_MBR_JOIN:return"群成员：".concat(t," 加入群组");case this.TIM.TYPES.GRP_TIP_MBR_QUIT:return"群成员：".concat(t," 退出群组");case this.TIM.TYPES.GRP_TIP_MBR_KICKED_OUT:return"群成员：".concat(t," 被").concat(e.payload.operatorID,"踢出群组");case this.TIM.TYPES.GRP_TIP_MBR_SET_ADMIN:return"群成员：".concat(t," 成为管理员");case this.TIM.TYPES.GRP_TIP_MBR_CANCELED_ADMIN:return"群成员：".concat(t," 被撤销管理员");case this.TIM.TYPES.GRP_TIP_GRP_PROFILE_UPDATED:return"群资料修改";case this.TIM.TYPES.GRP_TIP_MBR_PROFILE_UPDATED:var n,r=Vt(e.payload.memberList);try{for(r.s();!(n=r.n()).done;){var s=n.value;return s.muteTime>0?"群成员：".concat(s.userID,"被禁言").concat(s.muteTime,"秒"):"群成员：".concat(s.userID,"被取消禁言")}}catch(a){r.e(a)}finally{r.f()}break;default:return"[群提示消息]"}}}},Jt=Wt,Qt=(n("9668"),Object(z["a"])(Jt,qt,Ht,!1,null,"746f4cdc",null)),Xt=Qt.exports,Zt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("message-bubble",{attrs:{isMine:!1,message:e.message}},[n("div",{staticClass:"group-system-element-wrapper"},[e._v("\n    "+e._s(e.text)+"\n    "),e.isJoinGroupRequest?n("el-button",{attrs:{type:"text"},on:{click:function(t){e.showDialog=!0}}},[e._v("处理")]):e._e(),n("el-dialog",{attrs:{title:"处理加群申请",visible:e.showDialog,width:"30%"},on:{"update:visible":function(t){e.showDialog=t}}},[n("el-form",{ref:"form",attrs:{"label-width":"100px"},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}},[n("el-form-item",{attrs:{label:"处理结果："}},[n("el-radio-group",{model:{value:e.form.handleAction,callback:function(t){e.$set(e.form,"handleAction",t)},expression:"form.handleAction"}},[n("el-radio",{attrs:{label:"Agree"}},[e._v("同意")]),n("el-radio",{attrs:{label:"Reject"}},[e._v("拒绝")])],1)],1),n("el-form-item",{attrs:{label:"附言："}},[n("el-input",{attrs:{type:"textarea",resize:"none",rows:3,placeholder:"请输入附言"},model:{value:e.form.handleMessage,callback:function(t){e.$set(e.form,"handleMessage",t)},expression:"form.handleMessage"}})],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showDialog=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e.handleGroupApplication}},[e._v("确 定")])],1)],1)],1)])},en=[],tn=(n("eca7"),n("3787")),nn=n.n(tn),rn=(n("425f"),n("4105")),sn=n.n(rn);function an(e){var t=e.payload.groupProfile.name||e.payload.groupProfile.groupID;switch(e.payload.operationType){case 1:return"".concat(e.payload.operatorID," 申请加入群组：").concat(t);case 2:return"成功加入群组：".concat(t);case 3:return"申请加入群组：".concat(t,"被拒绝");case 4:return"你被管理员".concat(e.payload.operatorID,"踢出群组：").concat(t);case 5:return"群：".concat(t," 已被").concat(e.payload.operatorID,"解散");case 6:return"".concat(e.payload.operatorID,"创建群：").concat(t);case 7:return"".concat(e.payload.operatorID,"邀请你加群：").concat(t);case 8:return"你退出群组：".concat(t);case 9:return"你被".concat(e.payload.operatorID,"设置为群：").concat(t,"的管理员");case 10:return"你被".concat(e.payload.operatorID,"撤销群：").concat(t,"的管理员身份");case 255:return"自定义群系统通知: "+e.payload.userDefinedField}}var on={name:"GroupSystemNoticeElement",props:{payload:{type:Object,required:!0},message:{type:Object,required:!1}},components:{ElDialog:l.a,ElForm:sn.a,ElFormItem:nn.a,ElRadioGroup:le.a,ElRadio:b.a,MessageBubble:ot},data:function(){return{showDialog:!1,form:{handleAction:"Agree",handleMessage:""}}},computed:{text:function(){return an(this.message)},title:function(){return this.message.type===this.TIM.TYPES.MSG_GRP_SYS_NOTICE?"群系统通知":"系统通知"},isJoinGroupRequest:function(){return 1===this.payload.operationType}},methods:{handleGroupApplication:function(){var e=this;this.tim.handleGroupApplication({handleAction:this.form.handleAction,handleMessage:this.form.handleMessage,message:this.message}).then((function(){e.showDialog=!1,e.$store.commit("removeMessage",e.message)})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message}),e.showDialog=!1}))}}},cn=on,un=(n("4011"),Object(z["a"])(cn,Zt,en,!1,null,"8a49ee1a",null)),ln=un.exports,fn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[n("div",{staticClass:"custom-element-wrapper"},["survey"===this.payload.data?n("div",{staticClass:"survey"},[n("div",{staticClass:"title"},[e._v("对IM DEMO的评分和建议")]),n("el-rate",{attrs:{disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value}"},model:{value:e.rate,callback:function(t){e.rate=t},expression:"rate"}}),n("div",{staticClass:"suggestion"},[e._v(e._s(this.payload.extension))])],1):n("span",{staticClass:"text",attrs:{title:"您可以自行解析自定义消息"}},[e._v(e._s(e.text))])])])},dn=[],pn=(n("78a7"),n("33ca")),mn=n.n(pn),gn={VIDEO_CALL_ACTION_ERROR:-2,VIDEO_CALL_ACTION_UNKNOWN:-1,VIDEO_CALL_ACTION_DIALING:0,VIDEO_CALL_ACTION_SPONSOR_CANCEL:1,VIDEO_CALL_ACTION_REJECT:2,VIDEO_CALL_ACTION_SPONSOR_TIMEOUT:3,VIDEO_CALL_ACTION_ACCEPTED:4,VIDEO_CALL_ACTION_HANGUP:5,VIDEO_CALL_ACTION_LINE_BUSY:6};function hn(e){return e<10?"0".concat(e):e}function vn(e){if(e<60)return"00:00:".concat(hn(e));if(e<3600){var t=parseInt(e/60),n=e-60*t;return"00:".concat(hn(t),":").concat(hn(n))}var r=parseInt(e/3600),s=e-3600*r,a=parseInt(s/60),o=s-60*a;return"".concat(hn(r),":").concat(hn(a),":").concat(hn(o))}var bn={name:"CustomElement",props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},components:{MessageBubble:ot,ElRate:mn.a},computed:{text:function(){return this.translateCustomMessage(this.payload)},rate:function(){return parseInt(this.payload.description)}},methods:{translateCustomMessage:function(e){var t={};try{t=JSON.parse(e.data)}catch(n){t={}}if("group_create"===e.data)return"".concat(e.extension);switch(t.action){case gn.VIDEO_CALL_ACTION_DIALING:return"[请求通话]";case gn.VIDEO_CALL_ACTION_SPONSOR_CANCEL:return"[取消通话]";case gn.VIDEO_CALL_ACTION_REJECT:return"[拒绝通话]";case gn.VIDEO_CALL_ACTION_SPONSOR_TIMEOUT:return"[无应答]";case gn.VIDEO_CALL_ACTION_ACCEPTED:return"[开始通话]";case gn.VIDEO_CALL_ACTION_HANGUP:return"[结束通话，通话时长：".concat(vn(t.duration),"]");case gn.VIDEO_CALL_ACTION_LINE_BUSY:return"[正在通话中]";case gn.VIDEO_CALL_ACTION_ERROR:return"[设备异常]";default:return"[自定义消息]"}}}},yn=bn,On=(n("014d"),Object(z["a"])(yn,fn,dn,!1,null,"5b9b8f35",null)),Cn=On.exports,_n=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[n("a",{staticClass:"geo-element",attrs:{href:e.href,target:"_blank",title:"点击查看详情"}},[n("span",{staticClass:"el-icon-location-outline"},[e._v(e._s(e.payload.description))]),n("img",{attrs:{src:e.url}})])])},In=[],Mn={name:"GeoElement",components:{MessageBubble:ot},props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},data:function(){return{url:""}},computed:{lon:function(){return this.payload.longitude.toFixed(6)},lat:function(){return this.payload.latitude.toFixed(6)},href:function(){return"https://map.qq.com/?type=marker&isopeninfowin=1&markertype=1&pointx=".concat(this.lon,"&pointy=").concat(this.lat,"&name=").concat(this.payload.description)}},mounted:function(){this.url="https://apis.map.qq.com/ws/staticmap/v2/?center=".concat(this.lat,",").concat(this.lon,"&zoom=10&size=300*150&maptype=roadmap&markers=size:large|color:0xFFCCFF|label:k|").concat(this.lat,",").concat(this.lon,"&key=UBNBZ-PTP3P-TE7DB-LHRTI-Y4YLE-VWBBD")}},wn=Mn,En=(n("daca"),Object(z["a"])(wn,_n,In,!1,null,"58085edc",null)),Tn=En.exports;function Pn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Dn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pn(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Sn={name:"MessageItem",props:{message:{type:Object,required:!0}},components:{MessageHeader:Fe,MessageFooter:Je,MessageStatusIcon:De,FileElement:lt,FaceElement:ht,ImageElement:Mt,TextElement:kt,SoundElement:Nt,GroupTipElement:Xt,GroupSystemNoticeElement:ln,CustomElement:Cn,VideoElement:Bt,GeoElement:Tn},data:function(){return{renderDom:[]}},computed:Dn(Dn({},Object(ne["c"])({currentConversation:function(e){return e.conversation.currentConversation},currentUserProfile:function(e){return e.user.currentUserProfile}})),{},{showAvatar:function(){return"C2C"===this.currentConversation.type&&!this.message.isRevoked||"GROUP"===this.currentConversation.type&&!this.message.isRevoked&&this.message.type!==this.TIM.TYPES.MSG_GRP_TIP},avatar:function(){return"C2C"===this.currentConversation.type?this.isMine?this.currentUserProfile.avatar:this.currentConversation.userProfile.avatar:"GROUP"===this.currentConversation.type?this.isMine?this.currentUserProfile.avatar:this.message.avatar:""},currentConversationType:function(){return this.currentConversation.type},isMine:function(){return"out"===this.message.flow},messagePosition:function(){return["TIMGroupTipElem","TIMGroupSystemNoticeElem"].includes(this.message.type)||this.message.isRevoked?"position-center":this.isMine?"position-right":"position-left"},showMessageHeader:function(){return!["TIMGroupTipElem","TIMGroupSystemNoticeElem"].includes(this.message.type)&&!this.message.isRevoked}}),methods:{showGroupMemberProfile:function(e){var t=this;this.tim.getGroupMemberProfile({groupID:this.message.to,userIDList:[this.message.from]}).then((function(n){var r=n.data.memberList;r[0]&&t.$bus.$emit("showMemberProfile",{event:e,member:r[0]})}))}}},kn=Sn,jn=(n("81b7"),Object(z["a"])(kn,_e,Ie,!1,null,"3bf79e4a",null)),Ln=jn.exports;function An(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?An(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):An(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Un={name:"CurrentConversation",components:{MessageSendBox:Ce,MessageItem:Ln},data:function(){return{isShowScrollButtomTips:!1,preScrollHeight:0,showConversationProfile:!1,timeout:""}},computed:xn(xn(xn({},Object(ne["c"])({currentConversation:function(e){return e.conversation.currentConversation},currentUnreadCount:function(e){return e.conversation.currentConversation.unreadCount},currentMessageList:function(e){return e.conversation.currentMessageList},isCompleted:function(e){return e.conversation.isCompleted},currentConversationTitle:function(e){return e.conversation.currentConversationTitle}})),Object(ne["b"])(["toAccount","hidden"])),{},{showCurrentConversation:function(){return!!this.currentConversation.conversationID},name:function(){return this.currentConversation.userProfile.nick},showMessageSendBox:function(){return this.currentConversation.type!==this.TIM.TYPES.CONV_SYSTEM}}),mounted:function(){if(this.$bus.$on("image-loaded",this.onImageLoaded),this.$bus.$on("scroll-bottom",this.scrollMessageListToButtom),"@TIM#SYSTEM"===this.currentConversation.conversationID)return!1},updated:function(){this.keepMessageListOnButtom(),"@TIM#SYSTEM"!==this.currentConversation.conversationID&&"undefined"!==typeof this.currentConversation.conversationID||(this.showConversationProfile=!1)},watch:{currentUnreadCount:function(e){!this.hidden&&e>0&&this.$store.commit("resetCurrentConversationUnread")},hidden:function(e){!e&&this.currentUnreadCount>0&&this.$store.commit("resetCurrentConversationUnread")}},methods:{onScroll:function(e){var t=e.target.scrollTop,n=this.$refs["message-list"];n&&this.preScrollHeight-n.clientHeight-t<20&&(this.isShowScrollButtomTips=!1)},keepMessageListOnButtom:function(){var e=this.$refs["message-list"];e&&(this.preScrollHeight-e.clientHeight-e.scrollTop<20?(this.$nextTick((function(){e.scrollTop=e.scrollHeight})),this.isShowScrollButtomTips=!1):this.isShowScrollButtomTips=!0,this.preScrollHeight=e.scrollHeight)},scrollMessageListToButtom:function(){var e=this;this.$nextTick((function(){var t=e.$refs["message-list"];t&&(t.scrollTop=t.scrollHeight,e.preScrollHeight=t.scrollHeight,e.isShowScrollButtomTips=!1)}))},showMore:function(){this.showConversationProfile=!this.showConversationProfile},onImageLoaded:function(){this.keepMessageListOnButtom()}}},Nn=Un,Rn=(n("0b14"),Object(z["a"])(Nn,re,se,!1,null,"afab1262",null)),Gn=Rn.exports,$n=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"side-bar-wrapper"},[e._e(),n("div",{staticClass:"bar-right"},[n("conversation-list",{directives:[{name:"show",rawName:"v-show",value:e.showConversationList,expression:"showConversationList"}]}),n("group-list",{directives:[{name:"show",rawName:"v-show",value:e.showGroupList,expression:"showGroupList"}]}),n("friend-list",{directives:[{name:"show",rawName:"v-show",value:e.showFriendList,expression:"showFriendList"}]}),n("black-list",{directives:[{name:"show",rawName:"v-show",value:e.showBlackList,expression:"showBlackList"}]})],1)])},Yn=[],Fn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"my-profile-wrapper"},[n("el-dialog",{attrs:{title:"编辑个人资料",visible:e.showEditMyProfile,width:"30%"},on:{"update:visible":function(t){e.showEditMyProfile=t}}},[n("el-form",{attrs:{"label-width":"100px"},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}},[n("el-form-item",{attrs:{label:"头像"}},[n("el-input",{attrs:{placeholder:"头像地址(URL)"},model:{value:e.form.avatar,callback:function(t){e.$set(e.form,"avatar",t)},expression:"form.avatar"}})],1),n("el-form-item",{attrs:{label:"昵称"}},[n("el-input",{attrs:{placeholder:"昵称"},model:{value:e.form.nick,callback:function(t){e.$set(e.form,"nick",t)},expression:"form.nick"}})],1),n("el-form-item",{attrs:{label:"性别"}},[n("el-radio-group",{model:{value:e.form.gender,callback:function(t){e.$set(e.form,"gender",t)},expression:"form.gender"}},[n("el-radio",{attrs:{label:e.TIM.TYPES.GENDER_MALE}},[e._v("男")]),n("el-radio",{attrs:{label:e.TIM.TYPES.GENDER_FEMALE}},[e._v("女")]),n("el-radio",{attrs:{label:e.TIM.TYPES.GENDER_UNKNOWN}},[e._v("不显示")])],1)],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showEditMyProfile=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e.editMyProfile}},[e._v("确 定")])],1)],1),n("el-popover",{staticClass:"popover",attrs:{width:200,trigger:"click",placement:"right"}},[n("profile-card",{attrs:{profile:e.currentUserProfile}}),n("i",{staticClass:"el-icon-setting edit-my-profile",on:{click:e.handleEdit}}),n("avatar",{staticClass:"my-avatar",attrs:{slot:"reference",src:e.currentUserProfile.avatar},slot:"reference"})],1)],1)},Bn=[],qn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"profile-card-wrapper"},[n("div",{staticClass:"content"},[n("avatar",{attrs:{src:e.profile.avatar}}),n("div",{staticClass:"basic"},[n("span",{staticClass:"nick text-ellipsis"},[e._v(e._s(e.profile.nick||e.profile.userID))]),n("span",{staticClass:"iconfont",class:e.genderClass})])],1)])},Hn=[],Vn={name:"ProfileCard",props:{profile:{type:Object,required:!0}},computed:{genderClass:function(){switch(this.profile.gender){case this.TIM.TYPES.GENDER_MALE:return"icon-male";case this.TIM.TYPES.GENDER_FEMALE:return"icon-female";default:return"暂无"}}}},Kn=Vn,zn=(n("8127"),Object(z["a"])(Kn,qn,Hn,!1,null,null,null)),Wn=zn.exports;function Jn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jn(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Xn={name:"MyProfile",components:{ElPopover:de.a,ProfileCard:Wn,ElForm:sn.a,ElFormItem:nn.a,ElRadioGroup:le.a,ElRadio:b.a},data:function(){return{showEditMyProfile:!1,form:{avatar:"",nick:"",gender:""}}},computed:Qn(Qn({},Object(ne["c"])({currentUserProfile:function(e){return e.user.currentUserProfile},currentConversation:function(e){return e.conversation.currentConversation}})),{},{gender:function(){switch(this.currentUserProfile.gender){case this.TIM.TYPES.GENDER_MALE:return"男";case this.TIM.TYPES.GENDER_FEMALE:return"女";default:return"暂无"}}}),methods:{editMyProfile:function(){var e=this;if(this.form.avatar&&-1===this.form.avatar.indexOf("http"))return this.$store.commit("showMessage",{message:"头像应该是 Url 地址",type:"warning"}),void(this.form.avatar="");var t={};Object.keys(this.form).forEach((function(n){e.form[n]&&(t[n]=e.form[n])})),this.tim.updateMyProfile(t).then((function(){e.$store.commit("showMessage",{message:"修改成功"}),e.showEditMyProfile=!1})).catch((function(t){e.$store.commit("showMessage",{message:t.message,type:"error"})}))},handleEdit:function(){var e=this.currentUserProfile,t=e.avatar,n=e.nick,r=e.gender;Object.assign(this.form,{avatar:t,nick:n,gender:r}),this.showEditMyProfile=!0}}},Zn=Xn,er=(n("9462"),Object(z["a"])(Zn,Fn,Bn,!1,null,"1e0cccf6",null)),tr=er.exports,nr=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"list-container"},[n("div",{staticClass:"header-bar"},[n("el-input",{attrs:{size:"mini",placeholder:"输入UID查找"},on:{change:e.handleAddButtonClick},model:{value:e.searchToUid,callback:function(t){e.searchToUid=t},expression:"searchToUid"}},[n("el-button",{attrs:{slot:"append",title:"添加会话",size:"mini"},on:{click:e.handleAddButtonClick},slot:"append"},[n("i",{staticClass:"el-icon-search"})])],1)],1),n("div",{staticClass:"scroll-container"},e._l(e.conversationList,(function(e){return n("conversation-item",{key:e.conversationID,attrs:{conversation:e}})})),1),n("div",{staticClass:"more"},[n("el-button",{attrs:{type:"text"},on:{click:function(t){return e.$store.commit("addMoreConversationList")}}},[e._v("查看更多")])],1)])},rr=[],sr=n("75fc"),ar=(n("55dd"),n("8615"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"conversation-item-container",class:{choose:e.conversation.conversationID===e.currentConversation.conversationID},on:{click:e.selectConversation}},[n("div",{staticClass:"warp"},[n("avatar",{attrs:{src:e.avatar,type:e.conversation.type}}),n("div",{staticClass:"content"},[n("div",{staticClass:"row-1"},[n("div",{staticClass:"name"},[n("div",{staticClass:"text-ellipsis"},[e.conversation.type===e.TIM.TYPES.CONV_C2C?n("span",{attrs:{title:e.conversation.userProfile.nick||e.conversation.userProfile.userID}},[e._v(e._s(e.conversation.userProfile.nick||e.conversation.userProfile.userID)+"\n            ")]):e._e()])]),n("div",{staticClass:"unread-count"},[e.showUnreadCount?n("span",{staticClass:"badge"},[e._v("\n            "+e._s(e.conversation.unreadCount>99?"99+":e.conversation.unreadCount)+"\n          ")]):e._e()])]),n("div",{staticClass:"row-2"},[n("div",{staticClass:"summary"},[e.conversation.lastMessage?n("div",{staticClass:"text-ellipsis"},[n("span",{staticClass:"text",attrs:{title:e.conversation.lastMessage.messageForShow}},[e._v("\n              "+e._s(e.messageForShow)+"\n            ")])]):e._e()]),n("div",{staticClass:"date"},[e._v("\n          "+e._s(e.date)+"\n        ")])])]),n("div",{on:{click:function(t){return e.forkConversation(t)}}},[e.conversation.isFork?n("i",{class:{"el-icon-star-on":e.conversation.isFork,fork:!0}}):n("span",{staticClass:"fork-text"},[e._v("收藏")])])],1)])}),or=[];function ir(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function cr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ir(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ir(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ur={name:"conversation-item",props:["conversation"],data:function(){return{popoverVisible:!1,hasMessageAtMe:!1}},computed:cr(cr({showUnreadCount:function(){return(this.$store.getters.hidden||this.currentConversation.conversationID!==this.conversation.conversationID)&&this.conversation.unreadCount>0},date:function(){if(!this.conversation.lastMessage||!this.conversation.lastMessage.lastTime)return"";var e=new Date(1e3*this.conversation.lastMessage.lastTime);return xe(e)?Le(e):je(e)},avatar:function(){return this.conversation.userProfile&&this.conversation.userProfile.avatar?this.conversation.userProfile.avatar:""},conversationName:function(){return this.conversation.userProfile.nick||this.conversation.userProfile.nick},messageForShow:function(){return this.conversation.lastMessage.isRevoked?this.conversation.lastMessage.fromAccount===this.currentUserProfile.userID?"你撤回了一条消息":this.conversation.type===this.TIM.TYPES.CONV_C2C?"对方撤回了一条消息":"".concat(this.conversation.lastMessage.fromAccount,"撤回了一条消息"):this.conversation.lastMessage.messageForShow}},Object(ne["c"])({currentConversation:function(e){return e.conversation.currentConversation},currentUserProfile:function(e){return e.user.currentUserProfile}})),Object(ne["b"])(["toAccount"])),mounted:function(){var e=this;this.$bus.$on("new-messsage-at-me",(function(t){t.data.conversationID===e.conversation.conversationID&&e.conversation.conversationID!==e.currentConversation.conversationID&&(e.hasMessageAtMe=!0)}))},methods:{forkConversation:function(e){e.stopPropagation(),console.log("forkConversation"),this.$store.dispatch("forkConversation",{conversationID:this.conversation.conversationID,isFork:this.conversation.isFork})},selectConversation:function(){this.conversation.conversationID!==this.currentConversation.conversationID&&this.$store.dispatch("checkoutConversation",this.conversation.conversationID)},deleteConversation:function(e){var t=this;e.stopPropagation(),this.tim.deleteConversation(this.conversation.conversationID).then((function(){t.$store.commit("showMessage",{message:"会话【".concat(t.conversationName,"】删除成功!"),type:"success"}),t.popoverVisible=!1,t.$store.commit("resetCurrentConversation")})).catch((function(e){t.$store.commit("showMessage",{message:"会话【".concat(t.conversationName,"】删除失败!, error=").concat(e.message),type:"error"}),t.popoverVisible=!1}))},showContextMenu:function(){this.popoverVisible=!0}},watch:{}},lr=ur,fr=(n("224b"),Object(z["a"])(lr,ar,or,!1,null,"ec24d39c",null)),dr=fr.exports;function pr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function mr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pr(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var gr={name:"ConversationList",components:{ConversationItem:dr},data:function(){return{showDialog:!1,searchToUid:"",isCheckouting:!1,timeout:null}},computed:mr({},Object(ne["c"])({conversationList:function(e){console.log("conversationList render",e.conversation.forkList);var t=[],n=[];return Object.values(e.conversation.conversationObject).forEach((function(r,s){-1!==e.conversation.forkList.indexOf(r.conversationID)?(r.isFork=!0,t.push(r)):(r.isFork=!1,n.push(r))})),console.log("sort",n.sort((function(e,t){if(e.unreadCount)return-e.unreadCount;t.lastMessage.lastTime,e.lastMessage.lastTime}))),[].concat(t,Object(sr["a"])(n.sort((function(e,t){if(e.unreadCount)return!0;t.lastMessage.lastTime,e.lastMessage.lastTime}))))},currentConversation:function(e){return e.conversation.currentConversation}})),mounted:function(){window.addEventListener("keydown",this.handleKeydown)},destroyed:function(){window.removeEventListener("keydown",this.handleKeydown)},methods:{handleRefresh:function(){this.refreshConversation()()},refreshConversation:function(){var e=this;return function(){e.timeout||(e.timeout=setTimeout((function(){e.timeout=null,e.tim.getConversationList().then((function(){e.$store.commit("showMessage",{message:"刷新成功",type:"success"})}))}),1e3))}},handleAddButtonClick:function(){var e=this;console.log("adsd",this.searchToUid),this.$store.dispatch("searchConversation",this.searchToUid).then((function(){e.searchToUid=""}))},handleKeydown:function(e){var t=this;if(!(38!==e.keyCode&&40!==e.keyCode||this.isCheckouting)){var n=this.conversationList.findIndex((function(e){return e.conversationID===t.currentConversation.conversationID}));38===e.keyCode&&n-1>=0&&this.checkoutPrev(n),40===e.keyCode&&n+1<this.conversationList.length&&this.checkoutNext(n)}},checkoutPrev:function(e){var t=this;this.isCheckouting=!0,this.$store.dispatch("checkoutConversation",this.conversationList[e-1].conversationID).then((function(){t.isCheckouting=!1})).catch((function(){t.isCheckouting=!1}))},checkoutNext:function(e){var t=this;this.isCheckouting=!0,this.$store.dispatch("checkoutConversation",this.conversationList[e+1].conversationID).then((function(){t.isCheckouting=!1})).catch((function(){t.isCheckouting=!1}))}}},hr=gr,vr=(n("480b"),Object(z["a"])(hr,nr,rr,!1,null,"a0a1f384",null)),br=vr.exports,yr=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"list-container"},[n("div",{staticClass:"header-bar"},[n("el-autocomplete",{staticClass:"group-seach-bar",attrs:{"value-key":"groupID",debounce:500,size:"mini",placeholder:"输入群ID搜索","fetch-suggestions":e.searchGroupByID,"prefix-icon":"el-icon-search","hide-loading":e.hideSearchLoading},on:{input:function(t){e.hideSearchLoading=!1},select:e.applyJoinGroup},model:{value:e.groupID,callback:function(t){e.groupID=t},expression:"groupID"}}),n("button",{attrs:{title:"创建群组"},on:{click:e.showCreateGroupModel}},[n("i",{staticClass:"tim-icon-add"})])],1),n("div",{staticClass:"group-container"},[e._l(e.groupList,(function(e){return n("group-item",{key:e.groupID,attrs:{group:e}})})),n("el-dialog",{attrs:{title:"创建群组",visible:e.createGroupModelVisible,width:"30%"},on:{close:e.closeCreateGroupModel}},[n("create-group")],1)],2)])},Or=[],Cr=(n("96cf"),n("3b8d")),_r=(n("3db2"),n("58b8")),Ir=n.n(_r),Mr=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-form",{ref:"createGroupForm",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"群ID"}},[n("el-input",{model:{value:e.form.groupID,callback:function(t){e.$set(e.form,"groupID",t)},expression:"form.groupID"}})],1),n("el-form-item",{attrs:{label:"群名称",prop:"name"}},[n("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),n("el-form-item",{attrs:{label:"群类型"}},[n("el-select",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[n("el-option",{attrs:{label:"Work",value:e.TIM.TYPES.GRP_WORK}}),n("el-option",{attrs:{label:"Public",value:e.TIM.TYPES.GRP_PUBLIC}}),n("el-option",{attrs:{label:"Meeting",value:e.TIM.TYPES.GRP_MEETING}}),n("el-option",{attrs:{label:"AVChatRoom",value:e.TIM.TYPES.GRP_AVCHATROOM}})],1)],1),n("el-form-item",{attrs:{label:"群头像地址"}},[n("el-input",{model:{value:e.form.avatar,callback:function(t){e.$set(e.form,"avatar",t)},expression:"form.avatar"}})],1),n("el-form-item",{attrs:{label:"群简介"}},[n("el-input",{attrs:{type:"textarea",maxlength:240},model:{value:e.form.introduction,callback:function(t){e.$set(e.form,"introduction",t)},expression:"form.introduction"}})],1),n("el-form-item",{attrs:{label:"群公告"}},[n("el-input",{attrs:{type:"textarea",maxlength:300},model:{value:e.form.notification,callback:function(t){e.$set(e.form,"notification",t)},expression:"form.notification"}})],1),n("el-form-item",{attrs:{label:"加群方式"}},[n("el-radio-group",{attrs:{disabled:e.joinOptionDisabled},model:{value:e.form.joinOption,callback:function(t){e.$set(e.form,"joinOption",t)},expression:"form.joinOption"}},[n("el-radio",{attrs:{label:"FreeAccess"}},[e._v("自由加群")]),n("el-radio",{attrs:{label:"NeedPermission"}},[e._v("需要验证")]),n("el-radio",{attrs:{label:"DisableApply"}},[e._v("禁止加群")])],1)],1),n("el-form-item",{attrs:{label:"群成员列表"}},[n("el-select",{attrs:{"default-first-option":"",multiple:"",filterable:"",remote:"",disabled:e.form.type===e.TIM.TYPES.GRP_AVCHATROOM,"remote-method":e.handleSearchUser,loading:e.loading,placeholder:"请输入群成员 userID"},model:{value:e.form.memberList,callback:function(t){e.$set(e.form,"memberList",t)},expression:"form.memberList"}},e._l(e.options,(function(e){return n("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("createGroupForm")}}},[e._v("立即创建")]),n("el-button",{on:{click:e.closeCreateGroupModel}},[e._v("取消")])],1)],1)},wr=[],Er=(n("6611"),n("e772")),Tr=n.n(Er),Pr=(n("1f1a"),n("4e4b")),Dr=n.n(Pr);function Sr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function kr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sr(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var jr={components:{ElForm:sn.a,ElFormItem:nn.a,ElInput:S.a,ElSelect:Dr.a,ElOption:Tr.a,ElRadioGroup:le.a,ElRadio:b.a},data:function(){return{form:{groupID:"",name:"",type:this.TIM.TYPES.GRP_WORK,avatar:"",introduction:"",notification:"",joinOption:"FreeAccess",memberList:[]},options:[],loading:!1,rules:{name:[{required:!0,message:"请输入群名称",trigger:"blur"}]}}},computed:{joinOptionDisabled:function(){return[this.TIM.TYPES.GRP_WORK,this.TIM.TYPES.GRP_MEETING,this.TIM.TYPES.GRP_AVCHATROOM].includes(this.form.type)}},methods:{onSubmit:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.createGroup()}))},closeCreateGroupModel:function(){this.$store.commit("updateCreateGroupModelVisible",!1)},createGroup:function(){var e=this;this.tim.createGroup(this.getOptions()).then((function(t){e.$store.commit("showMessage",{message:"群组：【".concat(t.data.group.name,"】创建成功"),type:"success"}),e.closeCreateGroupModel()})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))},getOptions:function(){var e=kr(kr({},this.form),{},{memberList:this.form.memberList.map((function(e){return{userID:e}}))});return[this.TIM.TYPES.GRP_WORK,this.TIM.TYPES.GRP_AVCHATROOM].includes(this.form.type)&&delete e.joinOption,e},handleSearchUser:function(e){var t=this;""!==e&&(this.loading=!0,this.tim.getUserProfile({userIDList:[e]}).then((function(e){var n=e.data;t.options=n.map((function(e){return e.userID})),t.loading=!1})).catch((function(e){t.$store.commit("showMessage",{type:"error",message:e.message})})))}}},Lr=jr,Ar=Object(z["a"])(Lr,Mr,wr,!1,null,"ee9f0666",null),xr=Ar.exports,Ur=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"scroll-container",on:{click:e.handleGroupClick}},[n("div",{staticClass:"group-item"},[n("avatar",{attrs:{src:e.group.avatar}}),n("div",{staticClass:"group-name text-ellipsis"},[e._v(e._s(e.group.name))])],1)])},Nr=[],Rr={props:["group"],data:function(){return{visible:!1,options:[{text:"退出群组",handler:this.quitGroup}]}},methods:{handleGroupClick:function(){var e="GROUP".concat(this.group.groupID);this.$store.dispatch("checkoutConversation",e)},quitGroup:function(){var e=this;this.tim.quitGroup(this.group.groupID).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))}}},Gr=Rr,$r=(n("2054"),Object(z["a"])(Gr,Ur,Nr,!1,null,"64a02b1a",null)),Yr=$r.exports;function Fr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Br(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fr(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var qr={data:function(){return{groupID:"",hideSearchLoading:!0}},components:{GroupItem:Yr,ElDialog:l.a,CreateGroup:xr,ElAutocomplete:Ir.a},computed:Br({groupList:function(){return this.$store.state.group.groupList}},Object(ne["c"])({createGroupModelVisible:function(e){return e.group.createGroupModelVisible}})),methods:{onGroupUpdated:function(e){this.$store.dispatch("updateGroupList",e)},createGroup:function(){},closeCreateGroupModel:function(){this.$store.commit("updateCreateGroupModelVisible",!1)},searchGroupByID:function(e,t){var n=this;e.trim().length>0?(this.hideSearchLoading=!1,this.tim.searchGroupByID(e).then((function(e){var n=e.data.group;t([n])})).catch((function(){n.$store.commit("showMessage",{message:"没有找到该群",type:"error"})}))):this.hideSearchLoading=!0},showCreateGroupModel:function(){this.$store.commit("updateCreateGroupModelVisible",!0)},applyJoinGroup:function(e){var t=this;this.tim.joinGroup({groupID:e.groupID}).then(function(){var e=Object(Cr["a"])(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:e.t0=n.data.status,e.next=e.t0===t.TIM.TYPES.JOIN_STATUS_WAIT_APPROVAL?3:e.t0===t.TIM.TYPES.JOIN_STATUS_SUCCESS?5:e.t0===t.TIM.TYPES.JOIN_STATUS_ALREADY_IN_GROUP?9:11;break;case 3:return t.$store.commit("showMessage",{message:"申请成功，等待群管理员确认。",type:"info"}),e.abrupt("break",12);case 5:return e.next=7,t.$store.dispatch("checkoutConversation","GROUP".concat(n.data.group.groupID));case 7:return t.$store.commit("showMessage",{message:"加群成功",type:"success"}),e.abrupt("break",12);case 9:return t.$store.commit("showMessage",{message:"您已经是群成员了，请勿重复加群哦！",type:"info"}),e.abrupt("break",12);case 11:return e.abrupt("break",12);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t.$store.commit("showMessage",{message:e.message,type:"error"})}))}}},Hr=qr,Vr=(n("6794"),Object(z["a"])(Hr,yr,Or,!1,null,"1b7e0ffd",null)),Kr=Vr.exports,zr=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"friend-list-container",class:{default:!e.hasFriend}},[e.hasFriend?n("div",e._l(e.friendList,(function(e){return n("friend-item",{key:e.userID,attrs:{friend:e}})})),1):n("div",{staticStyle:{color:"gray"}},[e._v("暂无好友")])])},Wr=[],Jr=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-row",{staticClass:"friend-item-container"},[n("el-col",{attrs:{span:6}},[n("avatar",{attrs:{src:e.friend.profile.avatar}})],1),n("el-col",{attrs:{span:18}},[n("div",{staticClass:"friend-name"},[e._v(e._s(e.friend.profile.nick||e.friend.userID))])])],1)],1)},Qr=[],Xr={props:{friend:{type:Object,required:!0}},methods:{handleFriendClick:function(){var e=this;this.tim.getConversationProfile("C2C".concat(this.friend.userID)).then((function(t){var n=t.data;e.$store.commit("updateCurrentConversation",n)})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))}}},Zr=Xr,es=Object(z["a"])(Zr,Jr,Qr,!1,null,"0e5cffba",null),ts=es.exports;function ns(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ns(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ns(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ss={components:{FriendItem:ts},computed:rs(rs({},Object(ne["c"])({friendList:function(e){return e.friend.friendList}})),{},{hasFriend:function(){return this.friendList.length>0}})},as=ss,os=(n("47b1"),Object(z["a"])(as,zr,Wr,!1,null,null,null)),is=os.exports,cs=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"blacklist-wrapper",class:{default:!e.hasBlacklist}},[e.hasBlacklist?n("div",e._l(e.blacklist,(function(e){return n("blacklist-item",{key:e.userID,attrs:{profile:e}})})),1):n("span",{staticStyle:{color:"gray"}},[e._v("黑名单还是空的")])])},us=[],ls=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"blacklist-item-wrapper"},[n("img",{staticClass:"avatar",attrs:{src:e.profile.avatar?e.profile.avatar:"http://imgcache.qq.com/open/qcloud/video/act/webim-avatar/avatar-2.png"}}),n("div",{staticClass:"item"},[e._v(e._s(e.profile.nick||e.profile.userID))]),n("el-button",{attrs:{type:"text"},on:{click:e.removeFromBlacklist}},[e._v("取消拉黑")])],1)},fs=[],ds={name:"BlacklistItem",props:{profile:{type:Object,required:!0}},methods:{removeFromBlacklist:function(){var e=this;this.tim.removeFromBlacklist({userIDList:[this.profile.userID]}).then((function(){e.$store.commit("removeFromBlacklist",e.profile.userID)})).catch((function(t){e.$store.commit("showMessage",{type:"error",message:t.message})}))}}},ps=ds,ms=(n("b849"),Object(z["a"])(ps,ls,fs,!1,null,"6763cfe2",null)),gs=ms.exports;function hs(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hs(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hs(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var bs={name:"Blacklist",components:{BlacklistItem:gs},computed:vs(vs({},Object(ne["c"])({blacklist:function(e){return e.blacklist.blacklist}})),{},{hasBlacklist:function(){return this.blacklist.length>0}})},ys=bs,Os=(n("86b5"),Object(z["a"])(ys,cs,us,!1,null,"00ad617d",null)),Cs=Os.exports;function _s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Is(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_s(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ms={CONVERSATION_LIST:"conversation-list",GROUP_LIST:"group-list",FRIEND_LIST:"friend-list",BLACK_LIST:"black-list"},ws={name:"SideBar",components:{MyProfile:tr,ConversationList:br,GroupList:Kr,FriendList:is,BlackList:Cs},data:function(){return{active:Ms.CONVERSATION_LIST,activeName:Ms}},computed:Is(Is({},Object(ne["b"])(["totalUnreadCount"])),{},{showConversationList:function(){return this.active===Ms.CONVERSATION_LIST},showGroupList:function(){return this.active===Ms.GROUP_LIST},showFriendList:function(){return this.active===Ms.FRIEND_LIST},showBlackList:function(){return this.active===Ms.BLACK_LIST},showAddButton:function(){return[Ms.CONVERSATION_LIST,Ms.GROUP_LIST].includes(this.active)}}),methods:{checkoutActive:function(e){this.active=e},handleClick:function(e){switch(e.target.id){case Ms.CONVERSATION_LIST:this.checkoutActive(Ms.CONVERSATION_LIST);break;case Ms.GROUP_LIST:this.checkoutActive(Ms.GROUP_LIST);break;case Ms.FRIEND_LIST:this.checkoutActive(Ms.FRIEND_LIST);break;case Ms.BLACK_LIST:this.checkoutActive(Ms.BLACK_LIST);break}}}},Es=ws,Ts=(n("25ca"),Object(z["a"])(Es,$n,Yn,!1,null,"7c6670e7",null)),Ps=Ts.exports,Ds=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"header-bar"},[n("div",{staticClass:"header-bar-left"},[n("my-profile"),n("div",{staticClass:"title"},[e._v("客服系统")])],1),n("div",[n("div",{staticClass:"total"},[e._v("\n      当前未读: "+e._s(e.totalUnreadCount.people)+"人"+e._s(e.totalUnreadCount.count)+"条消息 \n    ")]),n("div",{staticClass:"bottom"},[n("div",{staticClass:"iconfont icon-tuichu",attrs:{title:"退出"},on:{click:function(t){return e.$store.dispatch("logout")}}})]),n("i",{staticClass:"el-icon-full-screen full-screen",on:{click:e.fullScreenPage}})])])},Ss=[];function ks(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function js(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ks(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ks(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ls={name:"HeaderBar",computed:js(js({},Object(ne["c"])({unreadCount:function(e){return e.unreadCount},unreadNumber:function(e){return e.unreadNumber}})),Object(ne["b"])(["totalUnreadCount"])),components:{MyProfile:tr},data:function(){return{}},methods:{fullScreenPage:function(){var e=window.location.href;console.log("current href",e),window.open(e)}}},As=Ls,xs=(n("7f64"),Object(z["a"])(As,Ds,Ss,!1,null,"30e29e26",null)),Us=xs.exports,Ns=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"right-side"},[n("el-tabs",{on:{"tab-click":e.handleTabClick},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[n("el-tab-pane",{attrs:{label:"用户信息",name:"first"}},[null===e.userInfo?n("div",{staticClass:"empty"},[n("i",{staticClass:"el-icon-warning-outline",staticStyle:{"margin-right":"10px"}}),n("span",[e._v("用户资料加载失败")])]):e.currentToUID?n("div",[n("user-card",{attrs:{data:e.userInfo}})],1):n("div",{staticClass:"empty"},[n("i",{staticClass:"el-icon-warning-outline",staticStyle:{"margin-right":"10px"}}),n("span",[e._v("未选择用户")])])]),n("el-tab-pane",{staticStyle:{height:"100%"},attrs:{label:"活动报名",name:"second"}},[n("div",{staticStyle:{height:"90vh, overflow-y: scroll"}},[null===e.userPairs?n("div",{staticClass:"empty"},[n("i",{staticClass:"el-icon-warning-outline",staticStyle:{"margin-right":"10px"}}),n("span",[e._v("用户资料加载失败")])]):0===e.userPairs.length?n("div",{staticClass:"empty"},[n("i",{staticClass:"el-icon-warning-outline",staticStyle:{"margin-right":"10px"}}),n("span",[e._v("暂无报名记录")])]):n("el-collapse",{on:{change:e.handlePaneChange},model:{value:e.activePanes,callback:function(t){e.activePanes=t},expression:"activePanes"}},e._l(e.userPairs,(function(e){return n("el-collapse-item",{key:e.state_id,attrs:{title:"第"+e.stage_id+"期",name:e.state_id}},[n("div",[n("pairs-item",{attrs:{data:e}})],1)])})),1)],1)])],1)],1)},Rs=[],Gs=n("5a0c"),$s=n.n(Gs),Ys={1:"男",2:"女"},Fs={1:"男",2:"女"},Bs={0:"未支付",1:"成功",2:"退款"},qs={1:"年龄必须比我大",2:"年龄必须比我小",3:"身高必须比我高",4:"身高必须比我矮",5:"尽量和我同校",6:"尽量和我同城",7:"必须和我不同校",8:"接受同省调剂",9:"同乡"},Hs={sexMap:Ys,sxoMap:Fs,orderStateMap:Bs,fpdxLikeMap:qs,MATCH_STATUS_ALIAS:Vs,MATCH_STATUS:Ks,getMatchStatus:zs},Vs={MATCHING:"匹配中",FAILED:"匹配失败",SUCCESS:"匹配成功",UNHAPPY:"不满意",REFUNDED:"已退款",ATTENDNEXT:"报名下一期",FINISHED:"活动已完成",REPAIR_FAILED:"重匹失败",NO_CONFIRM:"未确认",FAILED_NO_FOLLOW:"未关注匹配失败",ATTENDNEXT_NO_FOLLOW:"未关注报名下一期",REFUNDED_NO_FOLLOW:"未关注已退款"},Ks={MATCHING:"MATCHING",FAILED:"FAILED",SUCCESS:"SUCCESS",UNHAPPY:"UNHAPPY",REFUNDED:"REFUNDED",ATTENDNEXT:"ATTENDNEXT",FINISHED:"FINISHED",REPAIR_FAILED:"REPAIR_FAILED",NO_CONFIRM:"NO_CONFIRM",FAILED_NO_FOLLOW:"FAILED_NO_FOLLOW",ATTENDNEXT_NO_FOLLOW:"ATTENDNEXT_NO_FOLLOW",REFUNDED_NO_FOLLOW:"REFUNDED_NO_FOLLOW"};function zs(e){var t=e.state,n=parseInt(t/100),r="";switch(n){case 0:r=Ks["MATCHING"];break;case 1:r=Ks["MATCHING"];break;case 2:r="";break;case 3:r=Ks["FAILED"];break;case 4:var s=parseInt((new Date).getTime()/1e3)>e.rematched_at;r=1==e.rematch&&!e.assoc_id&&s?Ks["REPAIR_FAILED"]:Ks["SUCCESS"];break;case 5:r=Ks["UNHAPPY"];break;case 6:r=Ks["REFUNDED"];break;case 7:r=Ks["ATTENDNEXT"];break;case 8:if(!e.assoc_id&&0==e.confirm&&e.stage_id>=53)r=Ks["NO_CONFIRM"];else if(!e.assoc_id&&1==e.rematch&&0!=e.confirm&&e.stage_id>=53)r=Ks["REPAIR_FAILED"];else{var a=parseInt((new Date).getTime()/1e3)>e.rematched_at;r=1!=e.rematch||a?Ks["FINISHED"]:Ks["SUCCESS"]}break;case 9:r=Ks["FAILED_NO_FOLLOW"];break;case 10:r=Ks["ATTENDNEXT_NO_FOLLOW"];break;case 11:r=Ks["REFUNDED_NO_FOLLOW"];break}return r}var Ws=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.data?n("div",[n("div",{staticClass:"item"},[n("div",{staticClass:"title"},[e._v("基本信息:")]),e.data?n("div",{staticClass:"info"},e._l(e.renderKeys,(function(t,r){return n("div",{key:r,staticClass:"info-item"},[n("div",[n("span",{staticStyle:{"margin-right":"10px"}},[e._v(e._s(t.label)+":")]),n("span",{staticStyle:{"margin-right":"5px"}},[e._v(e._s(t.transform?t.transform(e.data[r]):e.data[r]))])])])})),0):e._e()]),n("div",{staticClass:"item"},[n("div",{staticClass:"title"},[e._v("订单信息:")]),0===e.data.orders.length?n("div",{staticStyle:{color:"grey"}},[e._v("暂无")]):n("div",e._l(e.data.orders,(function(e,t){return n("user-order",{key:t})})),1)]),n("div",{staticClass:"item"},[n("div",{staticClass:"title"},[e._v("匹配对象信息:")]),0===e.data.other.length?n("div",{staticStyle:{color:"grey"}},[e._v("暂无")]):n("div",[n("user-card",{attrs:{data:e.data.other.user}}),n("pairs-item",{attrs:{data:e.data.other.pairs}})],1)])]):e._e()},Js=[],Qs=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.data?n("div",{staticClass:"info"},e._l(e.renderKeys,(function(t,r){return n("div",{key:r,staticClass:"info-item"},[n("div",[n("span",{staticStyle:{"margin-right":"10px"}},[e._v(e._s(t.label)+":")]),n("span",{staticStyle:{"margin-right":"5px"}},[e._v(e._s(t.transform?t.transform(e.data[r]):e.data[r]))])])])})),0):e._e()},Xs=[],Zs={props:{data:Object},data:function(){return{renderKeys:{create_at:{label:"创建时间",transform:function(e){return $s()(1e3*e).format("YYYY-MM-DD HH:mm:ss")}},flower:{label:"支付金额"},id:{label:"\b\b\bid"},order_state:{label:"订单状态",transform:function(e){return Hs.orderStateMap[e]}},cash_fee:{label:"实付",transform:function(e){return(e/100).toFixed(2)+"元"}},total_fee:{label:"应付",transform:function(e){return(e/100).toFixed(2)+"元"}},uid:{label:"uid"}}}}},ea=Zs,ta=(n("9564"),Object(z["a"])(ea,Qs,Xs,!1,null,"2bf209c2",null)),na=ta.exports,ra=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[0!==e.currentImgs.length?n("div",{staticClass:"images"},e._l(e.currentImgs,(function(t){return n("span",{key:t,on:{click:function(n){return e.handlePreview(t)}}},[n("el-image",{staticClass:"img-item",attrs:{src:t,fit:"cover"}})],1)})),0):n("div",{staticClass:"empty"},[n("i",{staticClass:"el-icon-warning-outline",staticStyle:{"margin-right":"10px"}}),n("span",[e._v("暂无图片")])]),n("div",{staticClass:"avatar"},[n("span",{staticStyle:{width:"50%"}},[n("el-avatar",{attrs:{size:"medium",src:e.data.avatar}})],1),n("a",{attrs:{href:"https://www.yuque.com/docs/share/7673f881-8736-404a-923a-71685254a7d0",target:"_blank"}},[e._v("匹配偏好对照表")])]),e.data?n("div",{staticClass:"info"},e._l(e.renderKeys,(function(t,r){return n("div",{key:r,staticClass:"item"},[n("div",[n("span",{staticStyle:{"margin-right":"10px"}},[e._v(e._s(t.label)+": ")]),n("span",{staticStyle:{"margin-right":"5px"}},[e._v(e._s(t.transform?t.transform(e.data[r]):e.data[r]))]),"age"===r?n("el-button",{attrs:{size:"mini",icon:"el-icon-edit",type:"primary"},on:{click:function(t){e.showAgeDialog=!0}}}):e._e(),"sex"===r?n("el-button",{attrs:{size:"mini",icon:"el-icon-edit",type:"primary"},on:{click:function(t){e.showSexDialog=!0}}}):e._e()],1)])})),0):e._e(),n("el-dialog",{attrs:{title:"修改生日",visible:e.showAgeDialog,width:"30%"},on:{"update:visible":function(t){e.showAgeDialog=t}}},[n("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:e.currentAge,callback:function(t){e.currentAge=t},expression:"currentAge"}}),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showAgeDialog=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handelUserInfoUpdate("age")}}},[e._v("确 定")])],1)],1),n("el-dialog",{attrs:{title:"修改性别",visible:e.showSexDialog,width:"30%"},on:{"update:visible":function(t){e.showSexDialog=t}}},[n("el-radio",{attrs:{label:1},model:{value:e.currentSex,callback:function(t){e.currentSex=t},expression:"currentSex"}},[e._v("男")]),n("el-radio",{attrs:{label:2},model:{value:e.currentSex,callback:function(t){e.currentSex=t},expression:"currentSex"}},[e._v("女")]),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showSexDialog=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handelUserInfoUpdate("sex")}}},[e._v("确 定")])],1)],1)],1)},sa=[],aa={props:{data:Object},data:function(){return{currentSex:1,currentAge:"",showAgeDialog:!1,showSexDialog:!1,renderKeys:{uid:{key:"uid",label:"uid"},nickname:{key:"nickname",label:"昵称"},school:{key:"school",label:"学校"},address:{key:"address",label:"常居地"},age:{key:"age",label:"生日",modify:!0},be_vip_at:{key:"be_vip_at",label:"普通会员开启时间",transform:function(e){return e?$s()(1e3*e).format("YYYY-MM-DD HH:mm:ss"):"不是会员"}},feed_sex:{key:"feed_sex",label:"信息流性别"},fpdx_like:{key:"fpdx_like",label:"匹配偏好"},height:{key:"height",label:"身高"},home:{key:"home",label:"故乡"},identity_auth:{key:"identity_auth",label:"认证照片",transform:function(e){return e||"无"}},login_at:{key:"login_at",label:"上次登录时间",transform:function(e){return $s()(1e3*e).format("YYYY-MM-DD HH:mm:ss")}},pair_max_age:{key:"pair_max_age",label:"匹配最大年龄"},pair_min_age:{key:"pair_max_age",label:"匹配最小年龄"},partner_id:{key:"partner_id",label:"卡片id"},phone:{key:"phone",label:"手机号"},qq:{key:"qq",label:"qq",transform:function(e){return e||"无"}},weixin:{key:"weixin",label:"微信",transform:function(e){return e||"无"}},sex:{key:"sex",label:"性别",modify:!0,transform:function(e){return Hs.sxoMap[e]}},sxo:{key:"sxo",label:"性取向",transform:function(e){return Hs.sxoMap[e]}},supvip_endat:{key:"supvip_endat",label:"svip到期时间",transform:function(e){return e?$s()(1e3*e).format("YYYY-MM-DD HH:mm:ss"):"不是svip"}},wx_auth:{key:"wx_auth",label:"是否微信认证",transform:function(e){return e?"是":"否"}},gold_flower:{key:"gold_flower",label:"金花"},red_flower:{key:"red_flower",label:"红花"},expect:{key:"expect",label:"自我描述"}}}},created:function(){this.currentSex=this.data.sex,this.currentAge=this.data.age},computed:{currentImgs:function(){var e=this,t=[],n=function(e){return""!==e&&null!==e&&void 0!==e};return[0,1,2,3,4,5].forEach((function(r){var s=0===r?"full_url_photo":"full_url_photo".concat(r);n(e.data[s])&&t.push(e.data[s])})),console.log("res imgs",t),t}},watch:{data:function(){this.currentSex=this.data.sex,this.currentAge=this.data.age}},methods:{handelUserInfoUpdate:function(e){var t=this,n={uid:this.data.uid};if("sex"===e){if(n["sex"]=this.currentSex,this.data.sex===this.currentSex)return void this.$message.warning("请选择");this.showSexDialog=!1}else{if(n["age"]=this.currentAge,this.data.age===this.currentAge)return void this.$message.warning("请选择");this.showAgeDialog=!1}this.API.updateUserInfo({uid:this.data.uid,data:n}).then((function(e){console.log("aa",n,e),200===e.code&&"success"===e.message?(t.data.age=t.currentAge,t.data.sex=t.currentSex,t.$store.commit("updateCurrentConversationTitle",t.data),t.$message.success("修改成功")):t.$message.warning("修改失败")})).catch((function(e){console.log("修改失败",e),t.$message.warning("修改失败")}))},handlePreview:function(e){this.$bus.$emit("image-preview",{url:e,urlList:this.currentImgs})}}},oa=aa,ia=(n("3a4c"),Object(z["a"])(oa,ra,sa,!1,null,"74f59482",null)),ca=ia.exports,ua={name:"PairsItem",props:{data:Object},components:{PairsItem:da,UserOrder:na,UserCard:ca},data:function(){return{renderKeys:{assoc_id:{label:"assoc_id"},create_time:{label:"报名时间",transform:function(e){return $s()(1e3*e).format("YYYY-MM-DD HH:mm:ss")}},data:{label:"报名机型"},fx_money:{label:"被分销金额"},group_id:{label:"群组"},id:{label:"报名id"},keep:{label:"是否继续保持CP",transform:function(e){return e?"是":"否"}},last_assoc:{label:"重配前对象id"},login_time:{label:"活动3天内登录时间",transform:function(e){return $s()(1e3*e).format("YYYY-MM-DD HH:mm:ss")}},order_id:{label:"订单id"},add_score:{label:"额外分数"},media_id:{label:"公众号"},pay:{label:"支付金额",transform:function(e){return e+"元"}},score:{label:"分数"},sex:{label:"性别",transform:function(e){return Hs.sexMap[e]}},stage_id:{label:"期数"},state:{label:"匹配状态"},confirm:{key:"confirm",label:"是否确认",transform:function(e){var t={"-1":"重配",0:"未操作",1:"确认"};return t[e.toString()]}},rematch:{key:"rematch",label:"是否重配",transform:function(e){return 1==e?"是":"否"}},room_id:{key:"room_id",label:"CP编号"}}}},mounted:function(){console.log("data",this.data)}},la=ua,fa=(n("dee9"),Object(z["a"])(la,Ws,Js,!1,null,"653ec310",null)),da=fa.exports;function pa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ma(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pa(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pa(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ga={data:function(){return{userID:"im_account_17",messageText:"new message",activeTab:"first",activePanes:["1"],userInfo:{},userPairs:[],renderKeys:{uid:{key:"uid",label:"uid"},nickname:{key:"nickname",label:"昵称"},school:{key:"school",label:"学校"},address:{key:"address",label:"常居地"},age:{key:"age",label:"生日",modify:!0},be_vip_at:{key:"be_vip_at",label:"普通会员开启时间",transform:function(e){return e?$s()(1e3*e).format("YYYY-MM-DD HH:mm:ss"):"不是会员"}},feed_sex:{key:"feed_sex",label:"信息流性别"},fpdx_like:{key:"fpdx_like",label:"匹配偏好"},height:{key:"height",label:"身高"},home:{key:"home",label:"故乡"},identity_auth:{key:"identity_auth",label:"认证照片",transform:function(e){return e||"无"}},login_at:{key:"login_at",label:"上次登录时间",transform:function(e){return $s()(1e3*e).format("YYYY-MM-DD HH:mm:ss")}},pair_max_age:{key:"pair_max_age",label:"匹配最大年龄"},pair_min_age:{key:"pair_max_age",label:"匹配最小年龄"},partner_id:{key:"partner_id",label:"卡片id"},phone:{key:"phone",label:"手机号"},qq:{key:"qq",label:"qq",transform:function(e){return e||"无"}},weixin:{key:"weixin",label:"微信",transform:function(e){return e||"无"}},sex:{key:"sex",label:"性别",modify:!0,transform:function(e){return Hs.sxoMap[e]}},sxo:{key:"sxo",label:"性取向",transform:function(e){return Hs.sxoMap[e]}},supvip_endat:{key:"supvip_endat",label:"svip到期时间",transform:function(e){return e?$s()(1e3*e).format("YYYY-MM-DD HH:mm:ss"):"不是svip"}},wx_auth:{key:"wx_auth",label:"是否微信认证",transform:function(e){return e?"是":"否"}},gold_flower:{key:"gold_flower",label:"金花"},red_flower:{key:"red_flower",label:"红花"},expect:{key:"expect",label:"自我描述"}}}},components:{PairsItem:da,UserCard:ca},computed:ma({},Object(ne["c"])({currentToUID:function(e){return e.conversation.currentToUID}})),beforeMount:function(){this.getInitData()},watch:{currentToUID:function(){this.getInitData(),this.activeTab="first"}},methods:{getInitData:function(){var e=this;this.API.getUserInfo(this.currentToUID).then((function(t){t&&200===t.code&&(console.log("200 ff",t),e.userInfo=t.data.user,e.userPairs=t.data.pairs,e.$store.commit("updateCurrentConversationTitle",t.data.user))})).catch((function(t){console.error("数据请求失败!",t),e.userInfo=null,e.userPairs=null}))},handleTabClick:function(e,t){console.log(e,t)},handlePaneChange:function(e){console.log(e)}}},ha=ga,va=(n("957f"),Object(z["a"])(ha,Ns,Rs,!1,null,"5c631ea3",null)),ba=va.exports,ya=function(){var e=this,t=e.$createElement;e._self._c;return e._e()},Oa=[],Ca=n("a1d8"),_a=n.n(Ca),Ia=M.a.service();function Ma(e){var t=1400284328,n=604800,r="0f6624e1d7436f1d55904d226d841a253d8b708e6c5799cbaad66e46f55ee708",s=new window.LibGenerateTestUserSig(t,r,n),a=s.genTestUserSig(e);return{SDKAppID:t,userSig:a}}window.genTestUserSig=Ma;var wa={name:"Login",components:{ElForm:sn.a},data:function(){var e=function(e,t,n){/^[a-zA-Z][a-zA-Z0-9_]{3,23}$/.test(t)?n():n(new Error("不合法（字母开头+字母/数字，长度4-24)"))};return{form:{userID:"im_account_3",password:""},rules:{userID:[{required:!0,message:"请输入 userID",trigger:"blur"},{validator:e,trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},logo:_a.a,registerVisible:!1,loading:!1}},beforeMount:function(){this.login()},methods:{submit:function(){var e=this;this.$refs["login"].validate((function(t){t&&e.login()}))},login:function(){var e=this;localStorage.setItem("kfUid",11),this.loading=!0,this.API.accountInit({kf_uid:localStorage.getItem("kfUid")}).then((function(t){var n=t.data.user;console.log("accountInit",t),e.submitLogin(n.im_account,n.im_sig)}))},submitLogin:function(e,t){var n=this;console.log("ff",this.form.userID,window.genTestUserSig(this.form.userID).userSig),this.tim.login({userID:e,userSig:t}).then((function(){n.loading=!1,n.$store.commit("toggleIsLogin",!0),n.$store.commit("startComputeCurrent"),n.$store.commit({type:"GET_USER_INFO",userID:e,userSig:t,sdkAppID:window.genTestUserSig("").SDKAppID}),n.$nextTick((function(){Ia.close()})),n.$store.commit("showMessage",{type:"success",message:"登录成功"})})).catch((function(e){n.loading=!1,n.$store.commit("showMessage",{message:"登录失败：444"+e.message,type:"error"})}))}}},Ea=wa,Ta=(n("b085"),Object(z["a"])(Ea,ya,Oa,!1,null,"0540992c",null)),Pa=Ta.exports,Da=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:e.showPreviewer,expression:"showPreviewer"}],staticClass:"image-previewer-wrapper",on:{mousewheel:e.handleMouseWheel}},[n("div",{staticClass:"image-wrapper"},[n("img",{staticClass:"image-preview",style:{transform:"scale("+e.zoom+") rotate("+e.rotate+"deg)"},attrs:{src:e.previewUrl},on:{click:e.close}})]),n("i",{staticClass:"el-icon-close close-button",on:{click:e.close}}),n("i",{staticClass:"el-icon-back prev-button",on:{click:e.goPrev}}),n("i",{staticClass:"el-icon-right next-button",on:{click:e.goNext}}),n("div",{staticClass:"actions-bar"},[n("i",{staticClass:"el-icon-zoom-out",on:{click:e.zoomOut}}),n("i",{staticClass:"el-icon-zoom-in",on:{click:e.zoomIn}}),n("i",{staticClass:"el-icon-refresh-left",on:{click:e.rotateLeft}}),n("i",{staticClass:"el-icon-refresh-right",on:{click:e.rotateRight}}),n("span",{staticClass:"image-counter"},[e._v(e._s(e.index+1)+" / "+e._s(e.imgUrlList.length))])])])},Sa=[],ka={name:"ImagePreviewer",data:function(){return{url:"",index:0,visible:!1,zoom:1,rotate:0,minZoom:.1,imgUrlList:[]}},computed:{showPreviewer:function(){return this.url.length>0&&this.visible},imageStyle:function(){return{transform:"scale(".concat(this.zoom,");")}},previewUrl:function(){return this.formatUrl(this.imgUrlList[this.index])}},mounted:function(){this.$bus.$on("image-preview",this.handlePreview)},methods:{handlePreview:function(e){var t=e.url,n=e.urlList;this.url=t,this.imgUrlList=n,this.index=this.imgUrlList.findIndex((function(e){return e===t})),this.visible=!0},handleMouseWheel:function(e){e.wheelDelta>0?this.zoomIn():this.zoomOut()},zoomIn:function(){this.zoom+=.1},zoomOut:function(){this.zoom=this.zoom-.1>this.minZoom?this.zoom-.1:this.minZoom},close:function(){Object.assign(this,{zoom:1}),this.visible=!1},rotateLeft:function(){this.rotate-=90},rotateRight:function(){this.rotate+=90},goNext:function(){this.index=(this.index+1)%this.imgUrlList.length},goPrev:function(){this.index=this.index-1>=0?this.index-1:this.imgUrlList.length-1},formatUrl:function(e){return e?"//"===e.slice(0,2)?"https:".concat(e):e:""}}},ja=ka,La=(n("0a44"),Object(z["a"])(ja,Da,Sa,!1,null,"208c032b",null)),Aa=La.exports,xa=n("9579"),Ua=n.n(xa);Ua.a.init({sid:"500702399",cid:"500702403",autoReport:1,senseHash:0,senseQuery:0,performanceMonitor:0,ignoreParams:[]});var Na=Ua.a;function Ra(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ga(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ra(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ra(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $a={title:"TIMSDK DEMO",components:{Login:Pa,SideBar:Ps,CurrentConversation:Gn,ImagePreviewer:Aa,RightSide:ba,HeaderBar:Us},computed:Ga(Ga({},Object(ne["c"])({currentUserProfile:function(e){return e.user.currentUserProfile},currentConversation:function(e){return e.conversation.currentConversation},isLogin:function(e){return e.user.isLogin},isSDKReady:function(e){return e.user.isSDKReady},isBusy:function(e){return e.video.isBusy},userID:function(e){return e.user.userID},conversationPageSize:function(e){return e.conversation.conversationPageSize}})),{},{showLoading:function(){return!this.isSDKReady}}),mounted:function(){this.addHistoryFriendList(),this.initListener()},watch:{isLogin:function(e){e&&Na.clickStat("link_two",{show:"true"})}},methods:{initListener:function(){this.tim.on(this.TIM.EVENT.SDK_READY,this.onReadyStateUpdate,this),this.tim.on(this.TIM.EVENT.SDK_NOT_READY,this.onReadyStateUpdate,this),this.tim.on(this.TIM.EVENT.KICKED_OUT,this.onKickOut),this.tim.on(this.TIM.EVENT.ERROR,this.onError),this.tim.on(this.TIM.EVENT.MESSAGE_RECEIVED,this.onReceiveMessage),this.tim.on(this.TIM.EVENT.CONVERSATION_LIST_UPDATED,this.onUpdateConversationList),this.tim.on(this.TIM.EVENT.NET_STATE_CHANGE,this.onNetStateChange),this.tim.on(this.TIM.EVENT.MESSAGE_READ_BY_PEER,this.onMessageReadByPeer)},addHistoryFriendList:function(){var e=this;this.API.getContactList({kf_uid:localStorage.getItem("kfUid"),page:1,per_page:this.conversationPageSize}).then((function(t){console.log("getContactList",t.data.contact_list),e.$store.commit("addConversationList",t.data.contact_list),e.$store.commit("setTotalConvasation",t.data.total),e.$store.commit("updateUnreadTotal",{unreadCount:t.data.unread_count,unreadNumber:t.data.unread_number})}))},onReceiveMessage:function(e){var t=e.data;this.handleVideoMessage(t),this.handleAt(t),this.handleQuitGroupTip(t),this.$store.commit("pushCurrentMessageList",t)},onError:function(e){var t=e.data;"Network Error"!==t.message&&this.$store.commit("showMessage",{message:t.message,type:"error"})},onMessageReadByPeer:function(){},onReadyStateUpdate:function(e){var t=this,n=e.name,r=n===this.TIM.EVENT.SDK_READY;this.$store.commit("toggleIsSDKReady",r),r&&(this.tim.getMyProfile().then((function(e){var n=e.data;t.$store.commit("updateCurrentUserProfile",n)})).catch((function(e){t.$store.commit("showMessage",{type:"error",message:e.message})})),this.$store.dispatch("getBlacklist"))},kickedOutReason:function(e){switch(e){case this.TIM.TYPES.KICKED_OUT_MULT_ACCOUNT:return"由于多实例登录";case this.TIM.TYPES.KICKED_OUT_MULT_DEVICE:return"由于多设备登录";case this.TIM.TYPES.KICKED_OUT_USERSIG_EXPIRED:return"由于 userSig 过期";default:return""}},checkoutNetState:function(e){switch(e){case this.TIM.TYPES.NET_STATE_CONNECTED:return{message:"已接入网络",type:"success"};case this.TIM.TYPES.NET_STATE_CONNECTING:return{message:"当前网络不稳定",type:"warning"};case this.TIM.TYPES.NET_STATE_DISCONNECTED:return{message:"当前网络不可用",type:"error"};default:return""}},onNetStateChange:function(e){this.$store.commit("showMessage",this.checkoutNetState(e.data.state))},onKickOut:function(e){this.$store.commit("showMessage",{message:"".concat(this.kickedOutReason(e.data.type),"被踢出，请重新登录。"),type:"error"}),this.$store.commit("toggleIsLogin",!1),this.$store.commit("reset")},onUpdateConversationList:function(e){console.log("更新会话联系人列表",e),this.$store.commit("updateConversationList",e.data)},handleAt:function(e){for(var t=this,n=e.filter((function(e){return e.type===t.TIM.TYPES.MSG_TEXT&&e.payload.text.includes("@")})),r=0;r<n.length;r++){var s=n[r],a=s.payload.text.match(/@\w+/g);a&&(a.includes("@".concat(this.currentUserProfile.userID))&&(this.$store.getters.hidden&&this.notifyMe(s),ee()({title:"有人在群".concat(s.conversationID.slice(5),"提到了你"),message:s.payload.text,duration:3e3}),this.$bus.$emit("new-messsage-at-me",{data:{conversationID:s.conversationID}})))}},selectConversation:function(e){e!==this.currentConversation.conversationID&&this.$store.dispatch("checkoutConversation",e)},isJsonStr:function(e){try{return JSON.parse(e),!0}catch(t){return!1}},handleVideoMessage:function(e){var t=this,n=e.filter((function(e){return e.type===t.TIM.TYPES.MSG_CUSTOM&&t.isJsonStr(e.payload.data)}));if(0!==n.length){var r=JSON.parse(n[0].payload.data);if(r.action===gn.VIDEO_CALL_ACTION_DIALING){if(this.isBusy)return void this.$bus.$emit("busy",r,n[0]);this.$store.commit("GENERATE_VIDEO_ROOM",r.room_id),this.selectConversation(n[0].conversationID),n[0].from!==this.userID&&this.$bus.$emit("isCalled")}r.action===gn.VIDEO_CALL_ACTION_SPONSOR_CANCEL&&this.$bus.$emit("missCall"),r.action===gn.VIDEO_CALL_ACTION_REJECT&&this.$bus.$emit("isRefused"),r.action===gn.VIDEO_CALL_ACTION_SPONSOR_TIMEOUT&&this.$bus.$emit("missCall"),r.action===gn.VIDEO_CALL_ACTION_ACCEPTED&&this.$bus.$emit("isAccept"),r.action===gn.VIDEO_CALL_ACTION_HANGUP&&this.$bus.$emit("isHungUp"),r.action===gn.VIDEO_CALL_ACTION_LINE_BUSY&&this.$bus.$emit("isRefused"),r.action===gn.VIDEO_CALL_ACTION_ERROR&&this.$bus.$emit("isRefused")}},notifyMe:function(e){var t=this;"Notification"in window&&("granted"===window.Notification.permission?this.handleNotify(e):"denied"!==window.Notification.permission&&window.Notification.requestPermission().then((function(n){"granted"===n&&t.handleNotify(e)})))},handleNotify:function(e){var t=this,n=new window.Notification("有人提到了你",{icon:"https://webim-1252463788.file.myqcloud.com/demo/img/logo.dc3be0d4.png",body:e.payload.text});n.onclick=function(){window.focus(),t.$store.dispatch("checkoutConversation",e.conversationID),n.close()}},handleLinkClick:function(){Na.clickStat("link_two",{click:"true"})},handleQuitGroupTip:function(e){var t=this,n=e.filter((function(e){return t.currentConversation.conversationID===e.conversationID&&e.type===t.TIM.TYPES.MSG_GRP_TIP&&(e.payload.operationType===t.TIM.TYPES.GRP_TIP_MBR_QUIT||e.payload.operationType===t.TIM.TYPES.GRP_TIP_MBR_KICKED_OUT)}));n.length>0&&n.forEach((function(e){(Array.isArray(e.payload.userIDList)||e.payload.userIDList.length>0)&&t.$store.commit("deleteGroupMemberList",e.payload.userIDList)}))}}},Ya=$a,Fa=(n("2482"),Object(z["a"])(Ya,Q,X,!1,null,null,null)),Ba=Fa.exports,qa=(n("a481"),n("e23e")),Ha=n.n(qa),Va=n("3438"),Ka=n.n(Va),za=Ha.a.create({SDKAppID:window.genTestUserSig("").SDKAppID});window.setLogLevel=za.setLogLevel,za.setLogLevel(4),za.registerPlugin({"cos-js-sdk":Ka.a});var Wa=za,Ja=(n("28a5"),n("7618")),Qa=n("d225"),Xa=n("b0b4"),Za=n("bc3a"),eo=n.n(Za);function to(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function no(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?to(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):to(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ro=function(){function e(t){Object(Qa["a"])(this,e),this.initConfig=t.initConfig||{},this.beforeRequset=t.beforeRequset||function(){},this.reqIntercept=t.reqIntercept||function(e){return e},this.resIntercept=t.resIntercept||function(){}}return Object(Xa["a"])(e,[{key:"setInterceptors",value:function(e,t){var n=this;this.beforeRequset&&this.beforeRequset(t),e.interceptors.request.use((function(e){return n.reqIntercept(e)}),(function(e){return Promise.reject(e)})),e.interceptors.response.use((function(e){switch(n.resIntercept(e),e.status){case 200:return e.data;case 301:return;default:return Promise.reject("error")}}),(function(e){if(console.log("response err",e),e.response){switch(e.response.status){case"403":console.log("403 ERR!");break;case"404":console.warn("404 ERR!");break;default:break}return Promise.reject(e.response)}return e.request?(4===e.request.readyState&&0===e.request.status&&console.error("请求超时!"),console.log("err.request: ",e),Promise.reject(e.request)):(console.log("err: ",e),Promise.reject(e))}))}},{key:"request",value:function(e,t){var n=eo.a.create(),r=no(no({url:e},t),this.initConfig);return this.setInterceptors(n,e),n(r)}},{key:"get",value:function(e,t,n){var r=no({method:"GET"},n),s=t?this.buildUrl(e,t):e;return this.request(s,r)}},{key:"post",value:function(e,t,n){var r=no(no({method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}},n),{},{data:{}});return t&&(r.data=JSON.stringify(t)),this.request(e,r)}},{key:"delete",value:function(e,t){var n={method:"DELETE"},r=t?this.buildUrl(e,t):e;return this.request(r,n)}},{key:"put",value:function(e,t){var n={method:"PUT",data:{}},r=e.replace(/\${[^\+]+}/,t.uid);return console.log("data",t),t&&(n.data=JSON.stringify(t.data)),this.request(r,n)}},{key:"postForm",value:function(e,t,n){var r={method:"POST",body:{}};return t&&(r.body=n?this.buildFormData(t):new FormData(t)),this.request(e,r)}},{key:"head",value:function(e){var t={method:"Head"};return this.request(e,t)}},{key:"buildUrl",value:function(e,t){var n=[];if("object"===Object(Ja["a"])(t)){for(var r in t)r&&n.push(r+"="+encodeURIComponent(t[r]));return e+"?"+n.join("&")}return e.split(":")[0]+t}},{key:"buildFormData",value:function(e){if(e){var t=new FormData;for(var n in e)n&&t.append(n,e[n]);return t}}}]),e}(),so=ro,ao={getUserInfo:{method:"get",url:"/api/admin/pair/history/"},getUserPartner:{method:"post",url:"/api/admin/partner/search/"},getFriendList:{method:"get",url:"/stub-api/v3/friend/get_friend_list"},getContactList:{method:"get",url:"/api/admin/kfaccount/get_contact_list"},getMessageList:{method:"get",url:"/api/admin/kfaccount/get_message_list"},setMessageRead:{method:"post",url:"/api/admin/kfaccount/set_message_read"},accountInit:{method:"post",url:"/api/admin/kfaccount/get_kf_account"},updateUserInfo:{method:"put",url:"/api/admin/user/${uid}/update"},getUserUidByIMAccount:{method:"post",url:"/stub-api/v3/user/uid_translation_im_account"},contactStar:{method:"post",url:"/stub-api/v3/friend/star_contact"},contactUnStar:{method:"post",url:"/stub-api/v3/friend/un_star_contact"},getUserMessages:{method:"post",url:"/stub-api/v3/im/get_user_messages"}};n("386d");function oo(e){var t=e>0;t?document.title.search(/\((.*?)\)/)>=0?document.title=document.title.replace(/\((.*?)\)/,"(".concat(e>99?"99+":e,")")):document.title="(".concat(e,")").concat(document.title):document.title=document.title.replace(/\((.*?)\)/,"")}function io(){var e={},t=location.search,n=t.substr(t.indexOf("?")+1).split("&");return n.forEach((function(t){var n=t.split("=");e[n[0]]=n[1]})),e}var co,uo=function(){return console.log("sssss","production"),"https://api.fenpeiduixiang.com"};function lo(){return co||(co=io().token)}var fo=new so({initConfig:{baseURL:uo(),credentials:"same-origin",headers:{Accept:"*/*","Content-Type":"application/json",authorization:lo()}},beforeRequset:function(e){"/login"===e&&console.log("to login page")},reqIntercept:function(e,t){return"/login"===t&&console.log("to login page"),e},resIntercept:function(e,t){switch(e.status){case 200:return e;case 302:break;case 401:break;default:0,Promise.resolve(e)}return Promise.resolve(e)}}),po=function(e){var t={};return Object.keys(e).forEach((function(n){var r=e[n];t[n]=function(){var e=Object(Cr["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,fo[r.method](r.url,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})),t},mo=po(ao),go=function(e,t){var n=[];return e.forEach((function(e){var r=e.content.MsgBody[0].MsgContent,s=e.content.MsgBody[0].MsgType,a={};s===Ha.a.TYPES.MSG_CUSTOM&&(a["data"]="2322id",a["description"]="description",a["extension"]="extension"),s===Ha.a.TYPES.MSG_IMAGE&&(a["uuid"]=r.UUID,a["imageFormat"]=r.ImageFormat,a["imageInfoArray"]=r.ImageInfoArray),s===Ha.a.TYPES.MSG_TEXT&&(a["text"]=r.Text),s===Ha.a.TYPES.MSG_SOUND&&(a["uuid"]=r.UUID,a["url"]=r.Url,a["size"]=r.Size,a["second"]=r.Second),n.push({ID:e.content.MsgKey,avatar:"",clientSequence:49812,conversationID:t,conversationSubType:void 0,conversationType:"C2C",flow:"C2C".concat(e.fromAccount)===t?"in":"out",from:e.fromAccount,isPeerRead:1===e.read,isPlaceMessage:0,isResend:!1,isRevoked:!1,isSystemMessage:!1,nick:"",payload:a,isFork:e.star_at,random:e.msgRandom,sequence:e.content.MsgSeq,status:"success",time:e.msgTimeStamp,to:e.toAccount,type:s})})),n},ho=function(e){var t={};return e.forEach((function(e){t["C2C".concat(e.user.im_account)]={conversationID:"C2C".concat(e.user.im_account),lastMessage:{lastTime:e.last_at,fromAccount:e.last_msg,messageForShow:e.last_msg,type:"TIMCustomElem"},peerReadTime:0,type:"C2C",unreadCount:e.unread_cnt,userProfile:{userID:e.user.im_account,nick:e.user.nickname,avatar:e.user.avatar}},e.star_at&&state.forkList.push("C2C".concat(e.user.im_account))})),t},vo={forkConversation:function(e,t){var n=t.conversationID,r=t.isFork;mo.getUserUidByIMAccount({reqIMAccount:n.slice(3)}).then((function(t){200===t.code?e.commit("sendContactStar",{conversationID:n,UID:t.data.uid,isFork:r}):R.a.warning("未找到该用户")}))},getMessageList:function(e,t){if(e.state.isCompleted)e.commit("showMessage",{message:"已经没有更多的历史消息了哦",type:"info"});else{var n=e.state,r=n.nextReqMessageID,s=n.currentMessageList;Wa.getMessageList({conversationID:t,nextReqMessageID:r,count:15}).then((function(t){e.state.nextReqMessageID=t.data.nextReqMessageID,e.state.isCompleted=t.data.isCompleted,e.state.currentMessageList=[].concat(Object(sr["a"])(t.data.messageList),Object(sr["a"])(s))}))}},getMoreHistoryMessageList:function(e,t){var n=localStorage.getItem("kfUid");mo.getMessageList({kf_uid:n,to_uid:e.state.currentToUID,page:e.state.moreMessagePage,per_page:50,sort:"desc"}).then((function(n){if(n.data.messages&&0!==n.data.messages.length){var r=go(n.data.messages,t).sort((function(e,t){return e.time-t.time})),s=e.state.currentMessageList;e.state.currentMessageList=[].concat(Object(sr["a"])(r),Object(sr["a"])(s)),e.state.moreMessagePage++}else e.commit("showMessage",{message:"已经没有更多的历史消息了哦",type:"warning"})}))},getHistoryMessageList:function(e,t){var n=localStorage.getItem("kfUid");mo.getMessageList({kf_uid:n,to_uid:e.state.currentToUID,page:1,per_page:50,sort:"desc"}).then((function(r){setTimeout((function(){r.data.messages&&r.data.messages.forEach((function(t){0===t.read&&t.toAccount==="im_account_"+n&&mo.setMessageRead({kf_uid:parseInt(n),to_uid:e.state.currentToUID,msg_random:t.msgRandom,msg_timestamp:t.msgTimeStamp,msg_seq:t.msgSeq}).then((function(e){console.log("消息已读",e)}))}))}),100);var s=go(r.data.messages,t),a=e.state.currentMessageList;e.state.currentMessageList=[].concat(Object(sr["a"])(s),Object(sr["a"])(a)).sort((function(e,t){return e.time-t.time}))}))},searchConversation:function(e,t){mo.getContactList({kf_uid:localStorage.getItem("kfUid"),page:1,per_page:1,friend_uid:t}).then((function(n){if(console.log("res search",n),n.data.contact_list.length&&n.data.contact_list[0].friend_uid==t){e.state.currentToUID=t;var r=Object.values(ho(n.data.contact_list))[0];e.commit("updateCurrentConversation",r),e.dispatch("getHistoryMessageList",r.conversationID),R.a.success("搜索成功")}else R.a.warning("未找到该用户")}))},checkoutConversation:function(e,t){Wa.setMessageRead({conversationID:t}),"sys"!==t.slice(3).slice(0,3)?mo.getUserUidByIMAccount({reqIMAccount:t.slice(3)}).then((function(n){console.log("aaa",n),200===n.code?(e.state.currentToUID=n.data.uid,e.commit("updateCurrentConversation",e.state.conversationObject[t]),e.dispatch("getHistoryMessageList",t)):R.a.warning("未找到该用户")})):R.a.warning("系统消息无法打开")}};function bo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bo(Object(n),!0).forEach((function(t){Object(te["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Oo={state:{currentConversation:{},currentConversationTitle:"",currentToUID:null,moreMessagePage:2,currentMessageList:[],nextReqMessageID:"",isCompleted:!1,conversationObject:{},totalConvasation:0,conversationPageNum:1,conversationPageSize:100,forkList:["C2Cim_account_3"]},getters:{toAccount:function(e){if(!e.currentConversation||!e.currentConversation.conversationID)return"";switch(e.currentConversation.type){case"C2C":return e.currentConversation.conversationID.replace("C2C","");case"GROUP":return e.currentConversation.conversationID.replace("GROUP","");default:return e.currentConversation.conversationID}},currentConversationType:function(e){return e.currentConversation&&e.currentConversation.type?e.currentConversation.type:""},totalUnreadCount:function(e){var t=Object.values(e.conversationObject),n={count:0,people:0};return n.count=t.reduce((function(t,r){return jo.getters.hidden||e.currentConversation.conversationID!==r.conversationID?(0!==r.unreadCount&&n.people++,t+r.unreadCount):t}),0),oo(n),n},imgUrlList:function(e){return e.currentMessageList.filter((function(e){return e.type===Ha.a.TYPES.MSG_IMAGE&&!e.isRevoked})).map((function(e){return e.payload.imageInfoArray[0].url||e.payload.imageInfoArray[0].URL}))},conversationIdList:function(e){return e.map((function(e){return e.conversationID}))}},mutations:{updateCurrentConversation:function(e,t){e.currentConversation=t,e.currentMessageList=[],e.nextReqMessageID="",e.isCompleted=!1},resetCurrentConversationUnread:function(e){e.currentConversation.unreadCount=0},updateCurrentConversationTitle:function(e,t){var n=(new Date).getFullYear()-parseInt((t["age"]+"").slice(0,4)),r=t.uid+" "+(1===t.sex?"男":"女")+" "+n+"【"+t.platform+"】【type="+t.user_type+"】";e.currentConversationTitle=r},setTotalConvasation:function(e,t){e.totalConvasation=t},addConversationList:function(e,t){var n=ho(t);console.log("初始化联系人列表",n),window.initConversationObject=n,e.conversationObject=n},addMoreConversationList:function(e){parseInt(e.totalConvasation/e.conversationPageSize)+1<=e.conversationPageNum?R.a.warning("没有更多了"):mo.getContactList({kf_uid:localStorage.getItem("kfUid"),page:e.conversationPageNum+1,per_page:e.conversationPageSize}).then((function(t){console.log("getContactList",t.data.contact_list);var n=ho(t.data.contact_list);e.conversationPageNum++,e.conversationObject=yo(yo({},e.conversationObject),n)}))},updateConversationList:function(e,t){var n={};t.forEach((function(e){n[e.conversationID]=e})),console.log("新的会话列表",n),window.conversationObject=n,e.conversationObject=Object.assign(e.conversationObject,n)},resetCurrentConversation:function(e){e.currentConversation={}},pushCurrentMessageList:function(e,t){if(e.currentConversation.conversationID)if(Array.isArray(t)){var n=t.filter((function(t){return t.conversationID===e.currentConversation.conversationID}));e.currentMessageList=[].concat(Object(sr["a"])(e.currentMessageList),Object(sr["a"])(n))}else t.conversationID===e.currentConversation.conversationID&&(e.currentMessageList=[].concat(Object(sr["a"])(e.currentMessageList),[t]))},removeMessage:function(e,t){var n=e.currentMessageList.findIndex((function(e){var t=e.ID;return t===R.a.ID}));n>=0&&e.currentMessageList.splice(n,1)},reset:function(e){Object.assign(e,{currentConversation:{},currentMessageList:[],nextReqMessageID:"",isCompleted:!1,conversationList:[]})},sendContactStar:function(e,t){var n=t.conversationID,r=t.UID,s=t.isFork;console.log("forkConversation3",s),s?mo.contactUnStar({contactUid:r}).then((function(t){if(200!==t.code)R.a.warning("取消收藏失败");else{var r=e.forkList.indexOf(n);if(-1!==r){console.log("contactUnStar",r,e.forkList);var s=e.forkList;s.splice(r,1),e.forkList=s,console.log("contactUnStar success",e.forkList),R.a.success("取消成功")}}})):mo.contactStar({contactUid:r}).then((function(t){if(200===t.code)return e.forkList.push(n),R.a.success("收藏成功"),void console.log("contact Star success",e.forkList);R.a.warning("收藏失败")}))}},actions:vo},Co=Oo,_o={state:{groupList:[],currentMemberList:[],createGroupModelVisible:!1},getters:{hasGroupList:function(e){return e.groupList.length>0}},mutations:{updateGroupList:function(e,t){e.groupList=t},updateCreateGroupModelVisible:function(e,t){e.createGroupModelVisible=t},updateCurrentMemberList:function(e,t){e.currentMemberList=[].concat(Object(sr["a"])(e.currentMemberList),Object(sr["a"])(t))},deleteGroupMemeber:function(e,t){e.currentMemberList=e.currentMemberList.filter((function(e){return e.userID!==t}))},deleteGroupMemberList:function(e,t){e.currentMemberList=e.currentMemberList.filter((function(e){return!t.includes(e.userID)}))},resetCurrentMemberList:function(e){e.currentMemberList=[]},reset:function(e){Object.assign(e,{groupList:[],currentMemberList:[],createGroupModelVisible:!1})}},actions:{updateGroupList:function(e,t){e.commit("updateGroupList",t)},getGroupMemberList:function(e,t){return Wa.getGroupMemberList({groupID:t,offset:e.state.currentMemberList.length,count:30}).then((function(t){return e.commit("updateCurrentMemberList",t.data.memberList),t}))}}},Io=_o,Mo={state:{currentUserProfile:{},isLogin:!1,isSDKReady:!1,userID:0,userSig:"",sdkAppID:0,kfUid:localStorage.getItem("kfUid")},mutations:{updateCurrentUserProfile:function(e,t){e.currentUserProfile=t},toggleIsLogin:function(e,t){e.isLogin="undefined"===typeof t?!e.isLogin:t},toggleIsSDKReady:function(e,t){e.isSDKReady="undefined"===typeof t?!e.isSDKReady:t},reset:function(e){Object.assign(e,{currentUserProfile:{},isLogin:!1,isSDKReady:!1})},GET_USER_INFO:function(e,t){e.userID=t.userID,e.userSig=t.userSig,e.sdkAppID=t.sdkAppID}},actions:{logout:function(e){e.rootState.conversation.currentConversation.conversationID&&Wa.setMessageRead({conversationID:e.rootState.conversation.currentConversation.conversationID}),Wa.logout().then((function(){e.commit("toggleIsLogin"),e.commit("stopComputeCurrent"),e.commit("reset")}))}}},wo=Mo,Eo={state:{videoRoom:0,isBusy:!1},mutations:{GENERATE_VIDEO_ROOM:function(e,t){e.videoRoom=t||Math.ceil(Math.random()*(Math.pow(2,32)-1))},UPDATE_ISBUSY:function(e,t){e.isBusy=t}}},To=Eo,Po={state:{friendList:[],createGroupModelVisible:!1},mutations:{upadteFriendList:function(e,t){e.friendList=t},reset:function(e){Object.assign(e,{friendList:[],createGroupModelVisible:!1})}}},Do=Po,So={state:{blacklist:[]},mutations:{updateBlacklist:function(e,t){e.blacklist=t},removeFromBlacklist:function(e,t){e.blacklist=e.blacklist.filter((function(e){return e.userID!==t}))},reset:function(e){Object.assign(e,{blacklist:[]})}},actions:{getBlacklist:function(e){Wa.getBlacklist().then((function(t){var n=t.data;n.length>0&&Wa.getUserProfile({userIDList:n}).then((function(t){var n=t.data;e.commit("updateBlacklist",n)}))}))}}},ko=So;Y["default"].use(ne["a"]);var jo=new ne["a"].Store({state:{current:Date.now(),intervalID:0,message:void 0,unreadCount:10,unreadNumber:20},getters:{hidden:function(e){e.current;return"function"!==typeof document.hasFocus?document.hidden:!document.hasFocus()}},mutations:{startComputeCurrent:function(e){e.intervalID=setInterval((function(){e.current=Date.now()}),500)},updateUnreadTotal:function(e,t){e.unreadCount=t.unreadCount,e.unreadNumber=t.unreadNumber},stopComputeCurrent:function(e){clearInterval(e.intervalID),e.intervalID=0},showMessage:function(e,t){e.message&&e.message.close(),e.message=R()({message:t.message,type:t.type||"success",duration:t.duration||2e3,offset:40})}},modules:{conversation:Co,group:Io,friend:Do,blacklist:ko,user:wo,video:To}});n("ed2c"),n("8e84");window.tim=Wa,window.TIM=Ha.a,window.API=mo,window.store=jo,Y["default"].prototype.$bus=new Y["default"],Y["default"].prototype.tim=Wa,Y["default"].prototype.TIM=Ha.a,Y["default"].prototype.API=mo,Y["default"].prototype.$store=jo,Y["default"].prototype.$confirm=$.a.confirm,Y["default"].prototype.$message=R.a,Y["default"].use(U.a),Y["default"].use(A.a),Y["default"].use(j.a),Y["default"].use(S.a),Y["default"].use(P.a),Y["default"].use(E.a),Y["default"].use(M.a),Y["default"].use(_.a),Y["default"].use(O.a),Y["default"].use(b.a),Y["default"].use(h.a),Y["default"].use(m.a),Y["default"].use(d.a),Y["default"].use(l.a),Y["default"].use(c.a),Y["default"].use(o.a),Y["default"].use(s.a),Y["default"].component("avatar",J),new Y["default"]({render:function(e){return e(Ba)}}).$mount("#app")},6794:function(e,t,n){"use strict";var r=n("6d8f"),s=n.n(r);s.a},6829:function(e,t,n){},"691c":function(e,t,n){"use strict";var r=n("5406"),s=n.n(r);s.a},"6b14":function(e,t,n){"use strict";var r=n("54c0"),s=n.n(r);s.a},"6d8f":function(e,t,n){},7186:function(e,t,n){},"76e5":function(e,t,n){},"777c":function(e,t,n){"use strict";var r=n("c1f9"),s=n.n(r);s.a},"794a":function(e,t,n){},"7a62":function(e,t,n){},"7f64":function(e,t,n){"use strict";var r=n("7186"),s=n.n(r);s.a},8127:function(e,t,n){"use strict";var r=n("12d4"),s=n.n(r);s.a},"81b7":function(e,t,n){"use strict";var r=n("85ca"),s=n.n(r);s.a},"854e":function(e,t,n){},"85ca":function(e,t,n){},"86b5":function(e,t,n){"use strict";var r=n("b8dc"),s=n.n(r);s.a},"8e84":function(e,t,n){},9462:function(e,t,n){"use strict";var r=n("275a"),s=n.n(r);s.a},9564:function(e,t,n){"use strict";var r=n("54c3"),s=n.n(r);s.a},"957f":function(e,t,n){"use strict";var r=n("794a"),s=n.n(r);s.a},"95a3":function(e,t,n){},9668:function(e,t,n){"use strict";var r=n("1b21"),s=n.n(r);s.a},9908:function(e,t,n){},a1d8:function(e,t,n){e.exports=n.p+"img/logo.dc3be0d4.png"},a359:function(e,t,n){},a433:function(e,t,n){},a86b:function(e,t,n){"use strict";var r=n("854e"),s=n.n(r);s.a},b085:function(e,t,n){"use strict";var r=n("1bd4"),s=n.n(r);s.a},b849:function(e,t,n){"use strict";var r=n("fbe1"),s=n.n(r);s.a},b8dc:function(e,t,n){},c1f9:function(e,t,n){},ce0c:function(e,t,n){"use strict";var r=n("95a3"),s=n.n(r);s.a},ce90:function(e,t,n){"use strict";var r=n("3a1d"),s=n.n(r);s.a},d274:function(e,t,n){},d4e4:function(e,t,n){},daca:function(e,t,n){"use strict";var r=n("d4e4"),s=n.n(r);s.a},dee9:function(e,t,n){"use strict";var r=n("568c"),s=n.n(r);s.a},e017:function(e,t,n){"use strict";var r=n("76e5"),s=n.n(r);s.a},e3ec:function(e,t,n){"use strict";var r=n("53b9"),s=n.n(r);s.a},e6da:function(e,t,n){"use strict";var r=n("a359"),s=n.n(r);s.a},ed2c:function(e,t,n){},f0f6:function(e,t,n){"use strict";var r=n("1fdb"),s=n.n(r);s.a},f6e3:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACpCAMAAAHy0MbyAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAJYUExURQrBYAvBYRPDZhzGbCXIcSrJdSHHbxjFaQ7CYwzBYSnJdEzSi3bcpqLnw87z3+X47uj58Ov68uz68+n58ef579/36rzu05Djt2TYmz7OghnFai/KeIHfrcPw2OP47fz+/f////P8+Nb15K7ry1vVlBrFaw7CYlDTjqrqyPP899j15YrhsxDCZFfUksDv1vr+/C7KdyzKdq3qynLbo2HXmf7//rTszhTDZo/jtk7SjCjJc7nt0fX9+THLes3y3/3//oXgsA3CYjTMe5HjuA/CY8/z4IDfrRbEaLft0GbYnO779Pb9+cLv1x3GbNL04ub575zmv5flvEDPgzDLeaXoxIzitPD79TXMfB7GbeL47F7WlhLDZavqyfj9+03SjN326YvitEbQh3jdqO/79CLHcLHrzE/TjSPHcOT47vH79rHrzUvSivf9+vn++8zy3lXUkdf15SDHblnVk+D36ybIclrVlGfZnHjdpznNf1HTjhfEadv26I3itUfRiMfx26Pow0HPhJPkuZjlvMHv1zjNfkTQhWnZnhvFa8ry3TLLepXkurbt0Gvan4LfrknRiV/Wl9X05HHbo7/v1Z3mv8jx24jhskjRiTrNf8nx3Mvy3WLXmUfQh0XQhu3681LTj9n15ljVk2XYm6/ry+H37Or68bXsz2PYmjfMfW3aoLvu0zbMfTPLe77u1S7KeErRirDrzNr253fcpkPPhSvJdafpxr3u1N736n/frPL89o7itW/boWDXl3ndqJvmvvv+/Xveqsbx2tz26fT8+BHDZD3OgYTgr4fhsQAAAKRC35oAAADIdFJOU/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8A9ppxxwAAAAlwSFlzAAAXEQAAFxEByibzPwAABVpJREFUaEPt2zuP2koUB3BaN1dCLikwols5fVb5Cim3QaxEtNomDdJKaHWbbaBASPcTUKVBShv6NNH6e2Uefxs/5u0H7NX5NXiOzwwjY+yxPR4N422MhYqEw/KFiDbiZ3UY0V7D1ThizDMiAmIcIkIURaycxlGEQCFLRvUvlDJ8/j+MP2OhTGymxoqxCDc2ioz6/mgo5hB1C39BtBZGkEFAQIiLERKiKN2xtc0ffpSkD1MsVhzxSZxgoydLlA2QKfyLmA7S4Buiaitk5RBWQ04BYTXkFBBWQ04BYTXkFA6IqyCl5AvWNGB9DVbWYW3NGWvVZGOZsb8X8i+MAiHe5rOFeYfMbcSuliQzlA3WSGUQ0fqGPAExHWRJvxFUwzk2h6gacnKIqiEnt0VYCTm5FcJKyMlVzrB1yMl9tFzTBn5ASgFxFWRc6I+YSCjDmoZGDzisq8PaKuWQR52qaTi/BKjB2jo28mZjb7k2TkRRLGv9lCcgTUdrkiQbpbZTVk5003VYH2X3lo4SQkiAN3EokhYbBNuqDFWkN6xqoTRWKmt5d2SJZhSQESQfAyohJwRa0ECSvzka0LhHmrcZGtBYI80b6usYR1kG7ARuRO1KH63d0D8GausFdfiAykbI9fAdNS0+Id2RU2cl1HCivHrQ8bgPihpuvqOSi/RxFRd4XSwyU1bEIndKUcVbym8fYplhBeNlswfWVIJuTXh35WIH7lhjvEHhAcEuRO9/ZKOrPSKEEEIIIVey+e+f8Wy8e3V4yuxuWb4AV02QCFO/rH9CvB3FLRPlbB5P6lsmWBnuBQ3VYXUwNNPg8NTPhA+o1Vr9eKb7UUgJUnt8WDFHTgDDXTkGSQHM97ncHt6ooAGN4NtctstZZHnbo74O0rxpHsgVkObtHvV1Qq+4be2G3hCndiVqV6J2pb7afUJ9HbcpYk316Xx15smAeqiuhzxPW9TWq8xQdmW9u+53J7VQ3Dc0CJgCa98KHJLd2c5tOaQ7QzUr46yoJpeNK3ndY85QyYXPcApV3KCOA9cfTZqglp1fu+7/utT9Z9NNoFJLj2s8nuBYZSxx1dKd919OTKxixLOiNC+OnnkJBdtUKzN+ALo8gub/byy2xVq6bMRKoR3WxekjllfsJw1+fl7H+pjEfHd65ztKV90did/q8hynw+lmomEIfi6mdEKr284nx02y7GlPU+4IIYQQQgghhBBisVxuNptOp4j0YpOt60/wF/MfN9nvHzt0UGH2OfTJUT9eTdMipPmt9Hhj2K4Vr6hwTYcFOuOiu3lUYZauWzZ31S3s90hD2F3vQKF4xdBudq3/3G90wFfoc+t2grYtN75Gf1/x5QEWaGJAL7YpBSah0w3C2SZWGI0HPzzoJ0+66GZ2rDuPV+tUWkyvDGKbvGOx7vbxn9UnfG+g1cDnirbdfUE7A6Hu9om62yfqbp+ou336YN1tMTjn4oFPwm5TR/U6m+flJOCKvSr8vZQA5ZlggQa8/jn7TMTU8ZpZ20ary7SLfMpiv9J2V2klsfuE3WBHfFcnMjTal32buwsKcfgbcQ463bRSfxeZ6Rpf0a2A9xtcTLo4fKn0soH3fAp6P/o4xfWw3+amPfzhetpzuR2+olv3fMp89+56HJ1F+4kCdpQTihVnuc/HB5TLDpOB75VJE9GjZKX6cow1Bx0xWkR4A+AB5ZIU58Gejq5hnnGUaxxCMdacnlC+EZP8qHwqvwyB/ZZF0xt7RSJdF4eN6Wl7PP7asoHmFNv2J5JuyVk3Wnu8yt/fKkq32Jwlq/tbflMmet/e/ZEdncZfj0Gvvw4s35ztXpkjhBBCCCGkrdHoLzv9X1u4OdoGAAAAAElFTkSuQmCC"},fbe1:function(e,t,n){},fc3e:function(e,t,n){},fee6:function(e,t,n){}});